import{F as V,i as j,D as x,p as O,N as I,P,k as z,l as Z,B as k,b as D,y as G,S as J,K as $,_ as R,m as M,n as q,o as Q}from"./use-locale-context-cwTY9VYn-REDUMe7F.js";function U(e){const t={each(n){var r;for(let i=0;i<((r=e.frames)==null?void 0:r.length);i+=1){const s=e.frames[i];s&&n(s)}},addEventListener(n,r,i){return t.each(s=>{try{s.document.addEventListener(n,r,i)}catch{}}),()=>{try{t.removeEventListener(n,r,i)}catch{}}},removeEventListener(n,r,i){t.each(s=>{try{s.document.removeEventListener(n,r,i)}catch{}})}};return t}function ee(e){const t=e.frameElement!=null?e.parent:null;return{addEventListener:(n,r,i)=>{try{t==null||t.addEventListener(n,r,i)}catch{}return()=>{try{t==null||t.removeEventListener(n,r,i)}catch{}}},removeEventListener:(n,r,i)=>{try{t==null||t.removeEventListener(n,r,i)}catch{}}}}var F="pointerdown.outside",Y="focus.outside";function te(e){for(const t of e)if(D(t)&&R(t))return!0;return!1}var S=e=>"clientY"in e;function ne(e,t){if(!S(t)||!e)return!1;const n=e.getBoundingClientRect();return n.width===0||n.height===0?!1:n.top<=t.clientY&&t.clientY<=n.top+n.height&&n.left<=t.clientX&&t.clientX<=n.left+n.width}function re(e,t){return e.y<=t.y&&t.y<=e.y+e.height&&e.x<=t.x&&t.x<=e.x+e.width}function C(e,t){if(!t||!S(e))return!1;const n=t.scrollHeight>t.clientHeight,r=n&&e.clientX>t.offsetLeft+t.clientWidth,i=t.scrollWidth>t.clientWidth,s=i&&e.clientY>t.offsetTop+t.clientHeight,h={x:t.offsetLeft,y:t.offsetTop,width:t.clientWidth+(n?16:0),height:t.clientHeight+(i?16:0)},c={x:e.clientX,y:e.clientY};return re(h,c)?r||s:!1}function ie(e,t){const{exclude:n,onFocusOutside:r,onPointerDownOutside:i,onInteractOutside:s,defer:h}=t;if(!e)return;const c=I(e),L=G(e),g=U(L),m=ee(L);function b(a,l){if(!D(l)||!l.isConnected||P(e,l)||ne(e,a))return!1;const f=c.querySelector(`[aria-controls="${e.id}"]`);if(f){const A=q(f);if(C(a,A))return!1}const w=q(e);return C(a,w)?!1:!(n!=null&&n(l))}const v=new Set,T=J(e==null?void 0:e.getRootNode());function E(a){function l(f){var w;const A=h&&!$()?x:B=>B(),p=f??a,N=((w=p==null?void 0:p.composedPath)==null?void 0:w.call(p))??[p==null?void 0:p.target];A(()=>{const B=T?N[0]:k(a);if(!(!e||!b(a,B))){if(i||s){const _=M(i,s);e.addEventListener(F,_,{once:!0})}W(e,F,{bubbles:!1,cancelable:!0,detail:{originalEvent:p,contextmenu:Q(p),focusable:te(N),target:B}})}})}a.pointerType==="touch"?(v.forEach(f=>f()),v.add(O(c,"click",l,{once:!0})),v.add(m.addEventListener("click",l,{once:!0})),v.add(g.addEventListener("click",l,{once:!0}))):l()}const o=new Set,d=setTimeout(()=>{o.add(O(c,"pointerdown",E,!0)),o.add(m.addEventListener("pointerdown",E,!0)),o.add(g.addEventListener("pointerdown",E,!0))},0);function u(a){(h?x:l=>l())(()=>{const l=k(a);if(!(!e||!b(a,l))){if(r||s){const f=M(r,s);e.addEventListener(Y,f,{once:!0})}W(e,Y,{bubbles:!1,cancelable:!0,detail:{originalEvent:a,contextmenu:!1,focusable:R(l),target:l}})}})}return $()||(o.add(O(c,"focusin",u,!0)),o.add(m.addEventListener("focusin",u,!0)),o.add(g.addEventListener("focusin",u,!0))),()=>{clearTimeout(d),v.forEach(a=>a()),o.forEach(a=>a())}}function se(e,t){const{defer:n}=t,r=n?x:s=>s(),i=[];return i.push(r(()=>{const s=typeof e=="function"?e():e;i.push(ie(s,t))})),()=>{i.forEach(s=>s==null?void 0:s())}}function W(e,t,n){const r=e.ownerDocument.defaultView||window,i=new r.CustomEvent(t,n);return e.dispatchEvent(i)}function oe(e,t){const n=r=>{r.key==="Escape"&&(r.isComposing||t==null||t(r))};return O(I(e),"keydown",n,{capture:!0})}var X="layer:request-dismiss",y={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(e=>e.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(e){var t;const n=this.indexOf(e),r=this.topMostPointerBlockingLayer()?this.indexOf((t=this.topMostPointerBlockingLayer())==null?void 0:t.node):-1;return n<r},isTopMost(e){const t=this.layers[this.count()-1];return(t==null?void 0:t.node)===e},getNestedLayers(e){return Array.from(this.layers).slice(this.indexOf(e)+1)},getLayersByType(e){return this.layers.filter(t=>t.type===e)},getNestedLayersByType(e,t){const n=this.indexOf(e);return n===-1?[]:this.layers.slice(n+1).filter(r=>r.type===t)},getParentLayerOfType(e,t){const n=this.indexOf(e);if(!(n<=0))return this.layers.slice(0,n).reverse().find(r=>r.type===t)},countNestedLayersOfType(e,t){return this.getNestedLayersByType(e,t).length},isInNestedLayer(e,t){return this.getNestedLayers(e).some(n=>P(n.node,t))},isInBranch(e){return Array.from(this.branches).some(t=>P(t,e))},add(e){this.layers.push(e),this.syncLayers()},addBranch(e){this.branches.push(e)},remove(e){const t=this.indexOf(e);t<0||(t<this.count()-1&&this.getNestedLayers(e).forEach(n=>y.dismiss(n.node,e)),this.layers.splice(t,1),this.syncLayers())},removeBranch(e){const t=this.branches.indexOf(e);t>=0&&this.branches.splice(t,1)},syncLayers(){this.layers.forEach((e,t)=>{e.node.style.setProperty("--layer-index",`${t}`),e.node.removeAttribute("data-nested"),e.node.removeAttribute("data-has-nested"),this.getParentLayerOfType(e.node,e.type)&&e.node.setAttribute("data-nested",e.type);const n=this.countNestedLayersOfType(e.node,e.type);n>0&&e.node.setAttribute("data-has-nested",e.type),e.node.style.setProperty("--nested-layer-count",`${n}`)})},indexOf(e){return this.layers.findIndex(t=>t.node===e)},dismiss(e,t){const n=this.indexOf(e);if(n===-1)return;const r=this.layers[n];le(e,X,i=>{var s;(s=r.requestDismiss)==null||s.call(r,i),i.defaultPrevented||r==null||r.dismiss()}),ae(e,X,{originalLayer:e,targetLayer:t,originalIndex:n,targetIndex:t?this.indexOf(t):-1}),this.syncLayers()},clear(){this.remove(this.layers[0].node)}};function ae(e,t,n){const r=e.ownerDocument.defaultView||window,i=new r.CustomEvent(t,{cancelable:!0,bubbles:!0,detail:n});return e.dispatchEvent(i)}function le(e,t,n){e.addEventListener(t,n,{once:!0})}var H;function K(){y.layers.forEach(({node:e})=>{e.style.pointerEvents=y.isBelowPointerBlockingLayer(e)?"none":"auto"})}function ce(e){e.style.pointerEvents=""}function de(e,t){const n=I(e),r=[];return y.hasPointerBlockingLayer()&&!n.body.hasAttribute("data-inert")&&(H=document.body.style.pointerEvents,queueMicrotask(()=>{n.body.style.pointerEvents="none",n.body.setAttribute("data-inert","")})),t==null||t.forEach(i=>{const[s,h]=z(()=>{const c=i();return D(c)?c:null},{timeout:1e3});s.then(c=>r.push(Z(c,{pointerEvents:"auto"}))),r.push(h)}),()=>{y.hasPointerBlockingLayer()||(queueMicrotask(()=>{n.body.style.pointerEvents=H,n.body.removeAttribute("data-inert"),n.body.style.length===0&&n.body.removeAttribute("style")}),r.forEach(i=>i()))}}function ue(e,t){const{warnOnMissingNode:n=!0}=t;if(n&&!e){j("[@zag-js/dismissable] node is `null` or `undefined`");return}if(!e)return;const{onDismiss:r,onRequestDismiss:i,pointerBlocking:s,exclude:h,debug:c,type:L="dialog"}=t,g={dismiss:r,node:e,type:L,pointerBlocking:s,requestDismiss:i};y.add(g),K();function m(o){var d,u;const a=k(o.detail.originalEvent);y.isBelowPointerBlockingLayer(e)||y.isInBranch(a)||((d=t.onPointerDownOutside)==null||d.call(t,o),(u=t.onInteractOutside)==null||u.call(t,o),!o.defaultPrevented&&(c&&console.log("onPointerDownOutside:",o.detail.originalEvent),r==null||r()))}function b(o){var d,u;const a=k(o.detail.originalEvent);y.isInBranch(a)||((d=t.onFocusOutside)==null||d.call(t,o),(u=t.onInteractOutside)==null||u.call(t,o),!o.defaultPrevented&&(c&&console.log("onFocusOutside:",o.detail.originalEvent),r==null||r()))}function v(o){var d;y.isTopMost(e)&&((d=t.onEscapeKeyDown)==null||d.call(t,o),!o.defaultPrevented&&r&&(o.preventDefault(),r()))}function T(o){var d;if(!e)return!1;const u=typeof h=="function"?h():h,a=Array.isArray(u)?u:[u],l=(d=t.persistentElements)==null?void 0:d.map(f=>f()).filter(D);return l&&a.push(...l),a.some(f=>P(f,o))||y.isInNestedLayer(e,o)}const E=[s?de(e,t.persistentElements):void 0,oe(e,v),se(e,{exclude:T,onFocusOutside:b,onPointerDownOutside:m,defer:t.defer})];return()=>{y.remove(e),K(),ce(e),E.forEach(o=>o==null?void 0:o())}}function ye(e,t){const{defer:n}=t,r=n?x:s=>s(),i=[];return i.push(r(()=>{const s=V(e)?e():e;i.push(ue(s,t))})),()=>{i.forEach(s=>s==null?void 0:s())}}export{ye as y};
