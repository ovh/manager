import{j as E}from"./jsx-runtime-BRNY0I4F.js";import{c as H}from"./clsx-B-dksMZM.js";import{t as Y}from"./Icon-DrfG5m-t-DQEf1CkA.js";import{l as tt}from"./ods-react60-0db41gCx.js";import{a as et}from"./ods-react236-aAAP9SXj.js";import{x as b,t as rt}from"./Button-BC-ipw2F-CXZv4wj7.js";import{f as at,s as ot}from"./Spinner-CV0M2r8z-14hgiywo.js";import{f as st,D as it,g as nt,e as ut,b as lt}from"./DrawerTrigger-omPTo2Bn-DB5oJcOC.js";import{o as ct}from"./ods-react235-BTQ8kVBe.js";import{h as mt,I as _t,M as dt}from"./TooltipTrigger-Iu3rt7LP-CcHcHvx1.js";import{k as pt}from"./QueryClientProvider-BPX08D6Z.js";import{r as g}from"./index-Bnop-kX6.js";import{_ as m}from"./iframe-CveYUpa2.js";import{b as M,r as _}from"./TranslationHelper-CuIWJbDW.js";import"./index-4pTrEEYx.js";import{F as L,e as j,l as ft,f as J,j as gt,k as ht,m as Et,v as Pt,i as yt,u as Q}from"./index-DnqQo6oJ.js";const Dt=t=>{const r=new Map;return t.forEach(a=>{a.tags&&Object.entries(a.tags).forEach(([e,o])=>{var s;e.startsWith("ovh:")||(r.has(e)?(s=r.get(e))==null||s.add(o):r.set(e,new Set([o])))})}),Array.from(r.entries()).map(([a,e])=>({key:a,values:Array.from(e)}))},It=10,q={isLoading:!1,isError:!1,error:null,isSuccess:!1,isFetching:!1,status:"pending",fetchNextPage:()=>{},hasNextPage:!1,isFetchingNextPage:!1,pageIndex:0,totalCount:0,flattenData:[]},k=(t,r)=>t.key===r.key&&t.value===r.value&&t.comparator===r.comparator,vt={de_DE:()=>_(m(()=>import("./Messages_de_DE-DMmsU-iZ.js"),[],import.meta.url)),en_GB:()=>_(m(()=>import("./Messages_en_GB-B-CtUu3R.js"),[],import.meta.url)),es_ES:()=>_(m(()=>import("./Messages_es_ES-DiGaVzfC.js"),[],import.meta.url)),fr_CA:()=>_(m(()=>import("./Messages_fr_CA-DZWsQWuS.js"),[],import.meta.url)),fr_FR:()=>_(m(()=>import("./Messages_fr_FR-DZWsQWuS.js"),[],import.meta.url)),it_IT:()=>_(m(()=>import("./Messages_it_IT-CW4N08oF.js"),[],import.meta.url)),pl_PL:()=>_(m(()=>import("./Messages_pl_PL-CxpRmwX5.js"),[],import.meta.url)),pt_PT:()=>_(m(()=>import("./Messages_pt_PT-DmK6yNEQ.js"),[],import.meta.url))};M(vt,"filters");function St(){const[t,r]=g.useState([]);return{filters:t,addFilter:a=>{(a.value||a.type===L.Tags&&[j.TagExists,j.TagNotExists].includes(a.comparator))&&r(e=>e.some(o=>k(o,a))?e:[...e,a])},removeFilter:a=>{r(e=>e.filter(o=>!k(o,a)))}}}const U=({defaultSorting:t,columns:r=[]})=>{const[a,e]=g.useState(""),[o,s]=g.useState([]),[n,i]=g.useState(t),{filters:l,addFilter:u,removeFilter:f}=St(),p=g.useMemo(()=>r.filter(c=>c.isSearchable),[r]),d=g.useCallback(c=>{if(!c){s([]);return}const v=p.filter(P=>!!P.id).map(({id:P})=>({key:P,value:c,comparator:j.Includes}));s(v)},[p]);return{searchInput:a,setSearchInput:e,searchFilters:o,setSearchFilters:s,sorting:n,setSorting:i,filters:l,addFilter:u,removeFilter:f,onSearch:d}},K=({initialPageParam:t,cacheKey:r,enabled:a,fetchDataFn:e,getNextPageParam:o,transformFn:s})=>{const{data:n={},error:i,isError:l,isFetching:u,isLoading:f,isSuccess:p,status:d,fetchNextPage:c,isFetchingNextPage:v,hasNextPage:P}=ft({initialPageParam:t,queryKey:r,staleTime:1/0,retry:!1,enabled:a,queryFn:y=>e({pageParam:y.pageParam}),getNextPageParam:(y,S,T)=>o(y,T),select:y=>s(y.pages,y.pageParams)});return{data:n,error:i,isError:l,isFetching:u,isLoading:f,isSuccess:p,status:d,fetchNextPage:c,isFetchingNextPage:v,hasNextPage:P}},Tt=({cacheKey:t,fetchDataFn:r,refetchInterval:a,enabled:e})=>{const{data:o={},error:s,isError:n,isFetching:i,isLoading:l,isSuccess:u,status:f}=J({queryKey:t,queryFn:()=>r(),refetchInterval:a,enabled:e,retry:!1});return{data:o,error:s,isError:n,isFetching:i,isLoading:l,isSuccess:u,status:f}},xt=4999,At=({version:t="v6",route:r="",pageSize:a=It,cacheKey:e,defaultSorting:o=void 0,fetchAll:s=!1,columns:n=[],disableCache:i,enabled:l=!0})=>{const u=U({defaultSorting:o,columns:n}),{searchInput:f,setSearchInput:p,searchFilters:d,sorting:c,setSorting:v,filters:P,addFilter:y,removeFilter:S,onSearch:T}=u,{data:F,hasNextPage:V,fetchNextPage:I,...N}=K({initialPageParam:1,cacheKey:[...typeof e=="string"?[e]:e??[],s?"all":String(a),JSON.stringify(c??[]),JSON.stringify(P??[]),JSON.stringify(d??[])],enabled:l,fetchDataFn:({pageParam:h})=>{var D,x;return gt({version:t,route:r,pageSize:s?xt:a,...typeof h=="number"&&{page:h},sortBy:(D=c==null?void 0:c[0])==null?void 0:D.id,sortOrder:(x=c==null?void 0:c[0])!=null&&x.desc?"DESC":"ASC",filters:d?[...d,...P]:P,disableCache:i})},getNextPageParam:(h,D)=>h.totalCount/a>D?D+1:null,transformFn:(h,D)=>{var A;const x=D[D.length-1]??1,C=((A=h[0])==null?void 0:A.totalCount)??0;return{pageIndex:x,totalCount:C,flattenData:h.flatMap(O=>O.data)}}});return g.useEffect(()=>{s&&V&&l&&I()},[F,s,V,I,l]),l?{...F&&{...F},hasNextPage:V,fetchNextPage:I,sorting:{sorting:c??[],setSorting:h=>v(typeof h=="function"?D=>h(D??[]):h??[]),manualSorting:!0},filters:{filters:P,add:y,remove:S},search:{onSearch:T,searchInput:f,setSearchInput:p},...N}:{...q,sorting:{sorting:[],setSorting:()=>{},manualSorting:!1}}},Lt=({route:t="",pageSize:r=10,fetchAll:a=!1,cacheKey:e,enabled:o})=>{const{data:s,hasNextPage:n,fetchNextPage:i,...l}=K({initialPageParam:"",cacheKey:[...e,a?"all":String(r)],enabled:o??!0,fetchDataFn:({pageParam:u})=>ht({route:t,pageSize:r,...!!u&&typeof u=="string"&&{cursor:u}}),getNextPageParam:u=>u.nextCursor?u.nextCursor:null,transformFn:u=>{const{totalCount:f}=u[0];return{flattenData:u.flatMap(p=>p.data),totalCount:f}}});return g.useEffect(()=>{a&&n&&o&&i()},[s,a,n,i,o]),o?{...s&&{...s},hasNextPage:n,fetchNextPage:i,...l}:q},$=t=>t==="true",Ft=(t,r,a,e)=>{var n,i;if(!r||!a)return-1;const o=e?a:r,s=e?r:a;switch(t){case L.Numeric:return parseFloat(o)-parseFloat(s);case L.Date:return new Date(o).getTime()-new Date(s).getTime();case L.Boolean:return Number($(o))-Number($(s));case L.String:return(i=(n=o==null?void 0:o.trim().toLowerCase())==null?void 0:n.localeCompare)==null?void 0:i.call(n,s==null?void 0:s.trim().toLowerCase());default:return-1}};function G(t){if(t==null)return"";switch(typeof t){case"string":return t;case"number":case"boolean":case"bigint":case"symbol":case"object":try{return JSON.stringify(t)}catch{return""}default:return""}}const Vt=({items:t=[],filters:r,searchFilters:a,sorting:e,columns:o})=>{const s=g.useMemo(()=>!r.length&&!a.length?t??[]:Et(t??[],[...r,...a]),[t,r,a]);return{filteredAndSortedData:g.useMemo(()=>{var p;if(!(e!=null&&e.length))return s;const i=e[0]??{},l=i.id,u=i.desc??!1;if(!l)return s;const f=((p=o.find(d=>d.id===l))==null?void 0:p.type)??L.String;return[...s].sort((d,c)=>Ft(f,G(d[l]),G(c[l]),u))},[s,e,o])}},Rt=({route:t="",cacheKey:r,fetchDataFn:a,refetchInterval:e,pageSize:o=10,columns:s=[],defaultSorting:n,enabled:i=!0})=>{const{searchInput:l,setSearchInput:u,searchFilters:f,sorting:p,setSorting:d,filters:c,addFilter:v,removeFilter:P,onSearch:y}=U({defaultSorting:n,columns:s}),[S,T]=g.useState(0),[F,V]=g.useState(0),[I,N]=g.useState([]),{data:h,error:D,isError:x,isFetching:C,isLoading:A,isSuccess:O,status:W}=Tt({cacheKey:[r],fetchDataFn:()=>a?a(t):Pt.get(t),refetchInterval:e||!1,enabled:i}),{filteredAndSortedData:w}=Vt({items:h==null?void 0:h.data,columns:s,filters:c,searchFilters:f,sorting:p});g.useEffect(()=>{!A&&i&&(V(w.length),T(0),N(w))},[w,A,i]);const Z=g.useCallback(()=>T(R=>R+1),[]);return i?{error:D,isError:x,isFetching:C,isSuccess:O,status:W,isLoading:A,pageIndex:S,totalCount:F,flattenData:I==null?void 0:I.slice(0,(S+1)*o),hasNextPage:S*o+o<(I==null?void 0:I.length),fetchNextPage:Z,sorting:{sorting:p??[],setSorting:R=>d(typeof R=="function"?X=>R(X??[]):R??[]),manualSorting:!0},filters:{filters:c,add:v,remove:P},search:{onSearch:y,searchInput:l,setSearchInput:u}}:{...q,sorting:{sorting:[],setSorting:()=>{},manualSorting:!1}}},Nt=({route:t="",version:r="v6",iceberg:a,pageSize:e,cacheKey:o,fetchDataFn:s,refetchInterval:n,defaultSorting:i,fetchAll:l,columns:u=[],disableCache:f,enabled:p})=>{const d=!!a,c=!d&&r==="v2",v=!d&&!c,P=At({version:r,route:t,pageSize:e,cacheKey:o,enabled:!!(p&&d),defaultSorting:i??[],fetchAll:l,columns:u,disableCache:f}),y=Lt({route:t,pageSize:e,enabled:!!(p&&c),cacheKey:o,fetchAll:l}),S=Rt({route:t,cacheKey:o,fetchDataFn:s,refetchInterval:n,enabled:!!(p&&v),pageSize:e,columns:u,defaultSorting:i});return d?P:c?y:S};function Ct(t){return`/iam/resource/${encodeURIComponent(t)}/authorization/check`}const Ot=async(t,r)=>(await yt.v2.post(Ct(r),{actions:t})).data;function wt(t,r,a=!0){const{data:e,isLoading:o,isError:s,isFetching:n,refetch:i,status:l,error:u}=J({queryKey:["iam-authorization",r,t],queryFn:()=>Ot(t,r),enabled:!!(r&&r.length>0&&t&&t.length>0&&a),placeholderData:pt});return{isAuthorized:!!(e!=null&&e.authorizedActions)&&t.every(p=>{var d;return(d=e==null?void 0:e.authorizedActions)==null?void 0:d.includes(p)}),data:e,isLoading:o,isError:s,isFetching:n,refetch:i,status:l,error:u}}function te({resourceType:t,enabled:r=!0}){let a="/iam/resource";t&&(a=`${a}?resourceType=${t}`);const{flattenData:e,isError:o,isLoading:s}=Nt({version:"v2",iceberg:!0,route:a,cacheKey:["iam/resource",t||""],enabled:r,fetchAll:!0});return{tags:g.useMemo(()=>e?Dt(e):[],[e]),isError:o,isLoading:s}}const bt={de_DE:()=>_(m(()=>import("./Messages_de_DE-D6eaGZhM.js"),[],import.meta.url)),en_GB:()=>_(m(()=>import("./Messages_en_GB-v5ik8MVv.js"),[],import.meta.url)),es_ES:()=>_(m(()=>import("./Messages_es_ES-Cw1e7UdN.js"),[],import.meta.url)),fr_CA:()=>_(m(()=>import("./Messages_fr_CA-BygpM1se.js"),[],import.meta.url)),fr_FR:()=>_(m(()=>import("./Messages_fr_FR-BygpM1se.js"),[],import.meta.url)),it_IT:()=>_(m(()=>import("./Messages_it_IT-CC7b0OgL.js"),[],import.meta.url)),pl_PL:()=>_(m(()=>import("./Messages_pl_PL-B2f0pp2L.js"),[],import.meta.url)),pt_PT:()=>_(m(()=>import("./Messages_pt_PT-D6SX8-Eo.js"),[],import.meta.url))};M(bt,"iam");const B=({children:t,iamActions:r,urn:a,displayTooltip:e=!0,tooltipPosition:o=ct.bottom,...s})=>{const{t:n}=Q("iam"),{isAuthorized:i}=wt(r||[],a||"");return i||!(r&&a)?E.jsx(b,{"data-testid":"manager-button",...s,children:t}):e?E.jsxs(mt,{position:o,children:[E.jsx(_t,{"data-testid":"manager-button-tooltip",asChild:!0,children:E.jsx(b,{"data-testid":"manager-button-tooltip",...s,disabled:!0,children:t})}),E.jsx(dt,{children:n("common_iam_actions_message")})]}):E.jsx(b,{"data-testid":"manager-button-without-tooltip",...s,disabled:!0,children:t})};try{B.displayName="Button",B.__docgenInfo={description:"",displayName:"Button",props:{}}}catch{}const jt={de_DE:()=>_(m(()=>import("./Messages_de_DE-wV6iqazs.js"),[],import.meta.url)),en_GB:()=>_(m(()=>import("./Messages_en_GB-BZXjAwVZ.js"),[],import.meta.url)),es_ES:()=>_(m(()=>import("./Messages_es_ES-CG-rqwH1.js"),[],import.meta.url)),fr_CA:()=>_(m(()=>import("./Messages_fr_CA-BC5dFmG2.js"),[],import.meta.url)),fr_FR:()=>_(m(()=>import("./Messages_fr_FR-BC5dFmG2.js"),[],import.meta.url)),it_IT:()=>_(m(()=>import("./Messages_it_IT-BvpB8PHM.js"),[],import.meta.url)),pl_PL:()=>_(m(()=>import("./Messages_pl_PL-5NJ1ki9l.js"),[],import.meta.url)),pt_PT:()=>_(m(()=>import("./Messages_pt_PT-Hfz_XHs8.js"),[],import.meta.url))};M(jt,"drawer");const z=({children:t,createPortal:r,isOpen:a,isLoading:e,onDismiss:o,className:s,trigger:n})=>{const{t:i}=Q("drawer");return E.jsxs(st,{open:a,onOpenChange:o,children:[n&&E.jsx(it,{children:n}),E.jsx(nt,{"data-testid":"drawer",createPortal:r,position:ut.right,className:H("w-full sm:w-[var(--mrc-drawer-width)] max-w-full p-0 overflow-hidden",s),children:E.jsx(lt,{children:E.jsxs("div",{className:"h-screen overflow-hidden flex flex-col justify-between",children:[E.jsx(B,{"data-testid":"drawer-dismiss-button","aria-label":i("close"),onClick:o,color:et.primary,variant:rt.ghost,className:"absolute top-7 right-4",children:E.jsx(Y,{name:tt.xmark})}),e&&E.jsx("div",{"data-testid":"drawer-spinner",className:"h-full flex justify-center items-center",children:E.jsx(at,{size:ot.md})}),!e&&t]})})})]})};try{z.displayName="DrawerBase",z.__docgenInfo={description:"",displayName:"DrawerBase",props:{isOpen:{defaultValue:null,description:"Open/close the drawer (default to true)",name:"isOpen",required:!1,type:{name:"boolean"}},onDismiss:{defaultValue:null,description:"Callback function to be called on close of the Drawer",name:"onDismiss",required:!0,type:{name:"() => void"}},isLoading:{defaultValue:null,description:"Show a loader instead of the drawer content",name:"isLoading",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"Class name for the drawer",name:"className",required:!1,type:{name:"string"}},createPortal:{defaultValue:null,description:"Create a portal for the drawer",name:"createPortal",required:!1,type:{name:"boolean"}},trigger:{defaultValue:null,description:"Trigger for the drawer",name:"trigger",required:!1,type:{name:"ReactNode"}}}}}catch{}export{B,z as D,te as a,wt as u};
