import{j as P}from"./jsx-runtime-BRNY0I4F.js";import{c as rt}from"./clsx-B-dksMZM.js";import{t as at}from"./Icon-DrfG5m-t-DQEf1CkA.js";import{l as st}from"./Link-BWQEuWpd-D0wspT2_.js";import{a as ot}from"./Divider-THit99OS-Di1FabXz.js";import{x as O,q as it,I as nt,M as ut,o as lt,Y as ct,a0 as mt,a1 as _t,a2 as dt,a3 as pt,a as ft,k as gt,l as ht}from"./ComboboxControl-sJOkWHeT-8SVRT3vS.js";import{k as Et}from"./QueryClientProvider-BPX08D6Z.js";import{r as f}from"./index-Bnop-kX6.js";import{_ as m}from"./iframe-Bru3zJiY.js";import{b as B,r as _}from"./TranslationHelper-CuIWJbDW.js";import"./index-4pTrEEYx.js";import{c as F,b as w,r as Pt,m as z,p as Dt,q as It,a as yt,v as vt,o as St,u as J}from"./with-selector-CbDTc_Tw.js";const Tt=t=>{const r=new Map;return t.forEach(a=>{a.tags&&Object.entries(a.tags).forEach(([e,s])=>{var o;e.startsWith("ovh:")||(r.has(e)?(o=r.get(e))==null||o.add(s):r.set(e,new Set([s])))})}),Array.from(r.entries()).map(([a,e])=>({key:a,values:Array.from(e)}))},xt=10,k={isLoading:!1,isError:!1,error:null,isSuccess:!1,isFetching:!1,status:"pending",fetchNextPage:()=>{},hasNextPage:!1,isFetchingNextPage:!1,pageIndex:0,totalCount:0,flattenData:[]},q=(t,r)=>t.key===r.key&&t.value===r.value&&t.comparator===r.comparator,At={de_DE:()=>_(m(()=>import("./Messages_de_DE-CR22mOzJ.js"),[],import.meta.url)),en_GB:()=>_(m(()=>import("./Messages_en_GB-Db8Mg1i8.js"),[],import.meta.url)),es_ES:()=>_(m(()=>import("./Messages_es_ES-CvYMLDyG.js"),[],import.meta.url)),fr_CA:()=>_(m(()=>import("./Messages_fr_CA-D5SbvSlA.js"),[],import.meta.url)),fr_FR:()=>_(m(()=>import("./Messages_fr_FR-D5SbvSlA.js"),[],import.meta.url)),it_IT:()=>_(m(()=>import("./Messages_it_IT-CUeK1hf8.js"),[],import.meta.url)),pl_PL:()=>_(m(()=>import("./Messages_pl_PL-CZhj8TKK.js"),[],import.meta.url)),pt_PT:()=>_(m(()=>import("./Messages_pt_PT-DuA0Cdyk.js"),[],import.meta.url))};B(At,"filters");function Lt(){const[t,r]=f.useState([]);return{filters:t,addFilter:a=>{(a.value||a.type===F.Tags&&[w.TagExists,w.TagNotExists].includes(a.comparator))&&r(e=>e.some(s=>q(s,a))?e:[...e,a])},removeFilter:a=>{r(e=>e.filter(s=>!q(s,a)))}}}const Q=({defaultSorting:t,columns:r=[]})=>{const[a,e]=f.useState(""),[s,o]=f.useState([]),[n,i]=f.useState(t),{filters:l,addFilter:u,removeFilter:g}=Lt(),p=f.useMemo(()=>r.filter(c=>c.isSearchable),[r]),d=f.useCallback(c=>{if(!c){o([]);return}const v=p.filter(h=>!!h.id).map(({id:h})=>({key:h,value:c,comparator:w.Includes}));o(v)},[p]);return{searchInput:a,setSearchInput:e,searchFilters:s,setSearchFilters:o,sorting:n,setSorting:i,filters:l,addFilter:u,removeFilter:g,onSearch:d}},U=({initialPageParam:t,cacheKey:r,enabled:a,fetchDataFn:e,getNextPageParam:s,transformFn:o})=>{const{data:n={},error:i,isError:l,isFetching:u,isLoading:g,isSuccess:p,status:d,fetchNextPage:c,isFetchingNextPage:v,hasNextPage:h}=Pt({initialPageParam:t,queryKey:r,staleTime:1/0,retry:!1,enabled:a,queryFn:D=>e({pageParam:D.pageParam}),getNextPageParam:(D,T,S)=>s(D,S),select:D=>o(D.pages,D.pageParams)});return{data:n,error:i,isError:l,isFetching:u,isLoading:g,isSuccess:p,status:d,fetchNextPage:c,isFetchingNextPage:v,hasNextPage:h}},Ft=({cacheKey:t,fetchDataFn:r,refetchInterval:a,enabled:e})=>{const{data:s={},error:o,isError:n,isFetching:i,isLoading:l,isSuccess:u,status:g}=z({queryKey:t,queryFn:()=>r(),refetchInterval:a,enabled:e,retry:!1});return{data:s,error:o,isError:n,isFetching:i,isLoading:l,isSuccess:u,status:g}},Ct=4999,Vt=({version:t="v6",route:r="",pageSize:a=xt,cacheKey:e,defaultSorting:s=void 0,fetchAll:o=!1,columns:n=[],disableCache:i,enabled:l=!0})=>{const u=Q({defaultSorting:s,columns:n}),{searchInput:g,setSearchInput:p,searchFilters:d,sorting:c,setSorting:v,filters:h,addFilter:D,removeFilter:T,onSearch:S}=u,{data:x,hasNextPage:C,fetchNextPage:V,...R}=U({initialPageParam:1,cacheKey:[...typeof e=="string"?[e]:e??[],o?"all":String(a),JSON.stringify(c??[]),JSON.stringify(h??[]),JSON.stringify(d??[])],enabled:l,fetchDataFn:({pageParam:E})=>{var y,A;return Dt({version:t,route:r,pageSize:o?Ct:a,...typeof E=="number"&&{page:E},sortBy:(y=c==null?void 0:c[0])==null?void 0:y.id,sortOrder:(A=c==null?void 0:c[0])!=null&&A.desc?"DESC":"ASC",filters:d?[...d,...h]:h,disableCache:i})},getNextPageParam:(E,y)=>E.totalCount/a>y?y+1:null,transformFn:(E,y)=>{var L;const A=y[y.length-1]??1,b=((L=E[0])==null?void 0:L.totalCount)??0;return{pageIndex:A,totalCount:b,flattenData:E.flatMap(N=>N.data)}}});return f.useEffect(()=>{o&&C&&l&&V()},[x,o,C,V,l]),l?{...x&&{...x},hasNextPage:C,fetchNextPage:V,sorting:{sorting:c??[],setSorting:E=>v(typeof E=="function"?y=>E(y??[]):E??[]),manualSorting:!0},filters:{filters:h,add:D,remove:T},search:{onSearch:S,searchInput:g,setSearchInput:p},...R}:{...k,sorting:{sorting:[],setSorting:()=>{},manualSorting:!1}}},bt=({route:t="",pageSize:r=10,fetchAll:a=!1,cacheKey:e,enabled:s})=>{const{data:o,hasNextPage:n,fetchNextPage:i,...l}=U({initialPageParam:"",cacheKey:[...e,a?"all":String(r)],enabled:s??!0,fetchDataFn:({pageParam:u})=>It({route:t,pageSize:r,...!!u&&typeof u=="string"&&{cursor:u}}),getNextPageParam:u=>u.nextCursor?u.nextCursor:null,transformFn:u=>{const{totalCount:g}=u[0];return{flattenData:u.flatMap(p=>p.data),totalCount:g}}});return f.useEffect(()=>{a&&n&&s&&i()},[o,a,n,i,s]),s?{...o&&{...o},hasNextPage:n,fetchNextPage:i,...l}:k},M=t=>t==="true",Rt=(t,r,a,e)=>{var n,i;if(!r||!a)return-1;const s=e?a:r,o=e?r:a;switch(t){case F.Numeric:return parseFloat(s)-parseFloat(o);case F.Date:return new Date(s).getTime()-new Date(o).getTime();case F.Boolean:return Number(M(s))-Number(M(o));case F.String:return(i=(n=s==null?void 0:s.trim().toLowerCase())==null?void 0:n.localeCompare)==null?void 0:i.call(n,o==null?void 0:o.trim().toLowerCase());default:return-1}};function $(t){if(t==null)return"";switch(typeof t){case"string":return t;case"number":case"boolean":case"bigint":case"symbol":case"object":try{return JSON.stringify(t)}catch{return""}default:return""}}const Nt=({items:t=[],filters:r,searchFilters:a,sorting:e,columns:s})=>{const o=f.useMemo(()=>!r.length&&!a.length?t??[]:yt(t??[],[...r,...a]),[t,r,a]);return{filteredAndSortedData:f.useMemo(()=>{var p;if(!(e!=null&&e.length))return o;const i=e[0]??{},l=i.id,u=i.desc??!1;if(!l)return o;const g=((p=s.find(d=>d.id===l))==null?void 0:p.type)??F.String;return[...o].sort((d,c)=>Rt(g,$(d[l]),$(c[l]),u))},[o,e,s])}},Ot=({route:t="",cacheKey:r,fetchDataFn:a,refetchInterval:e,pageSize:s=10,columns:o=[],defaultSorting:n,enabled:i=!0})=>{const{searchInput:l,setSearchInput:u,searchFilters:g,sorting:p,setSorting:d,filters:c,addFilter:v,removeFilter:h,onSearch:D}=Q({defaultSorting:n,columns:o}),[T,S]=f.useState(0),{data:x,error:C,isError:V,isFetching:R,isLoading:E,isSuccess:y,status:A}=Ft({cacheKey:[r],fetchDataFn:()=>a?a(t):vt.get(t),refetchInterval:e||!1,enabled:i}),{filteredAndSortedData:b}=Nt({items:x==null?void 0:x.data,columns:o,filters:c,searchFilters:g,sorting:p}),L=f.useMemo(()=>i&&!E?b:[],[i,E,b]),N=L.length,K=f.useCallback(()=>{S(I=>I+1)},[]),W=f.useCallback(I=>{S(0),d(typeof I=="function"?et=>I(et??[]):I??[])},[d]),Z=f.useCallback((...I)=>{S(0),v(...I)},[v]),X=f.useCallback((...I)=>{S(0),h(...I)},[h]),Y=f.useCallback((...I)=>{S(0),D(...I)},[D]),H=f.useCallback((...I)=>{S(0),u(...I)},[u]);if(!i)return{...k,sorting:{sorting:[],setSorting:()=>{},manualSorting:!1}};const tt=L.slice(0,(T+1)*s);return{error:C,isError:V,isFetching:R,isSuccess:y,status:A,isLoading:E,pageIndex:T,totalCount:N,flattenData:tt,hasNextPage:T*s+s<L.length,fetchNextPage:K,sorting:{sorting:p??[],setSorting:W,manualSorting:!0},filters:{filters:c,add:Z,remove:X},search:{onSearch:Y,searchInput:l,setSearchInput:H}}},wt=({route:t="",version:r="v6",iceberg:a,pageSize:e,cacheKey:s,fetchDataFn:o,refetchInterval:n,defaultSorting:i,fetchAll:l,columns:u=[],disableCache:g,enabled:p})=>{const d=!!a,c=!d&&r==="v2",v=!d&&!c,h=Vt({version:r,route:t,pageSize:e,cacheKey:s,enabled:!!(p&&d),defaultSorting:i??[],fetchAll:l,columns:u,disableCache:g}),D=bt({route:t,pageSize:e,enabled:!!(p&&c),cacheKey:s,fetchAll:l}),T=Ot({route:t,cacheKey:s,fetchDataFn:o,refetchInterval:n,enabled:!!(p&&v),pageSize:e,columns:u,defaultSorting:i});return d?h:c?D:T};function jt(t){return`/iam/resource/${encodeURIComponent(t)}/authorization/check`}const Bt=async(t,r)=>(await St.v2.post(jt(r),{actions:t})).data;function kt(t,r,a=!0){const{data:e,isLoading:s,isError:o,isFetching:n,refetch:i,status:l,error:u}=z({queryKey:["iam-authorization",r,t],queryFn:()=>Bt(t,r),enabled:!!(r&&r.length>0&&t&&t.length>0&&a),placeholderData:Et});return{isAuthorized:!!(e!=null&&e.authorizedActions)&&t.every(p=>{var d;return(d=e==null?void 0:e.authorizedActions)==null?void 0:d.includes(p)}),data:e,isLoading:s,isError:o,isFetching:n,refetch:i,status:l,error:u}}function te({resourceType:t,enabled:r=!0}){let a="/iam/resource";t&&(a=`${a}?resourceType=${t}`);const{flattenData:e,isError:s,isLoading:o}=wt({version:"v2",iceberg:!0,route:a,cacheKey:["iam/resource",t||""],enabled:r,fetchAll:!0});return{tags:f.useMemo(()=>e?Tt(e):[],[e]),isError:s,isLoading:o}}const qt={de_DE:()=>_(m(()=>import("./Messages_de_DE-D6eaGZhM.js"),[],import.meta.url)),en_GB:()=>_(m(()=>import("./Messages_en_GB-v5ik8MVv.js"),[],import.meta.url)),es_ES:()=>_(m(()=>import("./Messages_es_ES-Cw1e7UdN.js"),[],import.meta.url)),fr_CA:()=>_(m(()=>import("./Messages_fr_CA-BygpM1se.js"),[],import.meta.url)),fr_FR:()=>_(m(()=>import("./Messages_fr_FR-BygpM1se.js"),[],import.meta.url)),it_IT:()=>_(m(()=>import("./Messages_it_IT-CC7b0OgL.js"),[],import.meta.url)),pl_PL:()=>_(m(()=>import("./Messages_pl_PL-B2f0pp2L.js"),[],import.meta.url)),pt_PT:()=>_(m(()=>import("./Messages_pt_PT-D6SX8-Eo.js"),[],import.meta.url))};B(qt,"iam");const j=({children:t,iamActions:r,urn:a,displayTooltip:e=!0,tooltipPosition:s=lt.bottom,...o})=>{const{t:n}=J("iam"),{isAuthorized:i}=kt(r||[],a||"");return i||!(r&&a)?P.jsx(O,{"data-testid":"manager-button",...o,children:t}):e?P.jsxs(it,{position:s,children:[P.jsx(nt,{"data-testid":"manager-button-tooltip",asChild:!0,children:P.jsx(O,{"data-testid":"manager-button-tooltip",...o,disabled:!0,children:t})}),P.jsx(ut,{children:n("common_iam_actions_message")})]}):P.jsx(O,{"data-testid":"manager-button-without-tooltip",...o,disabled:!0,children:t})};try{j.displayName="Button",j.__docgenInfo={description:"",displayName:"Button",props:{}}}catch{}const Mt={de_DE:()=>_(m(()=>import("./Messages_de_DE-wV6iqazs.js"),[],import.meta.url)),en_GB:()=>_(m(()=>import("./Messages_en_GB-BZXjAwVZ.js"),[],import.meta.url)),es_ES:()=>_(m(()=>import("./Messages_es_ES-CG-rqwH1.js"),[],import.meta.url)),fr_CA:()=>_(m(()=>import("./Messages_fr_CA-BC5dFmG2.js"),[],import.meta.url)),fr_FR:()=>_(m(()=>import("./Messages_fr_FR-BC5dFmG2.js"),[],import.meta.url)),it_IT:()=>_(m(()=>import("./Messages_it_IT-BvpB8PHM.js"),[],import.meta.url)),pl_PL:()=>_(m(()=>import("./Messages_pl_PL-5NJ1ki9l.js"),[],import.meta.url)),pt_PT:()=>_(m(()=>import("./Messages_pt_PT-Hfz_XHs8.js"),[],import.meta.url))};B(Mt,"drawer");const G=({children:t,createPortal:r,isOpen:a,isLoading:e,onDismiss:s,className:o,trigger:n})=>{const{t:i}=J("drawer");return P.jsxs(ct,{open:a,onOpenChange:s,children:[n&&P.jsx(mt,{children:n}),P.jsx(_t,{"data-testid":"drawer",createPortal:r,position:dt.right,className:rt("w-full sm:w-[var(--mrc-drawer-width)] max-w-full p-0 overflow-hidden",o),children:P.jsx(pt,{children:P.jsxs("div",{className:"h-screen overflow-hidden flex flex-col justify-between",children:[P.jsx(j,{"data-testid":"drawer-dismiss-button","aria-label":i("close"),onClick:s,color:ot.primary,variant:ft.ghost,className:"absolute top-7 right-4",children:P.jsx(at,{name:st.xmark})}),e&&P.jsx("div",{"data-testid":"drawer-spinner",className:"h-full flex justify-center items-center",children:P.jsx(gt,{size:ht.md})}),!e&&t]})})})]})};try{G.displayName="DrawerBase",G.__docgenInfo={description:"",displayName:"DrawerBase",props:{isOpen:{defaultValue:null,description:"Open/close the drawer (default to true)",name:"isOpen",required:!1,type:{name:"boolean"}},onDismiss:{defaultValue:null,description:"Callback function to be called on close of the Drawer",name:"onDismiss",required:!0,type:{name:"() => void"}},isLoading:{defaultValue:null,description:"Show a loader instead of the drawer content",name:"isLoading",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"Class name for the drawer",name:"className",required:!1,type:{name:"string"}},createPortal:{defaultValue:null,description:"Create a portal for the drawer",name:"createPortal",required:!1,type:{name:"boolean"}},trigger:{defaultValue:null,description:"Trigger for the drawer",name:"trigger",required:!1,type:{name:"ReactNode"}}}}}catch{}export{j as B,G as D,te as a,kt as u};
