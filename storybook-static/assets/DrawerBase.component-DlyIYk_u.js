import{j as E}from"./jsx-runtime-BRNY0I4F.js";import{c as X}from"./clsx-B-dksMZM.js";import{t as H}from"./Icon-DrfG5m-t-DQEf1CkA.js";import{l as Y}from"./ods-react60-0db41gCx.js";import{a as tt}from"./ods-react236-aAAP9SXj.js";import{x as N,t as et}from"./Button-BC-ipw2F-CXZv4wj7.js";import{f as rt,s as at}from"./Spinner-CV0M2r8z-14hgiywo.js";import{f as ot,D as st,g as it,e as nt,b as ut}from"./DrawerTrigger-omPTo2Bn-DB5oJcOC.js";import{o as lt}from"./ods-react235-BTQ8kVBe.js";import{h as ct,I as mt,M as dt}from"./TooltipTrigger-Iu3rt7LP-CcHcHvx1.js";import{k as _t}from"./QueryClientProvider-YWZt9LhG.js";import{r as g}from"./index-Bnop-kX6.js";import{_ as c}from"./iframe-D5tzyF_8.js";import{b as M,r as m}from"./TranslationHelper-CapMe45u.js";import"./index-4pTrEEYx.js";import{F as S,e as j,l as pt,f as z,j as ft,k as gt,m as ht,v as Et,i as Pt,u as J}from"./index-BvE2bIaB.js";const yt=t=>{const r=new Map;return t.forEach(a=>{a.tags&&Object.entries(a.tags).forEach(([e,s])=>{var o;e.startsWith("ovh:")||(r.has(e)?(o=r.get(e))==null||o.add(s):r.set(e,new Set([s])))})}),Array.from(r.entries()).map(([a,e])=>({key:a,values:Array.from(e)}))},q=(t,r)=>t.key===r.key&&t.value===r.value&&t.comparator===r.comparator,It={de_DE:()=>m(c(()=>import("./Messages_de_DE-DMmsU-iZ.js"),[],import.meta.url)),en_GB:()=>m(c(()=>import("./Messages_en_GB-B-CtUu3R.js"),[],import.meta.url)),es_ES:()=>m(c(()=>import("./Messages_es_ES-DiGaVzfC.js"),[],import.meta.url)),fr_CA:()=>m(c(()=>import("./Messages_fr_CA-DZWsQWuS.js"),[],import.meta.url)),fr_FR:()=>m(c(()=>import("./Messages_fr_FR-DZWsQWuS.js"),[],import.meta.url)),it_IT:()=>m(c(()=>import("./Messages_it_IT-CW4N08oF.js"),[],import.meta.url)),pl_PL:()=>m(c(()=>import("./Messages_pl_PL-CxpRmwX5.js"),[],import.meta.url)),pt_PT:()=>m(c(()=>import("./Messages_pt_PT-DmK6yNEQ.js"),[],import.meta.url))};M(It,"filters");function vt(){const[t,r]=g.useState([]);return{filters:t,addFilter:a=>{(a.value||a.type===S.Tags&&[j.TagExists,j.TagNotExists].includes(a.comparator))&&r(e=>e.some(s=>q(s,a))?e:[...e,a])},removeFilter:a=>{r(e=>e.filter(s=>!q(s,a)))}}}const Q=({defaultSorting:t,columns:r=[]})=>{const[a,e]=g.useState(""),[s,o]=g.useState([]),[i,n]=g.useState(t),{filters:d,addFilter:u,removeFilter:f}=vt(),p=g.useMemo(()=>r.filter(l=>l.isSearchable),[r]),_=g.useCallback(l=>{if(!l){o([]);return}const v=p.filter(P=>!!P.id).map(({id:P})=>({key:P,value:l,comparator:j.Includes}));o(v)},[p]);return{searchInput:a,setSearchInput:e,searchFilters:s,setSearchFilters:o,sorting:i,setSorting:n,filters:d,addFilter:u,removeFilter:f,onSearch:_}},K=({initialPageParam:t,cacheKey:r,enabled:a,fetchDataFn:e,getNextPageParam:s,transformFn:o})=>{const{data:i={},error:n,isError:d,isFetching:u,isLoading:f,isSuccess:p,status:_,fetchNextPage:l,isFetchingNextPage:v,hasNextPage:P}=pt({initialPageParam:t,queryKey:r,staleTime:1/0,retry:!1,enabled:a,queryFn:y=>e({pageParam:y.pageParam}),getNextPageParam:(y,D,x)=>s(y,x),select:y=>o(y.pages,y.pageParams)});return{data:i,error:n,isError:d,isFetching:u,isLoading:f,isSuccess:p,status:_,fetchNextPage:l,isFetchingNextPage:v,hasNextPage:P}},Dt=({cacheKey:t,fetchDataFn:r,refetchInterval:a,enabled:e})=>{const{data:s={},error:o,isError:i,isFetching:n,isLoading:d,isSuccess:u,status:f}=z({queryKey:t,queryFn:()=>r(),refetchInterval:a,enabled:e,retry:!1});return{data:s,error:o,isError:i,isFetching:n,isLoading:d,isSuccess:u,status:f}},Tt=10,xt=4999,At=({version:t="v6",route:r="",pageSize:a=Tt,cacheKey:e,defaultSorting:s=void 0,fetchAll:o=!1,columns:i=[],disableCache:n,enabled:d=!0})=>{const u=Q({defaultSorting:s,columns:i}),{searchInput:f,setSearchInput:p,searchFilters:_,sorting:l,setSorting:v,filters:P,addFilter:y,removeFilter:D,onSearch:x}=u,{data:L,hasNextPage:R,fetchNextPage:T,...F}=K({initialPageParam:1,cacheKey:[...typeof e=="string"?[e]:e??[],o?"all":String(a),JSON.stringify(l??[]),JSON.stringify(P??[]),JSON.stringify(_??[])],enabled:d,fetchDataFn:({pageParam:h})=>{var I,A;return ft({version:t,route:r,pageSize:o?xt:a,...typeof h=="number"&&{page:h},sortBy:(I=l==null?void 0:l[0])==null?void 0:I.id,sortOrder:(A=l==null?void 0:l[0])!=null&&A.desc?"DESC":"ASC",filters:_?[..._,...P]:P,disableCache:n})},getNextPageParam:(h,I)=>h.totalCount/a>I?I+1:null,transformFn:(h,I)=>{var b;const A=I[I.length-1]??1,w=((b=h[0])==null?void 0:b.totalCount)??0;return{pageIndex:A,totalCount:w,flattenData:h.flatMap(C=>C.data)}}});return g.useEffect(()=>{o&&R&&T()},[L]),{...L&&{...L},hasNextPage:R,fetchNextPage:T,sorting:{sorting:l??[],setSorting:h=>v(typeof h=="function"?I=>h(I??[]):h??[]),manualSorting:!0},filters:{filters:P,add:y,remove:D},search:{onSearch:x,searchInput:f,setSearchInput:p},...F}},St=({route:t="",pageSize:r=10,fetchAll:a=!1,cacheKey:e,enabled:s})=>{const{data:o,hasNextPage:i,fetchNextPage:n,...d}=K({initialPageParam:"",cacheKey:[...e,a?"all":String(r)],enabled:s??!0,fetchDataFn:({pageParam:u})=>gt({route:t,pageSize:r,...!!u&&typeof u=="string"&&{cursor:u}}),getNextPageParam:u=>u.nextCursor?u.nextCursor:null,transformFn:u=>{const{totalCount:f}=u[0];return{flattenData:u.flatMap(p=>p.data),totalCount:f}}});return g.useEffect(()=>{a&&i&&n()},[o]),{...o&&{...o},hasNextPage:i,fetchNextPage:n,...d}},k=t=>t==="true",Lt=(t,r,a,e)=>{var i,n;if(!r||!a)return-1;const s=e?a:r,o=e?r:a;switch(t){case S.Numeric:return parseFloat(s)-parseFloat(o);case S.Date:return new Date(s).getTime()-new Date(o).getTime();case S.Boolean:return Number(k(s))-Number(k(o));case S.String:return(n=(i=s==null?void 0:s.trim().toLowerCase())==null?void 0:i.localeCompare)==null?void 0:n.call(i,o==null?void 0:o.trim().toLowerCase());default:return-1}};function $(t){if(t==null)return"";switch(typeof t){case"string":return t;case"number":case"boolean":case"bigint":case"symbol":case"object":try{return JSON.stringify(t)}catch{return""}default:return""}}const bt=({items:t=[],filters:r,searchFilters:a,sorting:e,columns:s})=>{const o=g.useMemo(()=>!r.length&&!a.length?t??[]:ht(t??[],[...r,...a]),[t,r,a]);return{filteredAndSortedData:g.useMemo(()=>{var p;if(!(e!=null&&e.length))return o;const n=e[0]??{},d=n.id,u=n.desc??!1;if(!d)return o;const f=((p=s.find(_=>_.id===d))==null?void 0:p.type)??S.String;return[...o].sort((_,l)=>Lt(f,$(_[d]),$(l[d]),u))},[o,e,s])}},Vt=({route:t="",cacheKey:r,fetchDataFn:a,refetchInterval:e,pageSize:s=10,columns:o=[],defaultSorting:i,enabled:n=!0})=>{const{searchInput:d,setSearchInput:u,searchFilters:f,sorting:p,setSorting:_,filters:l,addFilter:v,removeFilter:P,onSearch:y}=Q({defaultSorting:i,columns:o}),[D,x]=g.useState(0),[L,R]=g.useState(0),[T,F]=g.useState([]),{data:h,error:I,isError:A,isFetching:w,isLoading:b,isSuccess:C,status:U}=Dt({cacheKey:[r],fetchDataFn:()=>a?a(t):Et.get(t),refetchInterval:e||!1,enabled:n}),{filteredAndSortedData:O}=bt({items:h==null?void 0:h.data,columns:o,filters:l,searchFilters:f,sorting:p});g.useEffect(()=>{b||(R(O.length),x(0),F(O))},[O]);const W=g.useCallback(()=>x(V=>V+1),[D]);return{error:I,isError:A,isFetching:w,isSuccess:C,status:U,isLoading:b,pageIndex:D,totalCount:L,flattenData:T==null?void 0:T.slice(0,(D+1)*s),hasNextPage:D*s+s<(T==null?void 0:T.length),fetchNextPage:W,sorting:{sorting:p??[],setSorting:V=>_(typeof V=="function"?Z=>V(Z??[]):V??[]),manualSorting:!0},filters:{filters:l,add:v,remove:P},search:{onSearch:y,searchInput:d,setSearchInput:u}}},Rt=({route:t="",version:r="v6",iceberg:a,pageSize:e,cacheKey:s,fetchDataFn:o,refetchInterval:i,defaultSorting:n,fetchAll:d,columns:u=[],disableCache:f,enabled:p})=>{const _=!!a,l=!_&&r==="v2",v=!_&&!l,P=At({version:r,route:t,pageSize:e,cacheKey:s,enabled:!!(p&&_),defaultSorting:n??[],fetchAll:d,columns:u,disableCache:f}),y=St({route:t,pageSize:e,enabled:!!(p&&l),cacheKey:s,fetchAll:d}),D=Vt({route:t,cacheKey:s,fetchDataFn:o,refetchInterval:i,enabled:!!(p&&v),pageSize:e,columns:u,defaultSorting:n});return _?P:l?y:D};function Ft(t){return`/iam/resource/${encodeURIComponent(t)}/authorization/check`}const wt=async(t,r)=>(await Pt.v2.post(Ft(r),{actions:t})).data;function Ct(t,r,a=!0){const{data:e,isLoading:s,isError:o,isFetching:i,refetch:n,status:d,error:u}=z({queryKey:["iam-authorization",r,t],queryFn:()=>wt(t,r),enabled:!!(r&&r.length>0&&t&&t.length>0&&a),placeholderData:_t});return{isAuthorized:!!(e!=null&&e.authorizedActions)&&t.every(p=>{var _;return(_=e==null?void 0:e.authorizedActions)==null?void 0:_.includes(p)}),data:e,isLoading:s,isError:o,isFetching:i,refetch:n,status:d,error:u}}function Yt({resourceType:t,enabled:r=!0}){let a="/iam/resource";t&&(a=`${a}?resourceType=${t}`);const{flattenData:e,isError:s,isLoading:o}=Rt({version:"v2",iceberg:!0,route:a,cacheKey:["iam/resource",t||""],enabled:r,fetchAll:!0});return{tags:g.useMemo(()=>e?yt(e):[],[e]),isError:s,isLoading:o}}const Ot={de_DE:()=>m(c(()=>import("./Messages_de_DE-D6eaGZhM.js"),[],import.meta.url)),en_GB:()=>m(c(()=>import("./Messages_en_GB-v5ik8MVv.js"),[],import.meta.url)),es_ES:()=>m(c(()=>import("./Messages_es_ES-Cw1e7UdN.js"),[],import.meta.url)),fr_CA:()=>m(c(()=>import("./Messages_fr_CA-BygpM1se.js"),[],import.meta.url)),fr_FR:()=>m(c(()=>import("./Messages_fr_FR-BygpM1se.js"),[],import.meta.url)),it_IT:()=>m(c(()=>import("./Messages_it_IT-CC7b0OgL.js"),[],import.meta.url)),pl_PL:()=>m(c(()=>import("./Messages_pl_PL-B2f0pp2L.js"),[],import.meta.url)),pt_PT:()=>m(c(()=>import("./Messages_pt_PT-D6SX8-Eo.js"),[],import.meta.url))};M(Ot,"iam");const B=({children:t,iamActions:r,urn:a,displayTooltip:e=!0,tooltipPosition:s=lt.bottom,...o})=>{const{t:i}=J("iam"),{isAuthorized:n}=Ct(r||[],a||"");return n||!(r&&a)?E.jsx(N,{"data-testid":"manager-button",...o,children:t}):e?E.jsxs(ct,{position:s,children:[E.jsx(mt,{"data-testid":"manager-button-tooltip",asChild:!0,children:E.jsx(N,{"data-testid":"manager-button-tooltip",...o,disabled:!0,children:t})}),E.jsx(dt,{children:i("common_iam_actions_message")})]}):E.jsx(N,{"data-testid":"manager-button-without-tooltip",...o,disabled:!0,children:t})};try{B.displayName="Button",B.__docgenInfo={description:"",displayName:"Button",props:{}}}catch{}const Nt={de_DE:()=>m(c(()=>import("./Messages_de_DE-wV6iqazs.js"),[],import.meta.url)),en_GB:()=>m(c(()=>import("./Messages_en_GB-BZXjAwVZ.js"),[],import.meta.url)),es_ES:()=>m(c(()=>import("./Messages_es_ES-CG-rqwH1.js"),[],import.meta.url)),fr_CA:()=>m(c(()=>import("./Messages_fr_CA-BC5dFmG2.js"),[],import.meta.url)),fr_FR:()=>m(c(()=>import("./Messages_fr_FR-BC5dFmG2.js"),[],import.meta.url)),it_IT:()=>m(c(()=>import("./Messages_it_IT-BvpB8PHM.js"),[],import.meta.url)),pl_PL:()=>m(c(()=>import("./Messages_pl_PL-5NJ1ki9l.js"),[],import.meta.url)),pt_PT:()=>m(c(()=>import("./Messages_pt_PT-Hfz_XHs8.js"),[],import.meta.url))};M(Nt,"drawer");const G=({children:t,createPortal:r,isOpen:a,isLoading:e,onDismiss:s,className:o,trigger:i})=>{const{t:n}=J("drawer");return E.jsxs(ot,{open:a,onOpenChange:s,children:[i&&E.jsx(st,{children:i}),E.jsx(it,{"data-testid":"drawer",createPortal:r,position:nt.right,className:X("w-full sm:w-[var(--mrc-drawer-width)] max-w-full p-0 overflow-hidden",o),children:E.jsx(ut,{children:E.jsxs("div",{className:"h-screen overflow-hidden flex flex-col justify-between",children:[E.jsx(B,{"data-testid":"drawer-dismiss-button","aria-label":n("close"),onClick:s,color:tt.primary,variant:et.ghost,className:"absolute top-7 right-4",children:E.jsx(H,{name:Y.xmark})}),e&&E.jsx("div",{"data-testid":"drawer-spinner",className:"h-full flex justify-center items-center",children:E.jsx(rt,{size:at.md})}),!e&&t]})})})]})};try{G.displayName="DrawerBase",G.__docgenInfo={description:"",displayName:"DrawerBase",props:{isOpen:{defaultValue:null,description:"Open/close the drawer (default to true)",name:"isOpen",required:!1,type:{name:"boolean"}},onDismiss:{defaultValue:null,description:"Callback function to be called on close of the Drawer",name:"onDismiss",required:!0,type:{name:"() => void"}},isLoading:{defaultValue:null,description:"Show a loader instead of the drawer content",name:"isLoading",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"Class name for the drawer",name:"className",required:!1,type:{name:"string"}},createPortal:{defaultValue:null,description:"Create a portal for the drawer",name:"createPortal",required:!1,type:{name:"boolean"}},trigger:{defaultValue:null,description:"Trigger for the drawer",name:"trigger",required:!1,type:{name:"ReactNode"}}}}}catch{}export{B,G as D,Yt as a,Ct as u};
