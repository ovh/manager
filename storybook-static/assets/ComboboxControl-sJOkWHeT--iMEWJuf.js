import{j as b}from"./jsx-runtime-BRNY0I4F.js";import{r as a}from"./index-Bnop-kX6.js";import{I as ao}from"./FormFieldLabel-DerGjSSG-BvxIGX_B.js";import{m as T}from"./index-2w0W-O47-BJ19ihbZ.js";import{L as mo,A as po}from"./PopoverTrigger-4w4N6iLp-C-LGD_7X.js";import{o as G}from"./ods-react235-BTQ8kVBe.js";import{t as ho}from"./Icon-DrfG5m-t-DQEf1CkA.js";import{l as fo}from"./ods-react60-0db41gCx.js";import{u as xo}from"./ods-react94-Bxf0SjVg.js";import{p as go}from"./Input-DcqcPYne-C5PzK7un.js";import{b as _o}from"./Tag-B7nBeuPX-CPCfmWrN.js";import{C as vo}from"./index-D_fe-3SC-C5ZKsUXO.js";import{w as Co}from"./use-locale-context-cwTY9VYn-REDUMe7F.js";function wo(o,t,e,{allowCustomValue:l,filterFn:i,multiple:c,newElementLabel:m}){const _=l&&e.trim()!==""&&!Lo(o.concat(t),e,c)?[{isNewElement:!0,label:`${m}${e}`,value:e}]:[];function x(d,p,h,g){return g&&p.some(I=>I.value===d.value)?!1:i(d.label,h.trim())}return o.reduce((d,p)=>{if(W(p)){const h=p.options.filter(g=>x(g,t,e,c));return h.length&&d.push({...p,options:h}),d}return x(p,t,e,c)&&d.push(p),d},_)}function co(o,t){let e;return o.some(l=>{so(l,i=>i.value===t?(e=i,!0):!1)}),e}function Io(o,t,e){if(t||!(e!=null&&e.length))return"";const l=co(o,e[0]);return l?l.label:""}function No(o,t){return t!=null&&t.length?o.reduce((e,l)=>{if(W(l)){const i=l.options.filter(c=>t.indexOf(c.value)>=0);return i.length&&(e=e.concat(i)),e}return t.indexOf(l.value)>=0&&e.push(l),e},[]):[]}function ro(o,t,e){if(typeof o=="string")return Vo(o,t,e);if(a.isValidElement(o)){const l=a.Children.map(o.props.children,i=>ro(i,t,e));return a.cloneElement(o,o.props,l)}return o}function Vo(o,t,e){return yo(o,t).map((l,i)=>l.toLowerCase()===t?e({key:i,part:l}):l)}function lo(o){return!!o&&o.selectionStart===0&&o.selectionEnd===0}function W(o){return"options"in o}function Lo(o,t,e){const l=t.trim().toLocaleLowerCase();return o.some(i=>so(i,c=>e?c.label.trim().toLocaleLowerCase()===l.toLocaleLowerCase()||c.value.trim().toLocaleLowerCase()===l.toLocaleLowerCase():c.label.trim().toLocaleLowerCase()===l.toLocaleLowerCase()))}function so(o,t){return W(o)?o.options.some(t):t(o)}function yo(o,t){if(!o||!t)return[o];const e=t.toLowerCase().replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),l=new RegExp(`(${e})`,"gi");return o.split(l)}function Eo(o){const t=Co(),e=o.locale??t.locale;return a.useMemo(()=>vo({...o,locale:e}),[e,o])}const uo=a.createContext(void 0),Oo=({allowCustomValue:o,children:t,customFilter:e,defaultValue:l,disabled:i,items:c,multiple:m=!1,newElementLabel:_,onInputValueChange:x,onValueChange:d,readOnly:p,value:h,...g})=>{const I=a.useMemo(()=>Io(c,m,l||h),[]),V=a.useMemo(()=>No(c,l||h),[]),{contains:R}=Eo({sensitivity:"base"}),f=a.useCallback((n,u)=>e?e(n,u):R(n,u),[e]),H=a.useId(),k=a.useRef(null),[S,B]=a.useState(""),[O,q]=a.useState(),[v,K]=a.useState(c),[s,L]=a.useState(""),[N,P]=a.useState(I),[j,Y]=a.useState(!1),[C,D]=a.useState(V),w=a.useMemo(()=>v.reduce((n,u)=>W(u)?n.concat(u.options.map(M=>M.value)):(n.push(u.value),n),[]),[v]);a.useEffect(()=>{L(""),K(()=>!m&&N.trim()===""?c:wo(c,C,N,{allowCustomValue:o,filterFn:f,multiple:m,newElementLabel:_}))},[o,f,N,c,m,_,C]),a.useEffect(()=>{j||L("")},[j]);function z(n){i||p||!m||(A(u=>u.filter(M=>M.value!==n.value)),J())}function J(){var n;(n=k.current)==null||n.focus()}function X(){if(j||r(!0),s===""&&v.length)L(w[0]);else{const n=w.findIndex(u=>u===s);L(w[n<w.length-1?n+1:0])}}function oo(n){j&&L(n.value)}function eo(){if(j)if(s===""&&v.length)L(w[w.length-1]);else{const n=w.findIndex(u=>u===s);L(w[n>0?n-1:w.length-1])}}function to(){if(!s)return;const n=co(v,s);n&&F(n)}function F(n){i||p||(m?(y(""),A(u=>{if(n.isNewElement){const{isNewElement:M,...no}=n;return u.concat([{...no,label:n.value}])}return u.concat([n])})):(y(n.isNewElement?n.value:n.label),A([n]),r(!1)),J())}function y(n){const u=typeof n=="function"?n(N):n;P(u),x&&u!==N&&x({inputValue:u})}function r(n){Y(i||p?!1:n)}function A(n){const u=typeof n=="function"?n(C):n;if(D(u),d){const M=u.length?u.map(no=>no.value):[];d({value:M})}}return b.jsx(uo.Provider,{value:{...g,allowCustomValue:o,contentId:S,contentPosition:O,controlId:H,defaultValue:l,deselectItem:z,disabled:i,filteredItems:v,highlightNextOption:X,highlightOption:oo,highlightPreviousOption:eo,highlightedOptionValue:s,inputRef:k,inputValue:N,isOpen:j,items:c,multiple:m,newElementLabel:_,onInputValueChange:x,onValueChange:d,readOnly:p,selectHighlightedItem:to,selectItem:F,selection:C,setContentId:B,setContentPosition:q,setInputValue:y,setIsOpen:r,setSelection:A,value:h},children:t})};function Z(){const o=a.useContext(uo);if(!o)throw new Error("useCombobox must be used within a ComboboxProvider");return o}const jo=a.forwardRef(({allowCustomValue:o=!0,children:t,className:e,customFilter:l,customOptionRenderer:i,defaultValue:c,disabled:m,highlightResults:_=!1,i18n:x,invalid:d,items:p,locale:h,multiple:g,name:I,newElementLabel:V="Add ",noResultLabel:R="No results found",onInputValueChange:f,onValueChange:H,readOnly:k,required:S,value:B,...O},q)=>{const v=ao(),K=d||(v==null?void 0:v.invalid);return b.jsx(Oo,{allowCustomValue:o,customFilter:l,customOptionRenderer:i,defaultValue:c,disabled:m,highlightResults:_,i18n:x,invalid:K,items:p,locale:h,multiple:g,name:I,newElementLabel:V,noResultLabel:R,onInputValueChange:f,onValueChange:H,readOnly:k,required:S,value:B,children:b.jsx("div",{className:e,"data-ods":"combobox",ref:q,...O,children:t})})});jo.displayName="Combobox";const Ro={"combobox-highlight":"_combobox-highlight_1y4e6_2"},ko=({children:o,highlight:t,inputValue:e})=>!t||!e?b.jsx(b.Fragment,{children:o}):b.jsx(b.Fragment,{children:ro(o,e.toLowerCase(),({key:l,part:i})=>b.jsx("span",{className:Ro["combobox-highlight"],children:i},l))}),$={"combobox-option":"_combobox-option_6dh73_2","combobox-option--disabled":"_combobox-option--disabled_6dh73_12","combobox-option--highlighted":"_combobox-option--highlighted_6dh73_18","combobox-option--new":"_combobox-option--new_6dh73_21","combobox-option--selected":"_combobox-option--selected_6dh73_24","combobox-option__new-item":"_combobox-option__new-item_6dh73_27"},io=({className:o,isHighlighted:t,item:e,...l})=>{const{customOptionRenderer:i,disabled:c,highlightOption:m,highlightResults:_,inputValue:x,selection:d,selectItem:p}=Z();function h(){c||p(e)}return b.jsx("div",{"aria-selected":t,className:T($["combobox-option"],{[$["combobox-option--disabled"]]:c},{[$["combobox-option--highlighted"]]:t},{[$["combobox-option--new"]]:e.isNewElement},{[$["combobox-option--selected"]]:d.some(g=>g.value===e.value)},o),onClick:h,onPointerEnter:()=>m(e),role:"option",tabIndex:-1,...l,children:e.isNewElement?b.jsxs("div",{className:$["combobox-option__new-item"],children:[b.jsx(ho,{name:fo.plus})," ",e.label]}):b.jsx(ko,{highlight:_,inputValue:x,children:i?i(e):e.label})})};io.displayName="ComboboxOption";const Q={"combobox-group":"_combobox-group_1f16m_2","combobox-group__label":"_combobox-group__label_1f16m_8","combobox-group__label--disabled":"_combobox-group__label--disabled_1f16m_16","combobox-group__option":"_combobox-group__option_1f16m_22"},bo=({className:o,item:t,...e})=>{const l=a.useId(),{disabled:i,highlightedOptionValue:c}=Z();return b.jsxs("div",{"aria-labelledby":l,className:Q["combobox-group"],role:"group",...e,children:[b.jsx("div",{className:T(Q["combobox-group__label"],{[Q["combobox-group__label--disabled"]]:i}),id:l,role:"presentation",children:t.label}),t.options.map(m=>b.jsx(io,{className:Q["combobox-group__option"],isHighlighted:c===m.value,item:m},m.value))]})};bo.displayName="ComboboxGroup";const U={"combobox-content":"_combobox-content_isu4g_2","combobox-content--open-bottom":"_combobox-content--open-bottom_isu4g_11","combobox-content--open-top":"_combobox-content--open-top_isu4g_14","combobox-content__empty":"_combobox-content__empty_isu4g_17"},So=a.forwardRef(({className:o,createPortal:t=!0,id:e,...l},i)=>{const{contentPosition:c,controlId:m,filteredItems:_,highlightedOptionValue:x,isOpen:d,noResultLabel:p,setContentId:h,setContentPosition:g}=Z(),I=a.useId(),V=a.useMemo(()=>e??I,[I,e]);a.useEffect(()=>{h(V)},[V,h]);function R({position:f}){g(f)}return b.jsx(mo,{autoFocus:!1,gutter:-1,onPositionChange:R,open:d,position:G.bottom,sameWidth:!0,triggerId:m,children:b.jsxs(po,{className:T(U["combobox-content"],{[U["combobox-content--open-bottom"]]:c===G.bottom},{[U["combobox-content--open-top"]]:c===G.top},o),createPortal:t,"data-ods":"combobox-content",id:V,ref:i,...l,role:"listbox",children:[_.length===0&&b.jsx("div",{className:U["combobox-content__empty"],children:p}),_.map(f=>W(f)?b.jsx(bo,{item:f},f.label):b.jsx(io,{id:`${m}-${f.value}`,isHighlighted:x===f.value,item:f},f.value))]})})});So.displayName="ComboboxContent";const E={"combobox-control":"_combobox-control_14h0r_2","combobox-control--invalid":"_combobox-control--invalid_14h0r_16","combobox-control--disabled":"_combobox-control--disabled_14h0r_16","combobox-control--read-only":"_combobox-control--read-only_14h0r_16","combobox-control--focused":"_combobox-control--focused_14h0r_19","combobox-control--open-bottom":"_combobox-control--open-bottom_14h0r_35","combobox-control--open-top":"_combobox-control--open-top_14h0r_38","combobox-control__tag--focused":"_combobox-control__tag--focused_14h0r_45","combobox-control__input":"_combobox-control__input_14h0r_49"},Po=a.forwardRef(({className:o,clearable:t,id:e,loading:l,placeholder:i,...c},m)=>{const{contentId:_,contentPosition:x,controlId:d,deselectItem:p,disabled:h,highlightedOptionValue:g,highlightNextOption:I,highlightPreviousOption:V,i18n:R,inputRef:f,inputValue:H,invalid:k,isOpen:S,locale:B,multiple:O,name:q,readOnly:v,required:K,selection:s,selectHighlightedItem:L,setInputValue:N,setIsOpen:P,setSelection:j}=Z(),Y=ao(),[C,D]=a.useState(-1),[w,z]=a.useState(!1),J=!h&&!v;function X(){!s.length||C<0||(C>=s.length-1?y():D(r=>Math.min(r+1,s.length-1)))}function oo(){s.length&&(C<0?D(s.length-1):D(r=>Math.max(0,r-1)))}function eo(r){xo(r.relatedTarget,"data-ods",["combobox-content","combobox-control"])||(O||(s.length?N(s[0].isNewElement?s[0].value:s[0].label):N("")),y(),z(!1),P(!1))}function to(r){switch(r.key){case"ArrowDown":r.preventDefault(),I();break;case"ArrowLeft":lo(f.current)&&(r.preventDefault(),oo());break;case"ArrowRight":C>=0&&lo(f.current)&&(r.preventDefault(),X());break;case"ArrowUp":r.preventDefault(),V();break;case"Backspace":s.length&&lo(f.current)&&F(s[C>=0?C:s.length-1]);break;case"Enter":if(s.length&&C>=0){r.preventDefault(),F(s[C]);break}g&&(r.preventDefault(),L());break;case"Escape":r.preventDefault(),y(),P(!1);break}}function F(r){y(),p(r)}function y(){D(-1)}return b.jsxs("div",{className:T(E["combobox-control"],{[E["combobox-control--disabled"]]:h},{[E["combobox-control--invalid"]]:k},{[E["combobox-control--focused"]]:w},{[E["combobox-control--open-bottom"]]:S&&x===G.bottom},{[E["combobox-control--open-top"]]:S&&x===G.top},{[E["combobox-control--read-only"]]:v},o),"data-ods":"combobox-control",id:d,onBlur:eo,ref:m,...c,children:[O&&s.map((r,A)=>b.jsx(_o,{className:T({[E["combobox-control__tag--focused"]]:J&&C===A}),disabled:h||v,onClick:()=>F(r),tabIndex:-1,value:r.value,children:r.label},r.value)),b.jsx(go,{"aria-activedescendant":g?`${d}-${g}`:"","aria-autocomplete":"list","aria-controls":_,"aria-expanded":S?"true":"false",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",className:E["combobox-control__input"],clearable:t,disabled:h,i18n:R,id:e||(Y==null?void 0:Y.id),invalid:k,loading:l,locale:B,onChange:r=>{y(),N(r.target.value),P(!0)},onClear:()=>!O&&j([]),onClick:()=>P(!0),onFocus:()=>z(!0),onKeyDown:to,name:q,placeholder:i,readOnly:v,ref:f,required:O?!1:K,role:"combobox",spellCheck:"false",value:H})]})});Po.displayName="ComboboxControl";export{So as B,Po as L,jo as V};
