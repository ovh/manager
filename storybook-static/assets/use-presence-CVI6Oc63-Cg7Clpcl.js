import{X as N,T as v,V as E,g as f,C as g,D as c,l as y,r as x,B as U}from"./use-locale-context-cwTY9VYn-REDUMe7F.js";import{r as A}from"./index-Bnop-kX6.js";import{p as P}from"./use-event-C16_WYdL-DF4JeFb4.js";const[k,D]=N({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"});function O(e,n){const{state:o,send:t,context:u}=e,i=o.matches("mounted","unmountSuspended");return{skip:!u.get("initial"),present:i,setNode(s){s&&t({type:"NODE.SET",node:s})},unmount(){t({type:"UNMOUNT"})}}}var M=f({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,prop:n,send:o}){e([()=>n("present")],()=>{o({type:"PRESENCE.CHANGED"})})},on:{"NODE.SET":{actions:["setupNode"]},"PRESENCE.CHANGED":{actions:["setInitial","syncPresence"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},invokeOnExitComplete:({prop:e})=>{var n;(n=e("onExitComplete"))==null||n()},setupNode:({refs:e,event:n})=>{e.get("node")!==n.node&&(e.set("node",n.node),e.set("styles",g(n.node)))},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},syncPresence:({context:e,refs:n,send:o,prop:t})=>{const u=t("present");if(u)return o({type:"MOUNT",src:"presence.changed"});const i=n.get("node");if(!u&&(i==null?void 0:i.ownerDocument.visibilityState)==="hidden")return o({type:"UNMOUNT",src:"visibilitychange"});c(()=>{var s,a;const r=l(n.get("styles"));e.set("unmountAnimationName",r),r==="none"||r===e.get("prevAnimationName")||((s=n.get("styles"))==null?void 0:s.display)==="none"||((a=n.get("styles"))==null?void 0:a.animationDuration)==="0s"?o({type:"UNMOUNT",src:"presence.changed"}):o({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:n})=>{c(()=>{e.set("prevAnimationName",l(n.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:n,send:o})=>{const t=n.get("node");if(!t)return;const u=a=>{var r,m;(((m=(r=a.composedPath)==null?void 0:r.call(a))==null?void 0:m[0])??a.target)===t&&e.set("prevAnimationName",l(n.get("styles")))},i=a=>{const r=l(n.get("styles"));U(a)===t&&r===e.get("unmountAnimationName")&&o({type:"UNMOUNT",src:"animationend"})};t.addEventListener("animationstart",u),t.addEventListener("animationcancel",i),t.addEventListener("animationend",i);const s=y(t,{animationFillMode:"forwards"});return()=>{t.removeEventListener("animationstart",u),t.removeEventListener("animationcancel",i),t.removeEventListener("animationend",i),x(()=>s())}}}}});function l(e){return(e==null?void 0:e.animationName)||"none"}v()(["onExitComplete","present","immediate"]);const h=(e={})=>{const{lazyMount:n,unmountOnExit:o,present:t,skipAnimationOnMount:u=!1,...i}=e,s=A.useRef(!1),a={...i,present:t,onExitComplete:P(e.onExitComplete)},r=E(M,a),m=O(r);m.present&&(s.current=!0);const d=!m.present&&!s.current&&n||o&&!m.present&&s.current,p=()=>({"data-state":m.skip&&u?void 0:t?"open":"closed",hidden:!m.present});return{ref:m.setNode,getPresenceProps:p,present:m.present,unmounted:d}};export{D,h as L,k};
