{"version":3,"file":"datagrid.stories-dA0WTQBz.js","sources":["../../src/components/datagrid/useDatagridSearchParams.ts"],"sourcesContent":["import { ColumnSort, PaginationState } from '@tanstack/react-table';\nimport { useSearchParams } from 'react-router-dom';\nimport { DEFAULT_PAGINATION, PAGE_SIZES } from './datagrid.contants';\n\n/**\n * This hooks allows to store and synchronize the datagrid pagination & sorting\n * state within URL search parameters. Thus the user is able to refresh his page\n * without loosing his current pagination and column sorting state.\n */\n\n/* Convert URL search params to plain object */\nconst getSearchParamsObject = (search: URLSearchParams) =>\n  Object.fromEntries([...search.entries()]);\n\n/* Parse pagination from URL search params */\nconst parsePagination = (params: URLSearchParams): PaginationState => {\n  const pagination = { ...DEFAULT_PAGINATION };\n  if (params.has('page')) {\n    let pageIndex = parseInt(params.get('page'), 10) - 1;\n    if (Number.isNaN(pageIndex) || pageIndex < 0) pageIndex = 0;\n    pagination.pageIndex = pageIndex;\n  }\n  if (params.has('pageSize')) {\n    let pageSize = parseInt(params.get('pageSize'), 10);\n    if (!PAGE_SIZES.includes(pageSize)) [pageSize] = PAGE_SIZES;\n    pagination.pageSize = pageSize;\n  }\n  return pagination;\n};\n\n/* Parse column sorting from URL search params */\nconst parseSorting = (\n  params: URLSearchParams,\n  defaultSorting?: ColumnSort,\n): ColumnSort => {\n  const sorting: ColumnSort = {\n    id: null,\n    desc: false,\n  };\n  if (params.has('sort')) {\n    sorting.id = params.get('sort');\n    if (params.has('sortOrder')) {\n      sorting.desc = params.get('sortOrder') === 'desc';\n    }\n  } else if (defaultSorting) {\n    return defaultSorting;\n  }\n  return sorting;\n};\n\n/** Use URL search params to store datagrid pagination & column sorting */\nexport const useDatagridSearchParams = (defaultSorting?: ColumnSort) => {\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  return {\n    pagination: parsePagination(searchParams),\n    sorting: parseSorting(searchParams, defaultSorting),\n    setPagination: ({ pageIndex, pageSize }: PaginationState) => {\n      if (pageIndex > 0) searchParams.set('page', `${pageIndex + 1}`);\n      else searchParams.delete('page');\n      if (PAGE_SIZES.includes(pageSize) && pageSize !== PAGE_SIZES[0])\n        searchParams.set('pageSize', `${pageSize}`);\n      else searchParams.delete('pageSize');\n      setSearchParams({\n        ...getSearchParamsObject(searchParams),\n      });\n    },\n    setSorting: ({ id, desc }: ColumnSort) => {\n      if (id) {\n        searchParams.set('sort', id);\n        if (desc) {\n          searchParams.set('sortOrder', 'desc');\n        } else {\n          searchParams.delete('sortOrder');\n        }\n      } else {\n        searchParams.delete('sort');\n        searchParams.delete('sortOrder');\n      }\n      setSearchParams({\n        ...getSearchParamsObject(searchParams),\n      });\n    },\n  };\n};\n"],"names":["getSearchParamsObject","search","parsePagination","params","pagination","DEFAULT_PAGINATION","pageIndex","pageSize","PAGE_SIZES","parseSorting","defaultSorting","sorting","useDatagridSearchParams","searchParams","setSearchParams","useSearchParams","id","desc"],"mappings":"0cAWA,MAAMA,EAAyBC,GAC7B,OAAO,YAAY,CAAC,GAAGA,EAAO,QAAS,CAAA,CAAC,EAGpCC,EAAmBC,GAA6C,CAC9D,MAAAC,EAAa,CAAE,GAAGC,GACpB,GAAAF,EAAO,IAAI,MAAM,EAAG,CACtB,IAAIG,EAAY,SAASH,EAAO,IAAI,MAAM,EAAG,EAAE,EAAI,GAC/C,OAAO,MAAMG,CAAS,GAAKA,EAAY,KAAeA,EAAA,GAC1DF,EAAW,UAAYE,CACzB,CACI,GAAAH,EAAO,IAAI,UAAU,EAAG,CAC1B,IAAII,EAAW,SAASJ,EAAO,IAAI,UAAU,EAAG,EAAE,EAC7CK,EAAW,SAASD,CAAQ,IAAG,CAACA,CAAQ,EAAIC,GACjDJ,EAAW,SAAWG,CACxB,CACO,OAAAH,CACT,EAGMK,EAAe,CACnBN,EACAO,IACe,CACf,MAAMC,EAAsB,CAC1B,GAAI,KACJ,KAAM,EAAA,EAEJ,GAAAR,EAAO,IAAI,MAAM,EACXQ,EAAA,GAAKR,EAAO,IAAI,MAAM,EAC1BA,EAAO,IAAI,WAAW,IACxBQ,EAAQ,KAAOR,EAAO,IAAI,WAAW,IAAM,gBAEpCO,EACF,OAAAA,EAEF,OAAAC,CACT,EAGaC,EAA2BF,GAAgC,CACtE,KAAM,CAACG,EAAcC,CAAe,EAAIC,EAAgB,EAEjD,MAAA,CACL,WAAYb,EAAgBW,CAAY,EACxC,QAASJ,EAAaI,EAAcH,CAAc,EAClD,cAAe,CAAC,CAAE,UAAAJ,EAAW,SAAAC,KAAgC,CACvDD,EAAY,EAAGO,EAAa,IAAI,OAAQ,GAAGP,EAAY,CAAC,EAAE,EACzDO,EAAa,OAAO,MAAM,EAC3BL,EAAW,SAASD,CAAQ,GAAKA,IAAaC,EAAW,CAAC,EAC5DK,EAAa,IAAI,WAAY,GAAGN,CAAQ,EAAE,EACvCM,EAAa,OAAO,UAAU,EACnBC,EAAA,CACd,GAAGd,EAAsBa,CAAY,CAAA,CACtC,CACH,EACA,WAAY,CAAC,CAAE,GAAAG,EAAI,KAAAC,KAAuB,CACpCD,GACWH,EAAA,IAAI,OAAQG,CAAE,EACvBC,EACWJ,EAAA,IAAI,YAAa,MAAM,EAEpCA,EAAa,OAAO,WAAW,IAGjCA,EAAa,OAAO,MAAM,EAC1BA,EAAa,OAAO,WAAW,GAEjBC,EAAA,CACd,GAAGd,EAAsBa,CAAY,CAAA,CACtC,CACH,CAAA,CAEJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}