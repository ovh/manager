<div id="groupNumber">
    <div class="d-flex flex-column m-2 w-100" data-ng-if="$ctrl.isComplexFeature() && $ctrl.featureActions.length">
        <oui-radio-toggle-group
            direction="row"
            model="$ctrl.selectedFeatureActionIndex"
            dense
            on-change="$ctrl.onFeatureActionChange(modelValue)"
        >
            <oui-radio
                data-ng-repeat="action in $ctrl.featureActions track by $index"
                data-ng-if="!action.divider && action.name !== 'number_modification_new'"
                value="$index"
                disabled="$ctrl.number.inEdition"
            >
                <span data-ng-bind="action.text"></span>
            </oui-radio>
        </oui-radio-toggle-group>
    </div>

    <!-- Tab content view (for complex features like cloudIvr/contactCenterSolutionExpert) -->
    <div class="mt-3" data-ng-if="$ctrl.isComplexFeature() && !$ctrl.isDialplanTabSelected()">
        <ui-view></ui-view>
    </div>
    <form
        class="telephony-number"
        name="telephonyNumber"
        data-ng-submit="$ctrl.saveNumber()"
        data-ng-if="$ctrl.isDialplanTabSelected() || !$ctrl.isComplexFeature()"
        novalidate
    >
        <div
            class="d-flex justify-content-end"
            data-ng-if="$ctrl.number.getFeatureFamily() === 'ovhPabx'"
        >
            <div class="d-flex flex-column">
                <div class="d-flex align-items-center">
                    <div class="mr-3">
                        <oui-checkbox
                            data-model="$ctrl.actionsShowAll"
                        >
                            <span data-translate="telephony_number_action_show_all_actions"></span>
                        </oui-checkbox>
                    </div>
                    <div>
                        <oui-radio-toggle-group
                            direction="row"
                            data-model="$ctrl.layoutModel"
                            dense
                            data-on-change="$ctrl.onLayoutChange(modelValue)"
                        >
                            <oui-radio
                                data-value="'horizontal'"
                            >
                                <span class="d-flex align-items-center">
                                    <span class="oui-icon oui-icon-arrow-right mr-1"></span>
                                    <span data-translate="telephony_number_action_layout_horizontal"></span>
                                </span>
                            </oui-radio>
                            <oui-radio
                                data-value="'vertical'"
                            >
                                <span class="d-flex align-items-center">
                                    <span class="oui-icon oui-icon-arrow-down mr-1"></span>
                                    <span data-translate="telephony_number_action_layout_vertical"></span>
                                </span>
                            </oui-radio>
                        </oui-radio-toggle-group>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-end mt-3">
                    <oui-switch
                        data-disabled="!$ctrl.dialplanLoaded"
                        data-model="$ctrl.reorderingMode"
                        data-on-change="$ctrl.onReorderingModeChange(modelValue)"
                    >
                    </oui-switch>
                    <span class="ml-2" data-translate="telephony_number_action_reorder"></span>
                </div>
            </div>
        </div>

        <!-- LOADING DIALPLAN -->
        <div class="text-center my-5" data-ng-if="$ctrl.loading.init">
            <oui-spinner></oui-spinner>
        </div>
        <!-- END LOADING DIALPLAN -->

        <div
            class="group-number-container group-number-layout"
            data-ng-class="{
                'group-number-layout-horizontal': !$ctrl.verticalLayout,
                'group-number-layout-vertical': $ctrl.verticalLayout,
            }"
        >
            <div class="group-number">
                <!-- HEADER -->
                <div
                    class="number-header"
                    data-ng-class="{
                        'mt-5': $ctrl.number.getFeatureFamily() === 'svi' && !$ctrl.verticalLayout,
                    }">
                    <!-- INCOMING CALL -->
                    <div class="group-number__step group-number__step--point">
                        <div class="group-number__title--container">
                            <span
                                class="oui-icon oui-icon-phone_concept group-number__title--icon"
                                aria-hidden="true"
                            ></span>
                            <h2
                                class="group-number__title"
                                data-translate="telephony_number_incoming_calls"
                            ></h2>
                        </div>
                    </div>
                    <!-- INCOMING CALL -->

                    <!-- NUMBER DISPLAY -->
                    <div class="group-number__step group-number__step--point">
                        <div class="group-number__number">
                            <div
                                class="group-number__step-icon group-number__step-icon--included"
                            >
                                <span
                                    class="ovh-font ovh-font-hashtag"
                                    aria-hidden="true"
                                ></span>
                            </div>
                            <div class="group-number__step-description">
                                <span
                                    class="group-number__step-name group-number__step-name--has-info"
                                    data-ng-bind="$ctrl.number.getDisplayedName()"
                                >
                                </span>
                                <span
                                    class="group-number__step-info"
                                    data-ng-bind="$ctrl.number.serviceName | tucPhoneNumber"
                                >
                                </span>
                            </div>
                            <!-- ONLY ONE ACTION => CHANGE FEATURE TYPE -->
                            <a
                                data-ng-if="$ctrl.featureActions.length === 1"
                                class="group-number__step-btn group-number__step-btn--primary"
                                data-ui-sref="{{ $ctrl.featureActions[0].sref }}"
                                data-ng-attr-title="{{ $ctrl.featureActions[0].text }}"
                            >
                                <span
                                    class="ovh-font ovh-font-editer"
                                    aria-hidden="true"
                                ></span>
                            </a>
                            <!-- ONLY ONE ACTION => CHANGE FEATURE TYPE -->

                            <!-- MORE ACTIONS -->
                            <div
                                class="group-number__number--btn-wrapper"
                                data-ng-if="$ctrl.featureActions.length > 1"
                                data-uib-dropdown
                                data-on-toggle="$ctrl.autoScrollOnToggle(open)"
                            >
                                <button
                                    type="button"
                                    id="number-actions"
                                    class="oui-action-button"
                                    data-ng-disabled="$ctrl.number.inEdition"
                                    data-uib-dropdown-toggle
                                >
                                    <span
                                        class="oui-icon oui-icon-ellipsis ml-0"
                                        aria-hidden="true"
                                    ></span>
                                </button>
                                <ul
                                    class="dropdown-menu ovh-dropdown-menu group-number__number--dropdown"
                                    role="menu"
                                    data-aria-labelledby="number-actions"
                                    data-uib-dropdown-menu
                                >
                                    <li
                                        role="menuitem"
                                        data-ng-class="{ divider: action.divider }"
                                        data-ng-repeat="action in $ctrl.featureActions track by $index"
                                        data-ng-if="!action.showInTabsOnly"
                                    >
                                        <!-- ACTION WITH SREF -->
                                        <a
                                            class="btn btn-link w-100"
                                            data-ui-sref="{{ action.sref }}"
                                            data-ng-if="action.sref"
                                            data-ng-bind="action.text"
                                            data-ng-click="action.onClick()"
                                        >
                                        </a>
                                        <!-- END OF ACTION WITH SREF -->

                                        <!-- ACTION WITH URL -->
                                        <a
                                            class="btn btn-link w-100"
                                            data-ng-href="{{ action.url }}"
                                            data-ng-if="action.url"
                                            data-ng-click="action.onClick()"
                                            target="_blank"
                                            rel="nofollow"
                                        >
                                            <span
                                                data-ng-bind="action.text"
                                            ></span>
                                            <span
                                                class="ovh-font ovh-font-backToV4 ml-2"
                                            ></span>
                                        </a>
                                        <!-- END OF ACTION WITH URL -->
                                    </li>
                                </ul>
                            </div>
                            <!-- MORE ACTIONS -->
                        </div>
                    </div>
                    <!-- NUMBER DISPLAY -->
                </div>
                <!-- HEADER -->

                <!-- FEATURES -->
                <div
                    class="telephony-number-feature"
                    data-ng-switch="$ctrl.number.getFeatureFamily()"
                >
                    <!-- REDIRECT -->
                    <telephony-number-redirect
                        data-ng-switch-when="redirect"
                    ></telephony-number-redirect>
                    <!-- REDIRECT -->

                    <!-- OVHPABX -->
                    <telephony-number-ovh-pabx
                        data-ng-switch-when="ovhPabx"
                    ></telephony-number-ovh-pabx>
                    <!-- OVHPABX -->

                    <!-- SVI -->
                    <telephony-number-svi
                        data-ng-switch-when="svi"
                    ></telephony-number-svi>
                    <!-- SVI -->

                    <!-- CONFERENCE -->
                    <telephony-number-conference
                        data-ng-switch-when="conference"
                    ></telephony-number-conference>
                    <!-- CONFERENCE -->
                </div>
                <!-- FEATURES -->
            </div>
        </div>

        <footer
            class="voip-action-bar"
            data-ng-if="$ctrl.number.feature.inEdition && !$ctrl.number.feature.inPendingState() && !$ctrl.loading.save"
        >
            <p
                class="mb-3 font-weight-bold text-white"
                data-translate="telephony_number_footer_question"
            ></p>

            <div class="d-inline-block">
                <button
                    type="submit"
                    class="btn btn-primary"
                    data-ng-disabled="!$ctrl.number.feature.hasChange() || $ctrl.loading.save || $ctrl.loading.feature"
                >
                    <oui-spinner
                        class="mr-2"
                        data-ng-if="$ctrl.loading.save"
                        data-size="s"
                    >
                    </oui-spinner>
                    <span data-translate="submit"></span>
                </button>
                <button
                    type="button"
                    class="btn btn-default"
                    data-ng-click="$ctrl.number.stopEdition(true, true)"
                    data-ng-disabled="$ctrl.loading.save"
                    data-translate="cancel"
                ></button>
            </div>
        </footer>
    </form>
</div>
