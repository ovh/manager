<div
    data-ng-controller="telephonyNumberOvhPabxMenuEditCtrl as $ctrl"
    class="telephony-number-ovh-pabx-menu-edit popover-pages"
    data-ng-form="$ctrl.menuOptionsForm"
    data-tuc-hide-outside-click="$ctrl.onCancelBtnClick()"
>
    <div
        class="popover-pages-wrapper"
        data-ng-class="{ move: $ctrl.menuCtrl.popoverStatus.move }"
    >
        <!-- LEFT PAGE -->
        <section class="popover-page page-section">
            <header>
                <h2
                    data-translate="{{ $ctrl.menu.status === 'DRAFT' ? 'telephony_number_feature_ovh_pabx_menu_options_create' : 'telephony_number_feature_ovh_pabx_menu_options' }}"
                ></h2>
            </header>

            <section>
                <div class="section-group">
                    <!-- NAME -->
                    <div
                        class="section-item form-group"
                        data-ng-class="{ 'has-error': $ctrl.menuOptionsForm.menuName.$invalid && $ctrl.menuOptionsForm.menuName.$dirty }"
                    >
                        <label
                            for="menuName"
                            class="control-label required"
                            data-translate="{{ 'telephony_number_feature_ovh_pabx_menu_options_name' }}"
                        >
                        </label>
                        <input
                            type="text"
                            class="form-control"
                            name="menuName"
                            id="menuName"
                            data-ng-model="$ctrl.menu.name"
                            data-translate-attr="{ placeholder: 'telephony_number_feature_ovh_pabx_menu_options_name' }"
                            data-required
                            data-ng-pattern="/^[\w\s]+$/"
                        />
                        <span
                            class="help-block"
                            role="alert"
                            data-ng-if="$ctrl.menuOptionsForm.menuName.$invalid && $ctrl.menuOptionsForm.menuName.$dirty"
                            data-ng-messages="$ctrl.menuOptionsForm.menuName.$error"
                        >
                            <span
                                data-ng-message="required"
                                data-translate="telephony_number_feature_ovh_pabx_menu_options_name_required"
                            >
                            </span>
                            <span
                                data-ng-message="pattern"
                                data-translate="telephony_number_feature_ovh_pabx_menu_options_name_bad_format"
                            >
                            </span>
                        </span>
                    </div>
                    <!-- End of NAME -->

                    <!-- GREET SOUND TYPE -->
                    <button
                        type="button"
                        class="section-item large-popover-item text-left"
                        data-ng-if="$ctrl.menuCtrl.ovhPabx.isTtsAvailable()"
                        data-ng-click="$ctrl.onSoundTypeChoiceButtonClick('greetSoundType')"
                    >
                        <label class="radio-label-main required">
                            <span
                                data-translate="telephony_number_feature_ovh_pabx_menu_options_greet_sound_type"
                            ></span>
                        </label>
                        <span
                            class="block"
                            data-translate="{{ 'telephony_number_feature_ovh_pabx_menu_options_sound_type_' + $ctrl.model.greetSoundType }}"
                        >
                        </span>
                        <div class="chevron-right">
                            <div class="chevron-wrapper">
                                <i class="ovh-font ovh-font-arrow-right"></i>
                            </div>
                        </div>
                    </button>
                    <!-- End of GREET SOUND TYPE -->

                    <!-- GREET SOUND -->
                    <button
                        type="button"
                        class="section-item large-popover-item text-left"
                        data-ng-click="$ctrl.onSoundChoiceButtonClick(!$ctrl.menuCtrl.ovhPabx.isTtsAvailable() || $ctrl.model.greetSoundType === 'sound' ? 'greetSound' : 'greetSoundTts')"
                        data-uib-tooltip="{{ 'telephony_number_feature_ovh_pabx_menu_options_greet_sound_explain' | translate }}"
                        data-tooltip-append-to-body="true"
                    >
                        <span class="required">
                            <span
                                class="align-middle"
                                data-translate="telephony_number_feature_ovh_pabx_menu_options_greet_sound"
                            >
                            </span>
                            <span class="btn btn-link p-0"
                                ><i
                                    class="ovh-font ovh-font-filled-question"
                                ></i
                            ></span>
                        </span>
                        <span
                            class="d-block"
                            data-ng-if="!$ctrl.menu.greetSound && !$ctrl.menu.greetSoundTts"
                            data-translate="telephony_number_feature_ovh_pabx_menu_options_no_sound_selected"
                        >
                        </span>
                        <span
                            class="d-block elipse no-wrap"
                            data-ng-if="$ctrl.menu.greetSound ||$ctrl.menu.greetSoundTts"
                            data-ng-bind="$ctrl.getSoundInfos($ctrl.model.greetSoundType === 'sound' ? 'greetSound' : 'greetSoundTts')"
                            data-ng-attr-title="{{ $ctrl.getSoundInfos($ctrl.model.greetSoundType === 'sound' ? 'greetSound' : 'greetSoundTts') }}"
                        >
                        </span>
                        <span class="chevron-right">
                            <span class="chevron-wrapper">
                                <i class="ovh-font ovh-font-arrow-right"></i>
                            </span>
                        </span>
                    </button>
                    <!-- End of GREET SOUND -->

                    <!-- INVALID SOUND TYPE -->
                    <button
                        type="button"
                        class="section-item large-popover-item text-left"
                        data-ng-if="$ctrl.menuCtrl.ovhPabx.isTtsAvailable()"
                        data-ng-click="$ctrl.onSoundTypeChoiceButtonClick('invalidSoundType')"
                    >
                        <label class="radio-label-main">
                            <span
                                data-translate="telephony_number_feature_ovh_pabx_menu_options_invalid_sound_type"
                            ></span>
                        </label>
                        <span
                            class="block"
                            data-translate="{{ 'telephony_number_feature_ovh_pabx_menu_options_sound_type_' + $ctrl.model.invalidSoundType }}"
                        >
                        </span>
                        <div class="chevron-right">
                            <div class="chevron-wrapper">
                                <i class="ovh-font ovh-font-arrow-right"></i>
                            </div>
                        </div>
                    </button>
                    <!-- End of INVALID SOUND TYPE -->

                    <!-- INVALID SOUND -->
                    <button
                        type="button"
                        class="section-item large-popover-item text-left"
                        data-ng-click="$ctrl.onSoundChoiceButtonClick(!$ctrl.menuCtrl.ovhPabx.isTtsAvailable() || $ctrl.model.invalidSoundType === 'sound' ? 'invalidSound' : 'invalidSoundTts')"
                        data-ng-if="!$ctrl.menuCtrl.ovhPabx.isTtsAvailable() || ($ctrl.menuCtrl.ovhPabx.isTtsAvailable() && $ctrl.model.invalidSoundType !== 'none')"
                        data-uib-tooltip="{{ 'telephony_number_feature_ovh_pabx_menu_options_invalid_sound_explain' | translate }}"
                        data-tooltip-append-to-body="true"
                    >
                        <span>
                            <span
                                class="align-middle"
                                data-translate="telephony_number_feature_ovh_pabx_menu_options_invalid_sound"
                            >
                            </span>
                            <span class="btn btn-link p-0"
                                ><i
                                    class="ovh-font ovh-font-filled-question"
                                ></i
                            ></span>
                        </span>
                        <span
                            class="d-block"
                            data-ng-if="!$ctrl.menu.invalidSound && !$ctrl.menu.invalidSoundTts"
                            data-translate="telephony_number_feature_ovh_pabx_menu_options_no_sound_selected"
                        >
                        </span>
                        <span
                            class="d-block elipse no-wrap"
                            data-ng-if="$ctrl.menu.invalidSound || $ctrl.menu.invalidSoundTts"
                            data-ng-bind="$ctrl.getSoundInfos($ctrl.model.invalidSoundType === 'sound' ? 'invalidSound' : 'invalidSoundTts')"
                            data-ng-attr-title="{{ $ctrl.getSoundInfos($ctrl.model.invalidSoundType === 'sound' ? 'invalidSound' : 'invalidSoundTts') }}"
                        >
                        </span>
                        <span class="chevron-right">
                            <span class="chevron-wrapper">
                                <i class="ovh-font ovh-font-arrow-right"></i>
                            </span>
                        </span>
                    </button>
                    <!-- End of INVALID SOUND -->
                </div>
            </section>

            <!-- FOOTER ACTIONS -->
            <footer class="clearfix">
                <div class="btn-group float-right">
                    <button
                        type="button"
                        class="oui-button oui-button_secondary m-3"
                        data-translate="cancel"
                        data-ng-click="$ctrl.onCancelBtnClick()"
                    ></button>
                    <button
                        type="button"
                        class="oui-button oui-button_primary m-3"
                        data-ng-disabled="!$ctrl.menu.hasChange() || !$ctrl.isMenuValid() || !$ctrl.isFormValid()"
                        data-translate="{{ $ctrl.menu.status === 'DRAFT' ? 'common_create' : 'modify' }}"
                        data-ng-click="$ctrl.onValidateBtnClick()"
                    ></button>
                </div>
            </footer>
            <!-- FOOTER ACTIONS -->
        </section>
        <!-- LEFT PAGE -->

        <!-- RIGHT PAGE -->
        <section class="popover-page page-section">
            <header>
                <button
                    type="button"
                    class="btn btn-link back-btn fs20"
                    data-ng-click="$ctrl.menuCtrl.popoverStatus.move = false; $ctrl.state.collapse = false"
                    data-translate-attr="{ title: 'back' }"
                >
                    <i class="ovh-font ovh-font-arrow-left"></i>
                </button>

                <h2
                    data-ng-if="['greetSound', 'invalidSound', 'greetSoundTts', 'invalidSoundTts'].indexOf($ctrl.menuCtrl.popoverStatus.rightPage) > -1"
                    data-translate="telephony_number_feature_ovh_pabx_menu_options_sound_to_play"
                ></h2>

                <h2
                    data-ng-if="$ctrl.menuCtrl.popoverStatus.rightPage === 'greetSoundType' || $ctrl.menuCtrl.popoverStatus.rightPage === 'invalidSoundType'"
                    data-translate="telephony_number_feature_ovh_pabx_menu_options_sound_type_choice"
                ></h2>
            </header>

            <!-- GREET SOUND CHOICE -->
            <telephony-number-ovh-pabx-sound-popover-section
                data-ng-if="$ctrl.menuCtrl.popoverStatus.rightPage === 'greetSound'"
                data-ovh-pabx="$ctrl.menuCtrl.ovhPabx"
                data-selected-sound-id="$ctrl.menu.greetSound"
                data-on-sound-change="$ctrl.onSoundSelected"
            >
            </telephony-number-ovh-pabx-sound-popover-section>
            <!-- End of GREET SOUND CHOICE -->

            <!-- INVALID SOUND CHOICE -->
            <telephony-number-ovh-pabx-sound-popover-section
                data-ng-if="$ctrl.menuCtrl.popoverStatus.rightPage === 'invalidSound'"
                data-ovh-pabx="$ctrl.menuCtrl.ovhPabx"
                data-selected-sound-id="$ctrl.menu.invalidSound"
                data-on-sound-change="$ctrl.onSoundSelected"
            >
            </telephony-number-ovh-pabx-sound-popover-section>
            <!-- End of INVALID SOUND CHOICE -->

            <!-- SOUND TYPE SELECTION -->
            <section
                data-ng-if="$ctrl.menuCtrl.popoverStatus.rightPage === 'greetSoundType' || $ctrl.menuCtrl.popoverStatus.rightPage === 'invalidSoundType'"
            >
                <div class="section-group">
                    <label
                        class="section-item item-choice w-100 d-table"
                        data-ng-if="$ctrl.menuCtrl.popoverStatus.rightPage === 'invalidSoundType'"
                    >
                        <div class="d-table-cell align-middle radio-content">
                            <div class="radio">
                                <input
                                    type="radio"
                                    class="ml-1 position-relative"
                                    name="soundTypeChoice"
                                    data-ng-model="$ctrl.model[$ctrl.menuCtrl.popoverStatus.rightPage === 'greetSoundType' ? 'greetSoundType' : 'invalidSoundType']"
                                    data-ng-value="'none'"
                                    data-ng-change="$ctrl.onSoudTypeChange()"
                                />
                            </div>
                        </div>
                        <div class="d-table-cell align-middle">
                            <span
                                class="block"
                                data-translate="telephony_number_feature_ovh_pabx_menu_options_sound_type_none"
                            >
                            </span>
                        </div>
                    </label>
                    <label
                        class="section-item item-choice w-100 d-table"
                        data-ng-repeat="soundType in $ctrl.availableSoundTypes track by $index"
                    >
                        <div class="d-table-cell align-middle radio-content">
                            <div class="radio">
                                <input
                                    type="radio"
                                    class="ml-1 position-relative"
                                    name="soundTypeChoice"
                                    data-ng-model="$ctrl.model[$ctrl.menuCtrl.popoverStatus.rightPage === 'greetSoundType' ? 'greetSoundType' : 'invalidSoundType']"
                                    data-ng-value="soundType"
                                    data-ng-change="$ctrl.onSoudTypeChange()"
                                />
                            </div>
                        </div>
                        <div class="d-table-cell align-middle">
                            <span
                                class="block"
                                data-translate="{{ 'telephony_number_feature_ovh_pabx_menu_options_sound_type_' + soundType }}"
                            >
                            </span>
                        </div>
                    </label>
                </div>
            </section>
            <!-- End of SOUND TYPE SELECTION -->

            <!-- TTS CHOICE -->
            <section
                data-ng-if="$ctrl.menuCtrl.popoverStatus.rightPage === 'greetSoundTts' || $ctrl.menuCtrl.popoverStatus.rightPage === 'invalidSoundTts'"
            >
                <!-- TTS INFO -->
                <div
                    class="alert alert-info mb-0"
                    role="alert"
                    data-translate="telephony_number_feature_ovh_pabx_step_rule_tts_info"
                    data-translate-values="{
                        state: 'telecom.telephony.billingAccount.alias.details.configuration.ovhPabx.tts',
                    }"
                    data-translate-compile
                ></div>
                <!-- End of TTS INFO -->

                <!-- ADD TTS BTN -->
                <div class="section-group" data-ng-if="!$ctrl.state.collapse">
                    <button
                        type="button"
                        class="section-item large-popover-item text-left"
                        data-ng-click="$ctrl.onAddTtsButtonClick()"
                    >
                        <div class="d-table">
                            <div class="d-table-cell align-middle px-3">
                                <i class="ovh-font ovh-font-ajouter fs18"></i>
                            </div>
                            <div class="d-table-cell align-middle">
                                <label
                                    class="d-block radio-label-main"
                                    data-translate="telephony_number_feature_ovh_pabx_step_rule_tts_add"
                                >
                                </label>
                                <span
                                    class="small font-weight-normal"
                                    data-translate="telephony_number_feature_ovh_pabx_step_rule_tts_add_explain"
                                >
                                </span>
                            </div>
                        </div>
                    </button>
                </div>
                <!-- End of ADD TTS BTN -->

                <!-- ADD TTS FORM -->
                <div class="section-group" data-ng-if="$ctrl.state.collapse">
                    <div class="section-item">
                        <telephony-number-ovh-pabx-tts-create
                            data-ovh-pabx="$ctrl.menuCtrl.ovhPabx"
                            data-on-tts-creation-cancel="$ctrl.onTtsCreationCancel"
                            data-on-tts-creation-success="$ctrl.onTtsCreationSuccess"
                        >
                        </telephony-number-ovh-pabx-tts-create>
                    </div>
                </div>
                <!-- End of ADD TTS FORM -->

                <!-- TTS LIST -->
                <div class="section-group">
                    <div class="group-title">
                        <span
                            data-translate="telephony_number_feature_ovh_pabx_step_rule_tts_list"
                        ></span>
                    </div>

                    <div
                        class="section-item"
                        data-ng-if="$ctrl.menuCtrl.ovhPabx.tts.length === 0"
                    >
                        <em
                            data-translate="telephony_number_feature_ovh_pabx_step_rule_no_tts_added"
                        ></em>
                    </div>

                    <label
                        class="section-item item-choice w-100 d-table table-fixed"
                        data-ng-if="$ctrl.menuCtrl.ovhPabx.tts.length > 0"
                        data-ng-repeat="tts in $ctrl.menuCtrl.ovhPabx.tts | orderBy:'text' track by $index"
                    >
                        <div class="dtr">
                            <div
                                class="d-table-cell align-middle radio-content"
                            >
                                <div class="radio">
                                    <input
                                        class="ml-0 position-relative"
                                        type="radio"
                                        name="ruleAction"
                                        data-ng-model="$ctrl.menu[$ctrl.menuCtrl.popoverStatus.rightPage]"
                                        data-ng-value="tts.id"
                                        data-ng-change="$ctrl.menuCtrl.popoverStatus.move = false"
                                    />
                                </div>
                            </div>
                            <div class="d-table-cell align-middle">
                                <span
                                    class="d-block radio-label-main elipse no-wrap"
                                    data-ng-bind="tts.text"
                                >
                                </span>
                                <span
                                    class="small font-weight-normal"
                                    data-translate="{{ 'telephony_number_feature_ovh_pabx_tts_voice_' + tts.voice.toLowerCase() }}"
                                >
                                </span>
                            </div>
                        </div>
                    </label>
                </div>
                <!-- End of TTS LIST -->
            </section>
            <!-- End of TTS CHOICE -->
        </section>
        <!-- RIGHT PAGE -->
    </div>
</div>
