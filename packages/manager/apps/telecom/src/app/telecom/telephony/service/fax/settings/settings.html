<section class="telecom-telephony-service-fax-settings">
    <div class="text-center" data-ng-if="SettingsCtrl.loading.init">
        <oui-spinner></oui-spinner>
    </div>

    <tuc-toast-message></tuc-toast-message>

    <form
        name="SettingsCtrl.faxSettingsForm"
        data-ng-submit="SettingsCtrl.updateAllSettings()"
        data-ng-if="!SettingsCtrl.loading.init && SettingsCtrl.settings"
    >
        <div class="row">
            <div class="col-xs-12 col-md-6">
                <div class="widget-presentation mb-4">
                    <header class="widget-presentation-header">
                        <h2
                            class="widget-presentation-title"
                            data-translate="telephony_service_fax_settings_general_options"
                        ></h2>
                    </header>

                    <!-- FAX QUALITY -->
                    <div class="form-group">
                        <label
                            for="faxQuality"
                            class="control-label"
                            data-translate="telephony_service_fax_settings_general_options_fax_quality"
                        >
                        </label>
                        <select
                            name="faxQuality"
                            id="faxQuality"
                            class="form-control"
                            data-ng-model="SettingsCtrl.settings.faxQuality"
                            data-ng-options="quality as ('telephony_service_fax_settings_general_options_fax_quality_' + quality | translate) for quality in SettingsCtrl.enums.quality | orderBy:'':true"
                        >
                        </select>
                    </div>
                    <!-- .row -->

                    <!-- FAX MAX CALL -->
                    <div class="form-group">
                        <label
                            for="faxMaxCall"
                            class="control-label"
                            data-translate="telephony_service_fax_settings_general_options_fax_max_call"
                        >
                        </label>
                        <select
                            name="faxMaxCall"
                            id="faxMaxCall"
                            class="form-control"
                            data-ng-model="SettingsCtrl.settings.faxMaxCall"
                            data-ng-options="try as try for try in SettingsCtrl.enums.sendingTries"
                        >
                        </select>
                    </div>
                    <!-- .row -->
                </div>
            </div>
            <div class="col-xs-12 col-md-6">
                <div class="widget-presentation mb-4">
                    <header class="widget-presentation-header">
                        <h2
                            class="widget-presentation-title"
                            data-translate="telephony_service_fax_settings_header"
                        ></h2>
                    </header>

                    <!-- FAX TAG LINE -->
                    <div
                        class="form-group"
                        data-ng-class="{ 'has-error': faxTagLineForm.faxTagLine.$dirty && faxTagLineForm.faxTagLine.$invalid }"
                    >
                        <label
                            for="faxTagLine"
                            class="control-label"
                            data-translate="telephony_service_fax_settings_header"
                        >
                        </label>
                        <input
                            type="text"
                            name="faxTagLine"
                            id="faxTagLine"
                            class="form-control"
                            data-ng-model="SettingsCtrl.settings.faxTagLine"
                            data-ng-maxlength="50"
                        />
                        <span
                            class="help-block"
                            role="alert"
                            data-ng-if="faxTagLineForm.faxTagLine.$dirty"
                            data-ng-messages="faxTagLineForm.faxTagLine.$error"
                        >
                            <span
                                data-ng-message="maxlength"
                                data-translate="telephony_service_fax_settings_header_error_maxlength"
                            >
                            </span>
                        </span>
                    </div>

                    <div class="form-group">
                        <button
                            type="button"
                            class="btn btn-link p-0 m-0"
                            data-ng-click="SettingsCtrl.showFaxTag = !SettingsCtrl.showFaxTag"
                        >
                            <i
                                class="ovh-font"
                                data-ng-class="{
                                      'ovh-font-disclosure-right':!SettingsCtrl.showFaxTag,
                                      'ovh-font-disclosure-down':SettingsCtrl.showFaxTag
                                  }"
                                aria-hidden="true"
                            >
                            </i>
                            <span
                                data-translate="telephony_service_fax_settings_header_help"
                            ></span>
                        </button>
                        <table
                            class="table table-hover table-striped"
                            data-ng-if="SettingsCtrl.showFaxTag"
                        >
                            <tbody>
                                <tr>
                                    <td>|</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info0"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#01#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info1"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#02#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info2"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#03#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info3"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#04#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info4"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#05#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info5"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#06#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info6"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#07#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info7"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#08#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info8"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#09#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info8"
                                    ></td>
                                </tr>
                                <tr>
                                    <td>#10#</td>
                                    <td
                                        data-translate="telephony_service_fax_settings_header_help_info10"
                                    ></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- .row -->

        <div
            class="row"
            data-ng-if="!SettingsCtrl.loading.init && SettingsCtrl.settings"
        >
            <div class="col-xs-12 col-md-6">
                <div class="widget-presentation mb-4">
                    <header class="widget-presentation-header">
                        <h2
                            class="widget-presentation-title"
                            data-translate="telephony_service_fax_settings_notification_options"
                        ></h2>
                    </header>

                    <!-- FROM NAME -->
                    <div
                        class="form-group"
                        data-ng-class="{
                            'has-error': faxNotificationOptionsForm.fromName.$touched && faxNotificationOptionsForm.fromName.$invalid
                         }"
                    >
                        <label
                            for="fromName"
                            class="control-label"
                            data-translate="telephony_service_fax_settings_notification_options_from_name"
                        >
                        </label>
                        <input
                            type="text"
                            name="fromName"
                            id="fromName"
                            class="form-control"
                            required
                            data-ng-model="SettingsCtrl.settings.fromName"
                        />
                        <span
                            class="help-block"
                            role="alert"
                            data-ng-if="faxNotificationOptionsForm.fromName.$touched"
                            data-ng-messages="faxNotificationOptionsForm.fromName.$error"
                        >
                            <span
                                data-ng-message="required"
                                data-translate="telephony_service_fax_settings_notification_options_from_name_error_required"
                            >
                            </span>
                        </span>
                    </div>

                    <!-- FROM EMAIL -->
                    <div
                        class="form-group"
                        data-ng-class="{
                            'has-error': faxNotificationOptionsForm.fromEmail.$touched && faxNotificationOptionsForm.fromEmail.$invalid
                         }"
                    >
                        <label
                            for="fromEmail"
                            class="control-label"
                            data-translate="telephony_service_fax_settings_notification_options_from_email"
                        >
                        </label>
                        <input
                            type="email"
                            name="fromEmail"
                            id="fromEmail"
                            class="form-control"
                            data-ng-model="SettingsCtrl.settings.fromEmail"
                        />
                        <span
                            class="help-block"
                            role="alert"
                            data-ng-if="faxNotificationOptionsForm.fromEmail.$touched"
                            data-ng-messages="faxNotificationOptionsForm.fromEmail.$error"
                        >
                            <span
                                data-ng-message="email"
                                data-translate="telephony_service_fax_settings_notification_options_from_email_error_email"
                            >
                            </span>
                        </span>
                    </div>

                    <!-- MAIL FORMAT -->
                    <div class="form-group">
                        <label
                            for="mailFormat"
                            class="control-label"
                            data-translate="telephony_service_fax_settings_notification_options_mail_format"
                        >
                        </label>
                        <select
                            name="mailFormat"
                            id="mailFormat"
                            class="form-control"
                            data-ng-model="SettingsCtrl.settings.mailFormat"
                            data-ng-options="format as ('telephony_service_fax_settings_notification_options_mail_format_' + format | translate) for format in SettingsCtrl.enums.mailFormat"
                        >
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-md-6">
                <div class="widget-presentation mb-4">
                    <header class="widget-presentation-header">
                        <h2
                            class="widget-presentation-title"
                            data-translate="telephony_service_fax_settings_addresses_to_notify"
                        ></h2>
                    </header>
                    <ul
                        class="list-unstyled"
                        data-ng-if="SettingsCtrl.settings.redirectionEmail.length"
                    >
                        <li
                            data-ng-repeat="email in SettingsCtrl.settings.redirectionEmail | orderBy track by $index"
                        >
                            <div class="row mb-3">
                                <div class="col-xs-10">
                                    <span data-ng-bind="email"></span>
                                </div>
                                <div class="col-xs-2 text-right">
                                    <button
                                        type="button"
                                        class="btn btn-link p-0 m-0"
                                        data-ng-disabled="SettingsCtrl.addressesToNotifyForm.isAdding ||
                                                              SettingsCtrl.addressesToNotifyForm.isRemoving"
                                        data-ng-click="SettingsCtrl.removeRedirectionEmail(email)"
                                    >
                                        <i
                                            class="ovh-font ovh-font-bin"
                                            aria-hidden="true"
                                        ></i>
                                        <span
                                            class="sr-only"
                                            data-translate="delete"
                                        ></span>
                                    </button>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <div
                        class="alert alert-info"
                        data-ng-if="!SettingsCtrl.settings.redirectionEmail.length"
                    >
                        <span
                            data-translate="telephony_service_fax_settings_addresses_to_notify_empty"
                        ></span>
                    </div>
                    <div
                        data-ng-if="SettingsCtrl.addressesToNotifyForm.isShown"
                    >
                        <!-- REDIRECTION EMAIL -->
                        <div
                            class="form-group"
                            data-ng-class="{
                                'has-error': faxAddressesToNotifyForm.redirectionEmail.$touched && faxAddressesToNotifyForm.redirectionEmail.$invalid
                             }"
                        >
                            <input
                                type="email"
                                name="redirectionEmail"
                                id="redirectionEmail"
                                class="form-control"
                                required
                                autofocus
                                data-ng-model="SettingsCtrl.newRedirectionEmail"
                                data-translate-attr="{ placeholder: 'telephony_service_fax_settings_addresses_to_notify_placeholder' }"
                            />
                            <span
                                class="help-block"
                                role="alert"
                                data-ng-if="faxAddressesToNotifyForm.redirectionEmail.$touched"
                                data-ng-messages="faxAddressesToNotifyForm.redirectionEmail.$error"
                            >
                                <span
                                    data-ng-message="required"
                                    data-translate="telephony_service_fax_settings_addresses_to_notify_error_required"
                                >
                                </span>
                                <span
                                    data-ng-message="email"
                                    data-translate="telephony_service_fax_settings_addresses_to_notify_error_email"
                                >
                                </span>
                            </span>
                        </div>

                        <div class="form-group">
                            <button
                                type="cancel"
                                class="btn btn-default"
                                data-ng-disabled="SettingsCtrl.addressesToNotifyForm.isAdding"
                                data-ng-click="SettingsCtrl.cancelAddAddressesToNotifyForm()"
                            >
                                <span data-translate="cancel"></span>
                            </button>
                            <button
                                type="button"
                                class="btn btn-primary"
                                data-ng-click="SettingsCtrl.addRedirectionEmail(SettingsCtrl.newRedirectionEmail)"
                                data-ng-disabled="SettingsCtrl.faxSettingsForm.redirectionEmail.$invalid || SettingsCtrl.addressesToNotifyForm.isAdding || SettingsCtrl.addressesToNotifyForm.isRemoving"
                            >
                                <oui-spinner
                                    class="mr-2"
                                    data-ng-if="SettingsCtrl.addressesToNotifyForm.isAdding"
                                    data-size="s"
                                >
                                </oui-spinner>
                                <span data-translate="common_add"></span>
                            </button>
                        </div>
                    </div>

                    <button
                        type="button"
                        class="btn btn-primary mt-3 mb-1"
                        data-ng-if="!SettingsCtrl.addressesToNotifyForm.isShown && SettingsCtrl.settings.redirectionEmail.length < SettingsCtrl.addressesToNotifyForm.threshold"
                        data-ng-disabled="SettingsCtrl.addressesToNotifyForm.isAdding ||
                                          SettingsCtrl.addressesToNotifyForm.isRemoving"
                        data-ng-click="SettingsCtrl.addressesToNotifyForm.isShown = true"
                    >
                        <span
                            data-translate="telephony_service_fax_settings_addresses_to_notify_add"
                        ></span>
                    </button>
                    <div
                        class="alert alert-info"
                        data-ng-if="SettingsCtrl.settings.redirectionEmail.length >= 5 && !SettingsCtrl.addressesToNotifyForm.isAdding"
                    >
                        <p
                            data-translate="telephony_service_fax_settings_addresses_to_notify_info_limit"
                        ></p>
                    </div>
                </div>
            </div>
        </div>
        <!-- .row -->

        <div class="form-group">
            <hr />
            <tuc-telephony-bulk-action
                data-billing-account="{{ SettingsCtrl.bulkDatas.billingAccount }}"
                data-service-name="{{ SettingsCtrl.bulkDatas.serviceName }}"
                data-custom-class="link d-block pl-0 mb-3"
                data-ng-disabled="SettingsCtrl.faxSettingsForm.$invalid || SettingsCtrl.addressesToNotifyForm.isShown"
                data-bulk-infos="SettingsCtrl.bulkDatas.infos"
                data-filter-services="SettingsCtrl.filterServices"
                data-get-bulk-params="SettingsCtrl.getBulkParams"
                data-on-success="SettingsCtrl.onBulkSuccess"
                data-on-error="SettingsCtrl.onBulkError"
            >
            </tuc-telephony-bulk-action>

            <button
                type="submit"
                class="btn btn-primary"
                data-ng-disabled="SettingsCtrl.faxSettingsForm.$invalid || SettingsCtrl.addressesToNotifyForm.isShown"
            >
                <span
                    data-translate="telephony_service_fax_settings_notification_settings_update"
                ></span>
            </button>
        </div>
    </form>
</section>
<!-- .telecom-telephony-service-fax-settings -->
