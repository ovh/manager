<oui-header
    data-ng-if="$ctrl.header"
    class="mb-2"
    data-heading="{{:: $ctrl.header }}"
></oui-header>
<div data-ng-bind-html="$ctrl.description"></div>

<oui-datagrid
    id="{{ $ctrl.datagridId }}"
    data-empty-placeholder="{{:: 'domains_empty' | translate }}"
    data-page-size="{{ $ctrl.paginationSize }}"
    data-rows-loader="$ctrl.loadPage()"
    data-row-loader="$ctrl.loadResource($row)"
    data-criteria="$ctrl.criteria"
    data-on-page-change="$ctrl.onPageChange($pagination)"
    data-on-criteria-change="$ctrl.onCriteriaChange($criteria)"
    data-on-sort-change="$ctrl.onSortChange($sort)"
    data-columns="$ctrl.columnsConfig"
    data-on-columns-parameters-change="$ctrl.onColumnChange(id, columns)"
    data-page="{{ $ctrl.paginationNumber }}"
    data-on-row-select="$ctrl.onRowSelect($row, $rows)"
    data-selectable-rows
    data-customizable
>
    <oui-datagrid-topbar data-ng-if="$ctrl.topbarOptions">
        <topbar-cta data-options="$ctrl.topbarOptions"></topbar-cta>
    </oui-datagrid-topbar>
    <oui-datagrid-column
        data-title="::'domains_column_domain' | translate"
        data-property="domain"
        data-type="string"
        data-sortable
        data-filterable
        data-searchable
    >
        <a
            data-ng-href="{{:: $ctrl.getServiceNameLink($row) }}"
            data-ng-bind="$ctrl.constructor.convertToPunycode($value)"
        ></a>
        <button
            data-ng-if="$ctrl.isIdn($value)"
            type="button"
            class="oui-popover-button"
            data-oui-popover="{{::$ctrl.constructor.convertToPunycode($value)}}"
            data-oui-popover-placement="right"
        ></button>
    </oui-datagrid-column>
    <oui-datagrid-column
        data-title="::'domains_status' | translate"
        data-property="state"
        data-type="options"
        data-type-options="$ctrl.domainStateColumnOptions"
        data-sortable
    >
        <span
            class="{{:: 'oui-badge ' + $ctrl.DOMAINS_BADGES_STATUS[$value] }}"
            data-translate="{{:: 'domains_status_' + $value }}"
        >
        </span>
        <button
            data-ng-if="[$ctrl.DOMAIN_STATUS.RESTORABLE, $ctrl.DOMAIN_STATUS.PENDING_INCOMING_TRANSFER , $ctrl.DOMAIN_STATUS.DISPUTE, $ctrl.DOMAIN_STATUS.EXPIRED].includes($value)"
            type="button"
            class="oui-popover-button"
            data-oui-popover="{{::'domains_status_tooltip_' + $value | translate}}"
            data-oui-popover-placement="right"
        ></button>
    </oui-datagrid-column>
    <oui-datagrid-column
        data-title="::'domains_column_domains_tech_state' | translate"
        data-property="suspensionState"
        data-type="options"
        data-type-options="$ctrl.domainSuspensionStateColumnOptions"
        data-filterable
        data-sortable
    >
        <span
            class="{{ 'oui-badge ' + $ctrl.DOMAINS_BADGES_SUSPENSION_STATE[$value] }}"
            data-translate="{{ 'domains_suspension_state_' + $value }}"
        ></span>
        <button
            data-ng-if="$value === $ctrl.DOMAIN_SUSPENSION_STATE.SUSPENDED"
            type="button"
            class="oui-popover-button"
            data-oui-popover="{{::'domains_suspension_state_tooltip_' + $value | translate}}"
            data-oui-popover-placement="right"
        ></button>
        <button
            data-ng-if="$value === $ctrl.DOMAIN_SUSPENSION_STATE.NOT_SUSPENDED"
            type="button"
            class="oui-popover-button"
            data-oui-popover="{{::'domains_suspension_state_tooltip_' + $value | translate}}"
            data-oui-popover-placement="right"
        ></button>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_renewal_mode' | translate"
        data-type-options="$ctrl.domainRenewalModeColumnOptions"
        data-property="renewalState"
        data-type="options"
        data-sortable
    >
        <span
            class="{{:: 'oui-badge ' + $ctrl.DOMAINS_BADGES_RENEWAL_MODE[$value] }}"
            data-translate=" {{:: 'domains_renewal_mode_' + $value }}"
        ></span>
        <button
            data-ng-if="$value === $ctrl.DOMAIN_RENEWAL_MODE.UNPAID"
            type="button"
            class="oui-popover-button"
            data-oui-popover="{{::'domains_renewal_state_tooltip_' + $value | translate}}"
            data-oui-popover-placement="right"
        ></button>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_renewal_date' | translate"
        data-property="renewalDate"
        data-sortable
    >
        <span
            data-ng-bind=":: $ctrl.getDate($row, $ctrl.DOMAIN_OBJECT_KEYS.RENEWAL_DATE)"
        ></span>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_expiration_date' | translate"
        data-property="expirationDate"
        data-sortable
    >
        <span
            data-ng-bind=":: $ctrl.getDate($row, $ctrl.DOMAIN_OBJECT_KEYS.EXPIRATION_DATE)"
        ></span>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_contact_owner' | translate"
        data-property="contactOwner"
        data-type="string"
        data-searchable
        data-sortable
    >
        <div class="position-relative">
            <span data-ng-bind=":: $value.id"></span>
            <button
                type="button"
                class="oui-popover-button"
                data-oui-popover
                data-oui-popover-scope="$ctrl"
                data-oui-popover-placement="top"
                data-oui-popover-template="contactDetails.html"
                data-oui-popover-open="$rowIndex === $ctrl.contactPopover.rowIndex"
                data-ng-click="$ctrl.getContactDetails($value.id, $rowIndex)"
            ></button>
            <script type="text/ng-template" id="contactDetails.html">
                <span data-ng-bind=":: $ctrl.contactPopover.data.firstName + ' ' + $ctrl.contactPopover.data.lastName">
                </span>
                <br />
                <span data-ng-bind=":: $ctrl.contactPopover.data.organisationName">
                </span>
            </script>
        </div>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_admin_contact' | translate"
        data-property="contactAdmin"
        data-sortable
    >
        <a
            class="oui-link_icon"
            data-ng-if="$value.id === $ctrl.user.auth.account"
            data-ng-href="{{:: $ctrl.linkUserAccountBuilder($value.id)}}"
        >
            <span data-ng-bind=":: $value.id"></span>
            <span
                class="oui-icon oui-icon-external-link"
                aria-hidden="true"
            ></span>
        </a>
        <span
            data-ng-if="$value.id !== $ctrl.user.auth.account"
            data-ng-bind=":: $value.id"
        >
        </span>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_billing_contact' | translate"
        data-property="contactBilling"
        data-sortable
    >
        <a
            class="oui-link_icon"
            data-ng-if="$value.id === $ctrl.user.auth.account"
            data-ng-href="{{:: $ctrl.linkUserAccountBuilder($value.id)}}"
        >
            <span data-ng-bind=":: $value.id"></span>
            <span
                class="oui-icon oui-icon-external-link"
                aria-hidden="true"
            ></span>
        </a>
        <span
            data-ng-if="$value.id !== $ctrl.user.auth.account"
            data-ng-bind=":: $value.id"
        >
        </span>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_technical_contact' | translate"
        data-property="contactTech"
        data-sortable
    >
        <a
            class="oui-link_icon"
            data-ng-if="$value.id === $ctrl.user.auth.account"
            data-ng-href="{{:: $ctrl.linkUserAccountBuilder($value.id)}}"
        >
            <span data-ng-bind=":: $value.id"></span>
            <span
                class="oui-icon oui-icon-external-link"
                aria-hidden="true"
            ></span>
        </a>
        <span
            data-ng-if="$value.id !== $ctrl.user.auth.account"
            data-ng-bind=":: $value.id"
        >
        </span>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_name_server_type' | translate"
        data-property="nameServerType"
        data-type="options"
        data-type-options="$ctrl.domainNameServerTypeColumnOptions"
        data-filterable
        data-sortable
    >
        <span data-translate="{{ 'domains_dns_type_' + $value }}"></span>
    </oui-datagrid-column>

    <oui-datagrid-column
        data-title="::'domains_column_domains_name_server' | translate"
    ></oui-datagrid-column>

    <oui-action-menu text="Actions" compact>
        <oui-action-menu-item
            data-href="{{:: $ctrl.getServiceNameLink($row)}}"
            aria-label="{{:: 'domains_action_per_line_detail' | translate }}"
            data-ng-if="![$ctrl.DOMAIN_STATUS.PENDING_INCOMING_TRANSFER, $ctrl.DOMAIN_STATUS.PENDING_CREATE].includes($row.state)"
        >
            <span data-translate="domains_action_per_line_detail"></span>
        </oui-action-menu-item>
        <oui-action-menu-item
            on-click="$ctrl.goToRestoreRenew($row)"
            aria-label="{{:: $row.state === $ctrl.DOMAIN_STATUS.RESTORABLE ? 'domains_action_per_line_restore' : 'domains_action_per_line_renew' | translate }}"
            data-ng-if="$ctrl.constructor.isDomainRenewableOrRestorable($row)"
        >
            <span
                data-translate="{{ $row.state === $ctrl.DOMAIN_STATUS.RESTORABLE ? 'domains_action_per_line_restore' : 'domains_action_per_line_renew' }}"
            ></span>
        </oui-action-menu-item>
        <oui-action-menu-item
            data-href="{{:: $ctrl.CANCEL_LINK + $row.domain }}"
            aria-label="{{:: 'domains_action_per_line_cancellation' | translate }}"
            data-ng-if="$ctrl.constructor.isDomainCancellable($row)"
        >
            <span data-translate="domains_action_per_line_cancellation"></span>
        </oui-action-menu-item>
        <oui-action-menu-item
            data-href="{{:: $ctrl.ENABLE_AUTO_RENEW_LINK + $row.serviceId }}"
            aria-label="{{:: 'domains_action_per_line_autorenew_activate' | translate }}"
            data-ng-if="$row.renewalState === $ctrl.DOMAIN_RENEWABLE_STATE.MANUAL_RENEW"
        >
            <span
                data-translate="domains_action_per_line_autorenew_activate"
            ></span>
        </oui-action-menu-item>
        <oui-action-menu-item
            data-href="{{:: $ctrl.DISABLE_AUTO_RENEW_LINK + $row.serviceId }}"
            aria-label="{{:: 'domains_action_per_line_autorenew_deactivate' | translate }}"
            data-ng-if="$row.renewalState === $ctrl.DOMAIN_RENEWABLE_STATE.AUTOMATIC_RENEW"
        >
            <span
                data-translate="domains_action_per_line_autorenew_deactivate"
            ></span>
        </oui-action-menu-item>
    </oui-action-menu>
</oui-datagrid>

<div class="mt-5" data-ng-if="$ctrl.resources.data.length">
    <oui-button
        data-variant="secondary"
        data-disabled="!$ctrl.selectedRows.length"
        data-ng-click="$ctrl.goToRestoreRenew($ctrl.selectedRows)"
    >
        <span data-translate="domains_action_restore_renew"></span>
    </oui-button>
</div>
