import { PaginationState } from '@ovh-ux/manager-react-components';
import { TRegion } from '@/api/data/regions';

export const getLocalZoneRegions = (customerRegions: TRegion[] = []) =>
  customerRegions?.filter(({ type }) => type.includes('localzone')) || [];

export const isLocalZoneRegion = (regions: TRegion[], regionName: string) =>
  regions.some((region) => region.name === regionName);

export const paginateResults = <T>(
  items: T[],
  pagination: PaginationState,
) => ({
  rows: items.slice(
    pagination.pageIndex * pagination.pageSize,
    (pagination.pageIndex + 1) * pagination.pageSize,
  ),
  pageCount: Math.ceil(items.length / pagination.pageSize),
  totalRows: items.length,
});

const maxRandomNumber = 9999;

const getDate = () => {
  const date = new Date();
  return `${date.getDate()}${date.getMonth() + 1}`;
};

const getRandomNumber = () =>
  (Math.floor(Math.random() * maxRandomNumber) * new Date().getMilliseconds()) %
  maxRandomNumber;

export const getAutoGeneratedName = (prefix = ''): string => {
  const date = getDate();
  const randomNumber = getRandomNumber();
  const prefixPart = prefix ? `${prefix}-` : '';

  return `${prefixPart}${date}-${randomNumber}`;
};

export function isValidCidrMask(mask: number): boolean {
  return mask >= 8 && mask <= 29;
}

export function isValidIpAddress(ip: string): boolean {
  const regex = /^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
  return regex.test(ip);
}
