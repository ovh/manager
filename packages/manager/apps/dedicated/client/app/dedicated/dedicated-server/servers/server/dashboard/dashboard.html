<div data-ui-view="dashboard">
    <!-- Messages -->
    <!-- Install in progress -->
    <oui-message
        class="mb-3"
        data-type="info"
        data-dismissable
        data-ng-if="$ctrl.dedicatedServer.$scope.disable.installationInProgress && !$ctrl.dedicatedServer.$scope.disable.installationInProgressError"
    >
        <span data-translate="server_tab_dashboard_install_progress"> </span>
        <button
            type="button"
            class="oui-button oui-button__link p-1"
            data-translate="server_tab_dashboard_install_progress_link"
            data-ng-click="$ctrl.dedicatedServer.$scope.setAction('installation/progress/dedicated-server-installation-progress', { server: $ctrl.server, serverCtrl: $ctrl.dedicatedServer })"
        ></button>
    </oui-message>

    <!-- Install error -->
    <oui-message
        class="mb-3"
        data-type="error"
        data-dismissable
        data-ng-if="$ctrl.dedicatedServer.$scope.disable.installationInProgressError"
    >
        <span
            data-translate="server_tab_dashboard_install_error"
            data-translate-values="{ errorMessage: $ctrl.dedicatedServer.$scope.disable.installationInProgressError }"
        >
        </span>
    </oui-message>

    <!-- QUOTA -->
    <div class="mb-5" data-ng-if="$ctrl.trafficInformations.traffic.data.hasQuota"
        data-ng-include="'dedicated/server/consumption/consumption.html'">
    </div>

    <div class="row d-md-flex mb-5">
        <div class="col-md-4 mb-3">
            <!-- GENERAL INFORMATIONS -->
            <server-general-information
                data-server="$ctrl.server"
                data-eligible-data="$ctrl.eligibleData"
                data-ola="$ctrl.ola"
                data-dedicated-server="$ctrl.dedicatedServer"
                data-tracking-prefix="$ctrl.trackingPrefix"
                data-go-to-netboot="$ctrl.goToNetboot"
                data-info-server="$ctrl.infoServer"
            ></server-general-information>
        </div>

        <!-- TECHNICAL DETAILS -->
        <div class="col-md-4 mb-3" data-ng-if="$ctrl.technicalDetails">
            <server-technical-details
                technical-details="$ctrl.technicalDetails"
                go-to-upgrade="$ctrl.goToUpgrade"
                upgrade-task="$ctrl.upgradeTask"
            ></server-technical-details>
        </div>

        <!-- Service status -->
        <div
            class="col-md-4 mb-3"
            data-ng-if="$ctrl.server.commercialRange !== 'housing'"
        >
            <!-- STATE -->
            <oui-tile
                data-heading="{{ ::'server_services_state' | translate }}"
                class="mb-3 h-100"
            >
                <!-- Status -->
                <oui-tile-definition
                    data-term="{{ ::'server_configuration_state_title' | translate }}"
                >
                    <oui-tile-description>
                        <span
                            class="oui-badge"
                            data-ng-class="{
                                    'oui-badge_success': $ctrl.server.state === 'OK',
                                    'oui-badge_warning': $ctrl.server.state === 'ERROR',
                                    'oui-badge_error': $ctrl.server.state === 'HACKED' || $ctrl.server.state === 'HACKED_BLOCKED'
                                }"
                            data-translate="{{:: 'server_configuration_state_' + $ctrl.server.state}}"
                        >
                        </span>
                    </oui-tile-description>
                    <oui-action-menu
                        data-compact
                        aria-label="{{:: 'menu_action_label' | translate:{ t0: ('server_configuration_state_title' | translate)} }}"
                        data-placement="end"
                    >
                        <oui-action-menu-item
                            data-on-click="$ctrl.rebootServer()"
                            data-disabled="$ctrl.dedicatedServer.$scope.disable.reboot || $ctrl.dedicatedServer.$scope.disable.byOtherTask || $ctrl.dedicatedServer.$scope.disable.install"
                            data-ng-if="!$ctrl.server.isExpired"
                        >
                            <span
                                data-translate="server_configuration_reboot_title_button"
                            ></span>
                        </oui-action-menu-item>
                        <oui-action-menu-item
                            data-on-click="$ctrl.removeHack()"
                            data-disabled="$ctrl.server.state === 'HACKED_BLOCKED'"
                            data-ng-if="$ctrl.server.state === 'HACKED' || $ctrl.server.state === 'HACKED_BLOCKED'"
                        >
                            <span
                                data-translate="server_remove_hack_button"
                            ></span>
                        </oui-action-menu-item>
                        <oui-action-menu-item
                            data-ng-href="{{:: $ctrl.terminateLink }}"
                            data-ng-if="(!$ctrl.server.isExpired && !$ctrl.server.engagement)"
                        >
                            <span data-translate="server_close_service"></span>
                        </oui-action-menu-item>
                    </oui-action-menu>
                </oui-tile-definition>

                <!--Legacy monitoring options-->
                <oui-tile-definition
                    data-ng-if="!$ctrl.isMonitoringOptionsAvailable"
                    data-term="{{ ::'server_configuration_monitoring' | translate }}"
                >
                    <oui-tile-description>
                        <span
                            class="oui-badge"
                            data-ng-class="{
                                    'oui-badge_success': $ctrl.server.monitored,
                                    'oui-badge_error': !$ctrl.server.monitored
                                }"
                            data-translate="{{'server_configuration_monitoring_' + ($ctrl.server.monitored && 'activated' || 'disabled')}}"
                            data-oui-tooltip="{{ ($ctrl.server.monitored && 'server_configuration_monitoring_activate_information' | translate) || ('server_configuration_monitoring_deactivate_information' | translate) }}"
                            data-oui-tooltip-placement="top-start"
                        ></span>
                    </oui-tile-description>
                    <oui-action-menu
                        aria-label="{{:: 'menu_action_label' | translate:{t0: ('server_configuration_monitoring' | translate)} }}"
                        data-compact
                        data-placement="end"
                        data-disabled="$ctrl.ola.isConfigured() || $ctrl.updatingNoIntervention"
                        data-ng-if="!$ctrl.server.isExpired"
                    >
                        <oui-action-menu-item
                            data-ui-sref="app.dedicated-server.server.dashboard.monitoringLegacyUpdate"
                            data-ng-if="$ctrl.server.monitored"
                        >
                            <span
                                data-translate="server_configuration_monitoring_deactivate_title_button"
                            ></span>
                        </oui-action-menu-item>
                        <oui-action-menu-item
                            data-ui-sref="app.dedicated-server.server.dashboard.monitoringLegacyUpdate"
                            data-ng-if="!$ctrl.server.monitored"
                        >
                            <span
                                data-translate="server_configuration_monitoring_activate_title_button"
                            ></span>
                        </oui-action-menu-item>
                    </oui-action-menu>
                </oui-tile-definition>

                <!--Monitoring options-->
                <oui-tile-definition
                    data-ng-if="$ctrl.isMonitoringOptionsAvailable"
                    data-term="{{ ::'server_configuration_monitoring' | translate }}"
                >
                    <oui-tile-description>
                        <span
                            class="oui-badge"
                            data-ng-class="{
                                    'oui-badge_success': $ctrl.server.monitored,
                                    'oui-badge_warning': !$ctrl.server.monitored
                                }"
                            data-translate="server_configuration_monitoring_status_{{$ctrl.getMonitoringStatus()}}"
                            data-oui-tooltip="{{ ('server_configuration_monitoring_status_tooltip_' + $ctrl.getMonitoringStatus()) | translate }}"
                            data-oui-tooltip-placement="top-start"
                        ></span>
                    </oui-tile-description>
                    <oui-tile-description>
                        <oui-button
                            data-variant="link"
                            data-icon-right="oui-icon-chevron-right"
                            data-on-click="$ctrl.onMonitoringUpdateClick()"
                        >
                            <span
                                data-translate="server_configuration_monitoring_cta_setting"
                            ></span>
                        </oui-button>
                    </oui-tile-description>
                </oui-tile-definition>

                <!-- Links -->
                <oui-tile-definition
                    data-term="{{ ::'server_configuration_services_state_links' | translate }}"
                    class="border-bottom-0"
                >
                    <oui-tile-description>
                        <div class="oui-list">
                            <ul class="oui-list__items">
                                <li class="oui-list__item">
                                    <a
                                        class="oui-list__link oui-button_ghost"
                                        href="{{:: $ctrl.servicesStateLinks.weathermap}}"
                                        target="_blank"
                                        rel="noopener"
                                    >
                                        <span
                                            data-translate="server_configuration_services_state_links_weathermap"
                                        ></span>
                                        <span
                                            class="oui-icon oui-icon-external-link"
                                            aria-hidden="true"
                                        ></span>
                                        <span
                                            class="sr-only"
                                            data-translate="core_new_window"
                                        ></span>
                                    </a>
                                </li>
                                <li class="oui-list__item">
                                    <a
                                        class="oui-list__link oui-button_ghost"
                                        data-ng-if="$ctrl.servicesStateLinks.vms"
                                        href="{{:: $ctrl.servicesStateLinks.vms}}"
                                        target="_blank"
                                        rel="noopener"
                                    >
                                        <span
                                            data-translate="server_configuration_services_state_links_vms"
                                        ></span>
                                        <span
                                            class="oui-icon oui-icon-external-link"
                                            aria-hidden="true"
                                        ></span>
                                        <span
                                            class="sr-only"
                                            data-translate="core_new_window"
                                        ></span>
                                    </a>
                                </li>
                                <li class="oui-list__item">
                                    <a
                                        class="oui-list__link oui-button_ghost"
                                        href="{{:: $ctrl.servicesStateLinks.status }}"
                                        target="_blank"
                                        rel="noopener"
                                    >
                                        <span
                                            data-translate="server_configuration_services_state_links_travaux"
                                        ></span>
                                        <span
                                            class="oui-icon oui-icon-external-link"
                                            aria-hidden="true"
                                        ></span>
                                        <span
                                            class="sr-only"
                                            data-translate="core_new_window"
                                        ></span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </oui-tile-description>
                </oui-tile-definition>
            </oui-tile>
        </div>

        <!-- SUBSCRIPTION -->
        <div
            class="col-md-4 mb-3"
            data-ng-if="!$ctrl.technicalDetails && !$ctrl.nutanixCluster"
        >
            <billing-subscription-tile
                on-error="$ctrl.onBillingInformationError(error)"
                service-path="{{ '/dedicated/server/' + $ctrl.server.name }}"
                with-engagement="$ctrl.isCommitmentAvailable"
                go-to-commit="$ctrl.goToCommit()"
                go-to-cancel-commit="$ctrl.goToCancelCommit()"
                go-to-cancel-resiliation="$ctrl.goToCancelResiliation()"
                go-to-resiliation="$ctrl.goToResiliation()"
                service-infos="$ctrl.serviceInfos"
                highlight-engagement="$ctrl.server.shouldReengage"
                tracking-prefix="dedicated::dedicated::server::dashboard"
                user="$ctrl.user"
                commit-impression-data="$ctrl.server.shouldReengage ?
                    $ctrl.RECOMMIT_IMPRESSION_TRACKING_DATA :
                    $ctrl.COMMIT_IMPRESSION_TRACKING_DATA"
            >
                <billing-contact-actions>
                    <oui-action-menu-item
                        data-href="{{:: $ctrl.changeOwnerUrl }}"
                        data-external
                        data-disabled="$ctrl.server.state === 'HACKED' || $ctrl.server.state === 'HACKED_BLOCKED' || !$ctrl.changeOwnerAvailable"
                    >
                        <span data-translate="core_change_owner"></span>
                    </oui-action-menu-item>
                </billing-contact-actions>
                <billing-extra-information>
                    <dedicated-server-dashboard-professional-use
                        server="$ctrl.dedicatedServer.server"
                        service-infos="$ctrl.dedicatedServer.serviceInfos"
                    >
                    </dedicated-server-dashboard-professional-use>
                </billing-extra-information>
            </billing-subscription-tile>
        </div>

        <div class="col-md-4 mb-3" data-ng-if="!$ctrl.server.isExpired">
            <!-- Network -->
            <oui-tile
                class="h-100 mb-3"
                data-heading="{{:: 'server_network' | translate }}"
            >
                <div ovh-alert="bandwithError" data-ng-if="bandwithError"></div>

                <!-- IPv4 -->
                <oui-tile-definition
                    term="{{:: 'server_configuration_ipv4' | translate }}"
                >
                    <oui-tile-description>
                        <oui-clipboard
                            class="ip-clipboard"
                            data-model="$ctrl.server.ip"
                        >
                        </oui-clipboard>
                    </oui-tile-description>
                    <oui-action-menu
                        aria-label="{{:: 'menu_action_label' | translate:{t0: ('server_configuration_ipv4' | translate)} }}"
                        data-compact
                        data-placement="end"
                    >
                        <oui-action-menu-item
                            data-ui-sref="app.ip({serviceName: $ctrl.server.name})"
                        >
                            <span
                                data-translate="server_configuration_ipv4_manage"
                            ></span>
                        </oui-action-menu-item>
                    </oui-action-menu>
                </oui-tile-definition>

                <!-- Gateway IPv4-->
                <oui-tile-definition
                    term="{{:: 'server_configuration_gateway_ipv4' | translate }}"
                >
                    <oui-tile-description>
                        <oui-clipboard
                            class="ip-clipboard"
                            data-model="$ctrl.specifications.routing.ipv4.gateway"
                        >
                        </oui-clipboard>
                    </oui-tile-description>
                </oui-tile-definition>

                <!-- IPv6 -->
                <oui-tile-definition
                    term="{{:: 'server_configuration_ipv6' | translate }}"
                >
                    <oui-tile-description>
                        <oui-clipboard
                            class="ip-clipboard"
                            data-model="$ctrl.server.ipv6"
                        >
                        </oui-clipboard>
                    </oui-tile-description>
                </oui-tile-definition>
                <!-- Gateway IPv6-->
                <oui-tile-definition
                    term="{{:: 'server_configuration_gateway_ipv6' | translate }}"
                >
                    <oui-tile-description>
                        <oui-clipboard
                            class="ip-clipboard"
                            data-model="$ctrl.specifications.routing.ipv6.gateway"
                        >
                        </oui-clipboard>
                    </oui-tile-description>
                </oui-tile-definition>

                <div data-ng-if="$ctrl.bandwidthInformations.bandwidth">
                    <!-- Reverse -->
                    <oui-tile-definition
                        term="{{:: 'server_configuration_reverse' | translate }}"
                    >
                        <oui-tile-description>
                            <oui-clipboard
                                class="ip-clipboard"
                                data-model="$ctrl.server.reverse || ('server_configuration_reverse_not_configured' | translate)"
                            >
                            </oui-clipboard>
                        </oui-tile-description>
                        <oui-action-menu
                            aria-label="{{:: 'menu_action_label' | translate:{ t0: ('server_configuration_reverse' | translate) } }}"
                            data-compact
                            data-placement="end"
                        >
                            <oui-action-menu-item
                                data-ui-sref="app.dedicated-server.server.update-reverse-dns"
                            >
                                <span
                                    data-translate="server_configuration_reverse_edit_button"
                                ></span>
                            </oui-action-menu-item>
                            <oui-action-menu-item
                                data-ui-sref="app.dedicated-server.server.delete-reverse-dns"
                                data-ng-if="$ctrl.server.reverse"
                            >
                                <span data-translate="common_delete"></span>
                            </oui-action-menu-item>
                        </oui-action-menu>
                    </oui-tile-definition>

                    <server-bandwidth-dashboard
                        data-bandwidth-option="$ctrl.bandwidthInformations.bandwidthOption"
                        data-bandwidth-vrack-option="$ctrl.bandwidthInformations.bandwidthVrackOptions"
                        data-bandwidth-vrack-order-option="$ctrl.bandwidthInformations.bandwidthVrackOrderOptions"
                        data-order-private-link="$ctrl.orderPrivateBandwidthLink"
                        data-order-public-link="$ctrl.orderPublicBandwidthLink"
                        data-server="$ctrl.server"
                        data-specifications="$ctrl.specifications"
                        data-service-id="$ctrl.serviceInfos.serviceId"
                    >
                    </server-bandwidth-dashboard>

                    <!-- Traffic -->
                    <oui-tile-definition
                        data-ng-if="$ctrl.server.canOrderQuota"
                        data-term="{{:: 'server_traffic' | translate }}"
                    >
                        <oui-tile-description>
                            <span
                                data-ng-if="$ctrl.trafficInformations.traffic.data.usage.outputQuotaSize.text"
                                data-translate="server_traffic_text"
                                data-translate-values="{ t0: $ctrl.trafficInformations.traffic.data.usage.outputQuotaSize.text }"
                            >
                            </span>
                            <span
                                data-ng-if="!$ctrl.trafficInformations.traffic.data.usage.outputQuotaSize.text"
                                data-translate="server_traffic_unlimited_text"
                                data-translate-values="{ t0: (bandwidth.bandwidth.OvhToInternet | ducBandwidth) }"
                            >
                            </span>
                            <small
                                class="oui-tile__extra"
                                data-ng-if="trafficOption === 'released'"
                                data-translate="server_traffic_option_released"
                            >
                            </small>
                        </oui-tile-description>
                        <oui-action-menu
                            aria-label="{{:: 'menu_action_label' | translate:{ t0: ('server_traffic' | translate) } }}"
                            data-ng-if="($ctrl.trafficInformations.traffic.data.hasQuota && $ctrl.canOrderTraffic() && $ctrl.canOrderMoreTraffic()) || (!$ctrl.server.isExpired && trafficOption === 'subscribed')"
                            data-compact
                            data-placement="end"
                        >
                            <oui-action-menu-item
                                data-on-click="$ctrl.dedicatedServer.$scope.setAction('traffic/order/dedicated-server-traffic-order', $ctrl.server.name)"
                                data-disabled="$ctrl.server.state === 'HACKED' || $ctrl.server.state === 'HACKED_BLOCKED'"
                                data-ng-if="$ctrl.trafficInformations.traffic.data.hasQuota && $ctrl.canOrderTraffic() && $ctrl.canOrderMoreTraffic()"
                            >
                                <span
                                    data-ng-bind="(trafficOption !== 'subscribed' ? 'server_traffic_order_button' : 'server_traffic_change_button') | translate"
                                ></span>
                            </oui-action-menu-item>
                            <oui-action-menu-item
                                data-on-click="$ctrl.dedicatedServer.$scope.setAction('traffic/cancel/dedicated-server-traffic-cancel', $ctrl.server.name)"
                                data-disabled="$ctrl.server.state === 'HACKED' || $ctrl.server.state === 'HACKED_BLOCKED'"
                                data-ng-if="!$ctrl.server.isExpired && trafficOption === 'subscribed'"
                            >
                                <span
                                    data-translate="server_traffic_cancel_button"
                                ></span>
                            </oui-action-menu-item>
                        </oui-action-menu>
                    </oui-tile-definition>

                    <!-- OLA -->
                    <oui-tile-definition
                        data-ng-if="$ctrl.ola.isAvailable()"
                        data-term="{{:: 'server_ola' | translate}}"
                    >
                        <oui-tile-description>
                            <div data-ng-if="$ctrl.ola.isActivated()">
                                <span
                                    data-ng-if="$ctrl.ola.isConfigured()"
                                    data-translate="server_ola_mode_{{ $ctrl.ola.getCurrentMode() }}"
                                >
                                </span>
                                <span
                                    data-ng-if="!$ctrl.ola.isConfigured()"
                                    data-translate="server_ola_active"
                                >
                                </span>
                            </div>
                            <span
                                data-ng-if="!$ctrl.ola.isActivated()"
                                data-translate="server_ola_inactive"
                            ></span>
                        </oui-tile-description>
                        <oui-action-menu
                            aria-label="{{:: 'menu_action_label' | translate:{ t0: ('server_traffic' | translate) } }}"
                            data-compact
                            data-placement="end"
                        >
                            <oui-action-menu-item
                                data-ng-if="!$ctrl.ola.isActivated()"
                                data-ui-sref="app.dedicated-server.server.interfaces"
                            >
                                <span
                                    data-translate="server_ola_activate"
                                ></span>
                            </oui-action-menu-item>
                            <oui-action-menu-item
                                data-ng-if="$ctrl.ola.isConfigured()"
                                data-ui-sref="app.dedicated-server.server.interfaces.ola-reset"
                            >
                                <span data-translate="server_ola_reset"></span>
                            </oui-action-menu-item>
                            <oui-action-menu-item
                                data-ng-if="$ctrl.ola.isActivated() && !$ctrl.ola.isConfigured()"
                                data-ui-sref="app.dedicated-server.server.interfaces.ola-configuration"
                            >
                                <span
                                    data-translate="server_ola_configure"
                                ></span>
                            </oui-action-menu-item>
                        </oui-action-menu>
                    </oui-tile-definition>

                    <!-- vRack -->
                    <oui-tile-definition
                        data-ng-if="!!$ctrl.vrackInfos"
                        data-term="{{:: 'server_vrack' | translate}}"
                    >
                        <oui-tile-description>
                            <span
                                data-ng-if="!$ctrl.vrackInfos.length"
                                data-translate="server_vrack_none"
                            >
                            </span>
                            <div class="oui-list">
                                <ul
                                    class="oui-list__items"
                                    data-ng-if="$ctrl.vrackInfos.length"
                                >
                                    <li
                                        class="oui-list__item"
                                        data-ng-repeat="vrack in $ctrl.vrackInfos track by $index"
                                    >
                                        <span
                                            data-ng-bind="vrack.name || vrack.serviceName"
                                        ></span>
                                        (<span
                                            data-ng-bind="vrack.description"
                                        ></span
                                        >)
                                    </li>
                                </ul>
                            </div>
                        </oui-tile-description>
                    </oui-tile-definition>
                </div>
            </oui-tile>
        </div>

        <!-- SUBSCRIPTIONS -->
        <div
            class="col-md-4 mb-3"
            data-ng-if="$ctrl.technicalDetails && !$ctrl.nutanixCluster"
        >
            <billing-subscription-tile
                on-error="$ctrl.onBillingInformationError(error)"
                service-path="{{ '/dedicated/server/' + $ctrl.server.name }}"
                with-engagement="$ctrl.isCommitmentAvailable"
                go-to-commit="$ctrl.goToCommit()"
                go-to-cancel-commit="$ctrl.goToCancelCommit()"
                go-to-cancel-resiliation="$ctrl.goToCancelResiliation()"
                go-to-resiliation="$ctrl.goToResiliation()"
                service-infos="$ctrl.serviceInfos"
                highlight-engagement="$ctrl.server.shouldReengage"
                tracking-prefix="dedicated::dedicated::server::dashboard"
                user="$ctrl.user"
                commit-impression-data="$ctrl.server.shouldReengage ?
                    $ctrl.RECOMMIT_IMPRESSION_TRACKING_DATA :
                    $ctrl.COMMIT_IMPRESSION_TRACKING_DATA"
            >
                <billing-contact-actions>
                    <oui-action-menu-item
                        data-href="{{:: $ctrl.changeOwnerUrl }}"
                        data-external
                        data-disabled="$ctrl.server.state === 'HACKED' || $ctrl.server.state === 'HACKED_BLOCKED' || !$ctrl.changeOwnerAvailable"
                    >
                        <span data-translate="core_change_owner"></span>
                    </oui-action-menu-item>
                </billing-contact-actions>
                <billing-extra-information>
                    <dedicated-server-dashboard-professional-use
                        server="$ctrl.dedicatedServer.server"
                        service-infos="$ctrl.dedicatedServer.serviceInfos"
                    >
                    </dedicated-server-dashboard-professional-use>
                </billing-extra-information>
            </billing-subscription-tile>
        </div>

        <div
            class="col-md-4 mb-3"
            data-ng-if="!$ctrl.server.isExpired && $ctrl.biosSettings.sgx"
        >
            <dedicated-server-dashboard-advanced-features
                sgx="$ctrl.biosSettings.sgx"
                go-to-sgx-introduction="$ctrl.goToSgxIntroduction"
                go-to-sgx-manage="$ctrl.goToSgxManage"
                user="$ctrl.user"
            ></dedicated-server-dashboard-advanced-features>
        </div>
        <!-- Retention Advices -->
        <ovh-advices
            data-ng-if="!$ctrl.server.isExpired"
            class="col-md-4 mb-3"
            url="/retention/dedicated-server/:serviceName"
            url-params="{ serviceName: $ctrl.server.name }"
            advice-type="retention"
        >
        </ovh-advices>
        <!-- Advices -->
        <div class="col-md-4 mb-3" data-ng-if="!$ctrl.server.isExpired">
            <ovh-advices
                service-type="dedicated-server"
                recommander-range="baremetal"
                service-name="{{ ::$ctrl.server.name }}"
            >
            </ovh-advices>
        </div>
    </div>

</div>
