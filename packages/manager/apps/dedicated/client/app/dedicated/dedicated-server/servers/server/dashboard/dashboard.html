<div data-ui-view="dashboard">
    <!-- Messages -->
    <!-- Install in progress -->
    <oui-message
        class="mb-3"
        data-type="info"
        data-dismissable
        data-ng-if="$ctrl.dedicatedServer.$scope.disable.installationInProgress && !$ctrl.dedicatedServer.$scope.disable.installationInProgressError"
    >
        <span data-translate="server_tab_dashboard_install_progress"> </span>
        <button
            type="button"
            class="oui-button oui-button__link p-1"
            data-translate="server_tab_dashboard_install_progress_link"
            data-ng-click="$ctrl.dedicatedServer.$scope.setAction('installation/progress/dedicated-server-installation-progress', { server: $ctrl.server, serverCtrl: $ctrl.dedicatedServer })"
        ></button>
    </oui-message>

    <!-- Install error -->
    <oui-message
        class="mb-3"
        data-type="error"
        data-dismissable
        data-ng-if="$ctrl.dedicatedServer.$scope.disable.installationInProgressError"
    >
        <span
            data-translate="server_tab_dashboard_install_error"
            data-translate-values="{ errorMessage: $ctrl.dedicatedServer.$scope.disable.installationInProgressError }"
        >
        </span>
    </oui-message>

    <div class="row d-md-flex">
        <!-- GENERAL INFORMATIONS -->
        <div class="col-md-4 mb-3">
            <server-general-information
                data-server="$ctrl.server"
                data-eligible-data="$ctrl.eligibleData"
                data-ola="$ctrl.ola"
                data-dedicated-server="$ctrl.dedicatedServer"
                data-tracking-prefix="$ctrl.trackingPrefix"
                data-go-to-netboot="$ctrl.goToNetboot"
                data-info-server="$ctrl.infoServer"
            ></server-general-information>
        </div>

        <!-- TECHNICAL DETAILS -->
        <div class="col-md-4 mb-3" data-ng-if="$ctrl.technicalDetails">
            <server-technical-details
                data-technical-details="$ctrl.technicalDetails"
                data-go-to-upgrade="$ctrl.goToUpgrade"
                data-upgrade-task="$ctrl.upgradeTask"
            ></server-technical-details>
        </div>

        <!-- Service status -->
        <div
            class="col-md-4 mb-3"
            data-ng-if="$ctrl.server.commercialRange !== 'housing'"
        >
            <server-service-status
                data-server="$ctrl.server"
                data-dedicated-server="$ctrl.dedicatedServer"
                data-terminate-link="$ctrl.terminateLink"
                data-monitoring-protocol-enum="$ctrl.monitoringProtocolEnum"
                data-service-monitoring="$ctrl.serviceMonitoring"
                data-ola="$ctrl.ola"
                data-go-to-monitoring-update="$ctrl.goToMonitoringUpdate"
                data-is-monitoring-options-available="$ctrl.isMonitoringOptionsAvailable"
            ></server-service-status>
        </div>

        <!-- subscription if don't have technicalDetails -->
        <div
            class="col-md-4 mb-3"
            data-ng-if="!$ctrl.technicalDetails && !$ctrl.nutanixCluster"
        >
            <billing-subscription-tile
                on-error="$ctrl.onBillingInformationError(error)"
                service-path="{{ '/dedicated/server/' + $ctrl.server.name }}"
                with-engagement="$ctrl.isCommitmentAvailable"
                go-to-commit="$ctrl.goToCommit()"
                go-to-cancel-commit="$ctrl.goToCancelCommit()"
                go-to-cancel-resiliation="$ctrl.goToCancelResiliation()"
                go-to-resiliation="$ctrl.goToResiliation()"
                service-infos="$ctrl.serviceInfos"
                highlight-engagement="$ctrl.server.shouldReengage"
                tracking-prefix="dedicated::dedicated::server::dashboard"
                user="$ctrl.user"
                commit-impression-data="$ctrl.server.shouldReengage ?
                    $ctrl.RECOMMIT_IMPRESSION_TRACKING_DATA :
                    $ctrl.COMMIT_IMPRESSION_TRACKING_DATA"
            >
                <billing-contact-actions>
                    <oui-action-menu-item
                        data-href="{{:: $ctrl.changeOwnerUrl }}"
                        data-external
                        data-disabled="$ctrl.server.state === 'HACKED' || $ctrl.server.state === 'HACKED_BLOCKED' || !$ctrl.changeOwnerAvailable"
                    >
                        <span data-translate="core_change_owner"></span>
                    </oui-action-menu-item>
                </billing-contact-actions>
                <billing-extra-information>
                    <dedicated-server-dashboard-professional-use
                        server="$ctrl.dedicatedServer.server"
                        service-infos="$ctrl.dedicatedServer.serviceInfos"
                    >
                    </dedicated-server-dashboard-professional-use>
                </billing-extra-information>
            </billing-subscription-tile>
        </div>

        <!-- Network -->
        <div class="col-md-4 mb-3" data-ng-if="!$ctrl.server.isExpired">
            <server-network
                data-server="$ctrl.server"
                data-bandwidth="$ctrl.bandwidthInformations.bandwidth"
                data-bandwidth-informations="$ctrl.bandwidthInformations"
                data-tracking-prefix="$ctrl.trackingPrefix"
                data-specifications="$ctrl.specifications"
                data-service-infos="$ctrl.serviceInfos"
                data-order-private-bandwidth-link="$ctrl.orderPrivateBandwidthLink"
                data-order-public-bandwidth-link="$ctrl.orderPublicBandwidthLink"
                data-traffic-informations="$ctrl.trafficInformations"
                data-dedicated-server-feature-availability="$ctrl.DedicatedServerFeatureAvailability"
                data-dedicated-server="$ctrl.dedicatedServer"
                data-ola="$ctrl.ola"
            >
            </server-network>
        </div>

        <!-- subscription if have technicalDetails -->
        <div
            class="col-md-4 mb-3"
            data-ng-if="$ctrl.technicalDetails && !$ctrl.nutanixCluster"
        >
            <billing-subscription-tile
                on-error="$ctrl.onBillingInformationError(error)"
                service-path="{{ '/dedicated/server/' + $ctrl.server.name }}"
                with-engagement="$ctrl.isCommitmentAvailable"
                go-to-commit="$ctrl.goToCommit()"
                go-to-cancel-commit="$ctrl.goToCancelCommit()"
                go-to-cancel-resiliation="$ctrl.goToCancelResiliation()"
                go-to-resiliation="$ctrl.goToResiliation()"
                service-infos="$ctrl.serviceInfos"
                highlight-engagement="$ctrl.server.shouldReengage"
                tracking-prefix="dedicated::dedicated::server::dashboard"
                user="$ctrl.user"
                commit-impression-data="$ctrl.server.shouldReengage ?
                    $ctrl.RECOMMIT_IMPRESSION_TRACKING_DATA :
                    $ctrl.COMMIT_IMPRESSION_TRACKING_DATA"
            >
                <billing-contact-actions>
                    <oui-action-menu-item
                        data-href="{{:: $ctrl.changeOwnerUrl }}"
                        data-external
                        data-disabled="$ctrl.server.state === 'HACKED' || $ctrl.server.state === 'HACKED_BLOCKED' || !$ctrl.changeOwnerAvailable"
                    >
                        <span data-translate="core_change_owner"></span>
                    </oui-action-menu-item>
                </billing-contact-actions>
                <billing-extra-information>
                    <dedicated-server-dashboard-professional-use
                        server="$ctrl.dedicatedServer.server"
                        service-infos="$ctrl.dedicatedServer.serviceInfos"
                    >
                    </dedicated-server-dashboard-professional-use>
                </billing-extra-information>
            </billing-subscription-tile>
        </div>

        <div
            class="col-md-4 mb-3"
            data-ng-if="!$ctrl.server.isExpired && $ctrl.biosSettings.sgx"
        >
            <dedicated-server-dashboard-advanced-features
                data-sgx="$ctrl.biosSettings.sgx"
                data-go-to-sgx-introduction="$ctrl.goToSgxIntroduction"
                data-go-to-sgx-manage="$ctrl.goToSgxManage"
                data-user="$ctrl.user"
            ></dedicated-server-dashboard-advanced-features>
        </div>
        <!-- Retention Advices -->
        <ovh-advices
            data-ng-if="!$ctrl.server.isExpired"
            class="col-md-4 mb-3"
            url="/retention/dedicated-server/:serviceName"
            url-params="{ serviceName: $ctrl.server.name }"
            advice-type="retention"
        >
        </ovh-advices>
        <!-- Advices -->
        <div class="col-md-4 mb-3" data-ng-if="!$ctrl.server.isExpired">
            <ovh-advices
                service-type="dedicated-server"
                recommander-range="baremetal"
                service-name="{{ ::$ctrl.server.name }}"
            >
            </ovh-advices>
        </div>
    </div>

    <!-- QUOTA -->
    <div
        class="mb-3"
        data-ng-if="$ctrl.trafficInformations.traffic.data.hasQuota"
    >
        <consumption-tile
            data-server="$ctrl.server"
            data-traffic-informations="$ctrl.trafficInformations"
            data-dedicated-server="$ctrl.dedicatedServer"
        >
        </consumption-tile>
    </div>

    <!-- MRTG -->
    <div
        class="oui-tile mb-5"
        data-ng-if="!$ctrl.server.isExpired && $ctrl.displayMRTG()"
    >
        <h4
            class="oui-tile__title oui-heading_4"
            data-translate="server_tab_stats_legend_mrtg"
        ></h4>
        <p
            class="oui-tile__legend"
            data-translate="server_tab_stats_title_info"
        ></p>
        <div class="oui-tile__body">
            <div
                class="oui-tile__item text-center"
                data-ng-if="$ctrl.serverStatsLoad.loading"
            >
                <oui-spinner></oui-spinner>
            </div>
            <div
                class="oui-tile__item text-center"
                data-ng-if="!$ctrl.serverStatsLoad.loading"
            >
                <div class="oui-tile__definition">
                    <div class="oui-box mb-5">
                        <div
                            class="d-md-flex align-items-md-center justify-content-md-between"
                        >
                            <div>
                                <label
                                    for="networkChoice"
                                    class="oui-label d-inline-block align-middle mr-2"
                                    data-translate="server_tab_stats_network"
                                >
                                </label>
                                <div
                                    class="oui-select mb-0 oui-select_inline align-middle"
                                >
                                    <select
                                        class="oui-select__input"
                                        id="networkChoice"
                                        name="datatype"
                                        data-ng-model="$ctrl.serverStats.networkChoice"
                                        data-ng-change="$ctrl.getStatistics()"
                                    >
                                        <option
                                            data-ng-repeat="network in $ctrl.networks | orderBy:'displayName' track by network.id"
                                            data-ng-value="network.id"
                                            data-ng-disabled="network.disabled"
                                            data-ng-selected="{{ network.id === $ctrl.serverStats.networkChoice }}"
                                            data-ng-bind="network.displayName"
                                        >
                                        </option>
                                    </select>
                                    <span
                                        class="oui-icon oui-icon-chevron-down"
                                        aria-hidden="true"
                                    ></span>
                                </div>
                            </div>
                            <div class="oui-select">
                                <label
                                    for="typeChoice"
                                    class="oui-label d-inline-block align-middle mr-2"
                                    data-translate="server_tab_stats_type"
                                >
                                </label>
                                <div
                                    class="oui-select mb-0 oui-select_inline align-middle"
                                >
                                    <select
                                        class="oui-select__input"
                                        id="typeChoice"
                                        name="datatype"
                                        data-ng-options="('server_tab_stats_type_' + type | translate) for type in $ctrl.serverStats.modelconst.types"
                                        data-ng-model="$ctrl.serverStats.typeChoice"
                                        data-ng-change="$ctrl.getStatistics()"
                                    >
                                    </select>
                                    <span
                                        class="oui-icon oui-icon-chevron-down"
                                        aria-hidden="true"
                                    ></span>
                                </div>
                            </div>
                            <div class="oui-select">
                                <label
                                    for="periodeChoice"
                                    class="oui-label d-inline-block align-middle mr-2"
                                    data-translate="server_tab_stats_period"
                                >
                                </label>
                                <div
                                    class="oui-select mb-0 oui-select_inline align-middle"
                                >
                                    <select
                                        class="oui-select__input"
                                        id="periodeChoice"
                                        name="datatype"
                                        data-ng-options="('server_tab_stats_period_' + periode | translate) for periode in $ctrl.serverStats.modelconst.periods"
                                        data-ng-model="$ctrl.serverStats.periodeChoice"
                                        data-ng-change="$ctrl.getStatistics()"
                                    >
                                    </select>
                                    <span
                                        class="oui-icon oui-icon-chevron-down"
                                        aria-hidden="true"
                                    ></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <canvas
                        id="mrtgStatsChart"
                        class="chart chart-line"
                        data-ng-if="!$ctrl.serverStatsLoad.error"
                        data-chart-labels="$ctrl.labels"
                        data-chart-series="$ctrl.series"
                        data-chart-data="$ctrl.data"
                        data-chart-options="$ctrl.options"
                    >
                    </canvas>
                    <div
                        class="alert alert-danger"
                        role="alert"
                        data-ng-if="$ctrl.serverStatsLoad.error"
                        data-translate="server_tab_stats_no_chart"
                    ></div>
                </div>
            </div>
        </div>
    </div>
</div>
