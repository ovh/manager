<h1
    class="oui-back-button__title mb-3"
    data-ng-bind="$ctrl.localisedPageTitle"
></h1>
<p
    data-translate="server_os_install_ovh_description"
    data-translate-values="{ serverName: $ctrl.serviceName }"
></p>

<oui-stepper data-on-finish="$ctrl.saveRemainingSize()">
    <!-- Configure the OS -->
    <oui-step-form
        data-header="{{:: 'server_os_install_ovh_os_header' | translate}}"
        data-loading="$ctrl.loader.loading"
        data-editable="!$ctrl.loader.isInstalling"
        data-navigation="$ctrl.installation.selectDesktopType &&
            $ctrl.installation.selectLanguage &&
            $ctrl.installation.diskGroup &&
            $ctrl.installation.selectDistribution &&
            !$ctrl.installation.warningExistPartition &&
            !$ctrl.loader.loadingCapabilities"
        data-submit-text="{{ ::'server_os_install_ovh_next' | translate }}"
    >
        <!-- select OS type -->
        <oui-field
            label="{{ ::'server_os_install_ovh_os_type' | translate}}"
            size="xl"
        >
            <select
                class="form-control"
                id="selectDesktopType"
                name="selectDesktopType"
                data-ng-options="desktop as ('server_configuration_installation_ovh_desktop_' + desktop | translate) for desktop in $ctrl.installation.desktopType"
                data-ng-model="$ctrl.installation.selectDesktopType"
                data-ng-change="$ctrl.installation.hasData = false; $ctrl.setSelectDistribution(null);"
            >
            </select>
        </oui-field>
        <p data-ng-if="$ctrl.hasLicencedOs()">
            <span
                data-translate="server_configuration_installation_ovh_step1_desktop_licence_info_label"
            ></span>
            <i
                class="oui-icon oui-icon-help-circle"
                data-oui-tooltip="{{:: 'server_configuration_installation_ovh_step1_desktop_licence_info_text' | translate }}"
                data-oui-tooltip-placement="bottom"
            >
            </i>
        </p>

        <!-- select os -->
        <div class="container-fluid px-0">
            <div class="row">
                <oui-select-picker
                    class="d-inline-block col-md-6 col-xl-3 my-3"
                    data-ng-repeat="family in $ctrl.installation.formatedDistributionList[$ctrl.installation.selectDesktopType] track by $index"
                    label="{{ family.name }}"
                    variant="light"
                    model="$ctrl.installation.selectDistribution"
                    match="displayName"
                    values="family.templates"
                    required
                    on-change="$ctrl.setSelectDistribution(modelValue)"
                >
                </oui-select-picker>
            </div>
            <!-- depricated warning and OS not supported error -->
            <oui-message
                type="warning"
                data-ng-if="$ctrl.installation.selectDistribution.isDeprecated"
            >
                <span
                    data-translate="server_os_install_ovh_os_deprecated"
                    data-translate-values="{ osName: $ctrl.installation.selectDistribution.displayName }"
                ></span>
            </oui-message>
            <oui-message
                type="warning"
                data-ng-if="$ctrl.server.raidController && $ctrl.installation.selectDistribution && !$ctrl.installation.selectDistribution.hardRaidConfiguration"
            >
                <span
                    data-translate="server_configuration_installation_ovh_step1_hardwareRaid_os_not_supported_short"
                ></span>
            </oui-message>
            <oui-message type="error" data-ng-if="!$ctrl.hasVirtualDesktop()">
                <span
                    data-translate="server_configuration_installation_ovh_step1_virtual_desktop_not_supported"
                    data-translate-values="{ t0: $ctrl.installation.selectDistribution.displayName, t1: $ctrl.LICENSE_URL }"
                ></span>
            </oui-message>
        </div>
        <!-- select language -->
        <oui-field
            class="pt-1"
            label="{{ ::'server_os_install_ovh_os_language' | translate}}"
            size="xl"
        >
            <select
                class="form-control"
                id="selectLanguage"
                name="selectLanguage"
                data-ng-options="language as language for language in $ctrl.installation.selectDistribution.availableLanguages"
                data-ng-model="$ctrl.installation.selectLanguage"
                data-ng-disabled="!$ctrl.installation.selectDistribution || $ctrl.installation.warningExistPartition"
            >
            </select>
        </oui-field>
        <!-- select disk group -->
        <oui-field
            label="{{ ::'server_configuration_installation_ovh_step1_disk_group' | translate}}"
            size="xl"
        >
            <select
                id="diskGroup"
                name="diskGroup"
                class="form-control"
                data-ng-model="$ctrl.installation.diskGroup"
                data-ng-options="diskGroup as diskGroup.description for diskGroup in $ctrl.informations.diskGroups track by diskGroup.diskGroupId"
                data-ng-disabled="!$ctrl.canEditDiskGroup()"
            >
            </select>
        </oui-field>

        <!-- error message -->
        <oui-message
            type="error"
            class="pb-2"
            data-ng-if="$ctrl.canEditDiskGroup() && $ctrl.raidIsPersonnalizable()"
        >
            <span
                data-translate="server_configuration_installation_ovh_step1_disk_group_warning"
                data-translate-values="{ t0: $ctrl.informations.diskGroups[0].description }"
            >
            </span>
        </oui-message>
        <oui-message
            type="error"
            class="pb-2"
            data-ng-if="$ctrl.installation.selectDistribution.hardRaidConfiguration === false"
        >
            <span
                data-translate="server_configuration_installation_ovh_step1_hardwareRaid_os_not_supported"
            >
            </span>
        </oui-message>
        <oui-message
            type="error"
            class="pb-2"
            data-ng-if="$ctrl.informations.hardwareRaid.error.wrongLocation"
        >
            <span
                data-translate="server_configuration_installation_ovh_step1_hardwareRaid_wrong_location"
            >
            </span>
        </oui-message>

        <oui-spinner
            class="align-middle"
            aria-label="{{ 'common_loading' | translate }}"
            data-ng-if="$ctrl.loader.loadingCapabilities"
            data-size="s"
        >
        </oui-spinner>

        <!-- existing partition warning -->
        <div data-ng-if="$ctrl.installation.warningExistPartition">
            <oui-message type="error">
                <span
                    data-ng-bind-html="'server_configuration_installation_ovh_step1_warning_exist' | translate:{ t0: $ctrl.installation.selectDistribution.displayName }"
                >
                </span>
            </oui-message>
            <p class="text-center mb-3 mt-3">
                <button
                    type="button"
                    class="btn btn-link"
                    data-ng-click="$ctrl.cancelSetSelectDistribution()"
                    data-translate="server_configuration_installation_ovh_step1_warning_exist_cancel"
                ></button>
                <button
                    type="button"
                    class="btn btn-default"
                    data-ng-click="$ctrl.setSelectDistribution($ctrl.installation.saveSelectDistribution, true)"
                    data-translate="server_configuration_installation_ovh_step1_warning_exist_valid"
                ></button>
            </p>
        </div>
    </oui-step-form>

    <!-- Configure Hardware RAID -->
    <oui-step-form
        data-header="{{:: 'server_os_install_ovh_hardware_raid_header' | translate}}"
        data-ng-if="$ctrl.installation.raidSetup"
        data-submit-text="{{ ::'server_os_install_ovh_next' | translate }}"
        data-editable="!$ctrl.loader.isInstalling"
        data-navigation="$ctrl.installation.hardwareRaid.controller
            && $ctrl.installation.hardwareRaid.raid
            && $ctrl.installation.hardwareRaid.disks
            && $ctrl.installation.hardwareRaid.arrays
            && !$ctrl.installation.hardwareRaid.error"
    >
        <server-os-install-hardware-raid
            installation="$ctrl.installation"
            informations="$ctrl.informations"
            data-ng-if="$ctrl.installation.selectLanguage && $ctrl.installation.selectDistribution"
        >
        </server-os-install-hardware-raid>
    </oui-step-form>

    <!-- Configure Partition -->
    <oui-step-form
        data-header="{{:: 'server_os_install_ovh_partition_header' | translate}}"
        data-on-focus="$ctrl.onPartitionFocus()"
        data-submit-text="{{ ::'server_os_install_ovh_next' | translate }}"
        data-loading="$ctrl.loader.loadingPartition"
        data-editable="!$ctrl.loader.isInstalling"
        data-navigation="!$ctrl.newPartition.display
            && !$ctrl.setPartition.save
            && !$ctrl.setPartition.delModel
            && !$ctrl.configError.raidDiskUse
            && !$ctrl.errorInst.partitionSizeOver"
    >
        <p
            data-ng-if="$ctrl.installation.partitionSchemesList.length === 0"
            data-translate="server_configuration_installation_ovh_step2_error_empty_scheme"
            data-translate-values="{ t0: $ctrl.serverName, t1: $ctrl.installation.selectDistribution.displayName }"
        ></p>

        <div data-ng-if="$ctrl.installation.partitionSchemesList.length > 0">
            <div
                data-ng-bind-html="'server_configuration_installation_ovh_step2_info' | translate:{ t0: $ctrl.installation.selectDistribution.displayName }"
            ></div>

            <p data-ng-if="$ctrl.informations.isCachecade">
                <span class="icon-info-sign" aria-hidden="true"></span>
                <span
                    data-translate="server_configuration_installation_ovh_step2_info_partition_cachecade"
                ></span>
            </p>

            <!-- <oui-field
                label="{{:: 'server_configuration_installation_ovh_step2_type_disk' | translate}}"
                size="xl"
                data-ng-if="$ctrl.informations.nbDisk > 1"
                class="mt-2">
                <select
                    class="form-control"
                    data-ng-options="nbDisk as nbDisk for nbDisk in $ctrl.getNbDisqueList($ctrl.informations.nbDisk)"
                    data-ng-model="$ctrl.installation.nbDiskUse"
                    data-ng-disabled="$ctrl.setPartition.indexSet != -1 || $ctrl.newPartition.display"
                >
                </select>
            </oui-field> -->

            <dl class="oui-description">
                <dt
                    data-translate="server_configuration_installation_ovh_step2_type_disk"
                ></dt>
                <dd>
                    <span
                        data-ng-bind="$ctrl.informations.nbPhysicalDisk"
                    ></span>
                    <span data-ng-bind="$ctrl.informations.typeDisk"></span>
                </dd>
                <dt
                    data-translate="server_configuration_installation_ovh_step2_total_size"
                ></dt>
                <dd>
                    <span
                        data-ng-bind="$ctrl.getDisplaySize($ctrl.informations.totalSize)"
                    ></span>
                </dd>
                <dt
                    data-translate="server_configuration_installation_ovh_step2_remaining_size"
                ></dt>
                <dd>
                    <span
                        data-ng-bind="$ctrl.getDisplaySize($ctrl.informations.remainingSize)"
                    ></span>
                </dd>
            </dl>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>
                                <span
                                    class="oui-icon oui-icon-help-circle"
                                    data-oui-tooltip="{{:: 'server_configuration_installation_ovh_step2_available_order_help' | translate }}"
                                    data-oui-tooltip-placement="right"
                                >
                                </span>
                            </th>
                            <th
                                data-translate="server_configuration_installation_ovh_step2_type"
                            ></th>
                            <th
                                data-translate="server_configuration_installation_ovh_step2_file_system"
                            ></th>
                            <th
                                data-translate="server_configuration_installation_ovh_step2_mount_point"
                            ></th>
                            <th
                                data-translate="server_configuration_installation_ovh_step2_volume_name"
                            ></th>
                            <th
                                data-ng-if="$ctrl.installation.nbDiskUse > 1 && !$ctrl.informations.raidController"
                            >
                                <span
                                    data-translate="server_configuration_installation_ovh_step2_raid"
                                ></span>
                                <span
                                    class="icon-question-sign icon-white"
                                    data-oui-tooltip="{{:: 'server_configuration_installation_ovh_step2_raid_help' | translate }}"
                                    data-oui-tooltip-placement="left"
                                >
                                </span>
                            </th>
                            <th>
                                <span
                                    data-translate="server_configuration_installation_ovh_step2_available_size"
                                ></span>
                                <span
                                    class="icon-question-sign icon-white"
                                    data-oui-tooltip="{{:: 'server_configuration_installation_ovh_step2_available_size_help' | translate }}"
                                    data-oui-tooltip-placement="left"
                                >
                                </span>
                            </th>
                            <th
                                data-ng-if="$ctrl.installation.nbDiskUse > 1 && !$ctrl.informations.raidController"
                            >
                                <span
                                    data-translate="server_configuration_installation_ovh_step2_size"
                                ></span>
                                <span
                                    class="icon-question-sign icon-white"
                                    data-oui-tooltip="{{:: 'server_configuration_installation_ovh_step2_size_help' | translate }}"
                                    data-oui-tooltip-placement="left"
                                >
                                </span>
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr
                            data-ng-repeat="partition in $ctrl.installation.partitionSchemeModels | orderBy:'orderTable'"
                            data-ng-class="{
                                'deleting': partition == $ctrl.installation.partitionSchemeModels[setPartition.delModel]
                            }"
                        >
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.isSetPartition(partition) && $ctrl.hasErrorOrder()
                                }"
                            >
                                <span
                                    data-ng-if="!$ctrl.isSetPartition(partition)"
                                    data-ng-bind="partition.order"
                                >
                                </span>
                                <input
                                    type="number"
                                    class="form-control"
                                    min="1"
                                    max="99"
                                    data-ng-if="$ctrl.isSetPartition(partition)"
                                    data-ng-model="partition.order"
                                    data-ng-change="$ctrl.validationOrder(partition)"
                                />
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.isSetPartition(partition) && $ctrl.hasErrorType()
                                }"
                            >
                                <span
                                    data-ng-if="!$ctrl.isSetPartition(partition)"
                                    data-translate="{{ 'server_configuration_installation_' + partition.typePartition }}"
                                >
                                </span>
                                <select
                                    class="form-control"
                                    data-ng-if="$ctrl.isSetPartition(partition)"
                                    data-ng-options="type as ('server_configuration_installation_' + type | translate) for type in $ctrl.constants.partitionTypeList"
                                    data-ng-model="partition.typePartition"
                                    data-ng-change="$ctrl.validationType(partition)"
                                >
                                </select>
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.isSetPartition(partition) && $ctrl.hasErrorFileSystem()
                                }"
                            >
                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition) && partition.fileSystem != $ctrl.constants.warningSwap"
                                    data-translate="{{ 'server_configuration_installation_' + partition.fileSystem }}"
                                >
                                </span>
                                <select
                                    class="form-control"
                                    data-ng-if="$ctrl.isSetPartition(partition) && partition.fileSystem != $ctrl.constants.warningSwap"
                                    data-ng-options="fileSystem as ('server_configuration_installation_' + fileSystem | translate) for fileSystem in $ctrl.constants.fileSystemList"
                                    data-ng-model="partition.fileSystem"
                                    data-ng-change="$ctrl.validationFileSystem(partition)"
                                >
                                </select>
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.isSetPartition(partition) && $ctrl.hasErrorMountPoint()
                                }"
                            >
                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition) && partition.fileSystem != $ctrl.constants.warningSwap"
                                    data-ng-bind="partition.mountPoint"
                                >
                                </span>
                                <input
                                    type="text"
                                    class="form-control"
                                    data-ng-if="$ctrl.isSetPartition(partition) && partition.fileSystem != $ctrl.constants.warningSwap"
                                    data-ng-model="partition.mountPoint"
                                    data-ng-required="true"
                                    data-ng-change="$ctrl.validationMountPoint(partition)"
                                    data-ng-disabled="!$ctrl.validation.hasSwap && partition.fileSystem == $ctrl.constants.warningSwap"
                                />
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.isSetPartition(partition) && $ctrl.hasErrorVolumeName()
                                }"
                            >
                                <span
                                    data-ng-if="partition.typePartition != $ctrl.constants.warningLV || $ctrl.errorInst.typeLvSwap"
                                >
                                    -
                                </span>
                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition) || partition.typePartition != $ctrl.constants.warningLV"
                                    data-ng-bind="partition.volumeName"
                                >
                                </span>
                                <input
                                    type="text"
                                    data-ng-if="$ctrl.isSetPartition(partition) && partition.typePartition == $ctrl.constants.warningLV && !$ctrl.errorInst.typeLvSwap"
                                    data-ng-model="partition.volumeName"
                                    data-ng-required="partition.typePartition == $ctrl.constants.warningLV"
                                    data-ng-change="$ctrl.validationVolumeName(partition)"
                                />
                            </td>
                            <td
                                class="form-group"
                                data-ng-if="$ctrl.installation.nbDiskUse > 1 && !$ctrl.informations.raidController"
                                data-ng-class="{
                                    'has-error': $ctrl.isSetPartition(partition) && $ctrl.hasErrorRaid()
                                }"
                            >
                                <span
                                    data-ng-if="partition.fileSystem == $ctrl.constants.warningSwap"
                                >
                                    -
                                </span>
                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition) || partition.fileSystem == $ctrl.constants.warningSwap"
                                    data-ng-bind="partition.raid.replace('_', '')"
                                >
                                </span>
                                <select
                                    class="form-control"
                                    data-ng-if="$ctrl.isSetPartition(partition) && partition.fileSystem != $ctrl.constants.warningSwap"
                                    data-ng-options="raid as raid.replace('_', '') for raid in $ctrl.getRaidList($ctrl.installation.nbDiskUse)"
                                    data-ng-model="partition.raid"
                                    data-ng-change="$ctrl.validationRaid(partition)"
                                >
                                </select>
                                <span
                                    class="oui-icon oui-icon-warning-circle"
                                    aria-label="{{ 'server_configuration_installation_ovh_step2_error_raid_diskUse_icon' | translate }}"
                                    data-ng-if="partition.hasWarning && !$ctrl.isSetPartition(partition)"
                                    data-oui-tooltip="{{:: 'server_configuration_installation_ovh_step2_error_raid_diskUse_icon' | translate }}"
                                    data-oui-tooltip-placement="top"
                                >
                                </span>
                                <span
                                    class="oui-icon oui-icon-warning-circle"
                                    aria-label="{{ 'server_configuration_installation_ovh_step2_error_raid_0' | translate }}"
                                    data-ng-if="!partition.hasWarning && !$ctrl.isSetPartition(partition) && partition.raid == $ctrl.constants.warningRaid0"
                                    data-oui-tooltip="{{:: 'server_configuration_installation_ovh_step2_error_raid_0' | translate }}"
                                    data-oui-tooltip-placement="top"
                                >
                                </span>
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.isSetPartition(partition) && $ctrl.hasErrorSize()
                                }"
                            >
                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition) || partition.fileSystem != $ctrl.constants.warningSwap"
                                    data-ng-bind="$ctrl.installation.nbDiskUse"
                                >
                                </span>
                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition) || partition.fileSystem != $ctrl.constants.warningSwap"
                                >
                                    x
                                </span>
                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition) || partition.fileSystem != $ctrl.constants.warningSwap"
                                    data-ng-bind="$ctrl.getDisplaySize(partition.partitionSize)"
                                >
                                </span>

                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition) || partition.fileSystem == $ctrl.constants.warningSwap"
                                    data-ng-bind="$ctrl.getDisplaySize(partition.partitionSize)"
                                >
                                </span>
                                <div class="input-group">
                                    <span
                                        class="input-group-btn"
                                        data-ng-if="$ctrl.isSetPartition(partition)"
                                    >
                                        <button
                                            type="button"
                                            class="btn btn-default"
                                            data-ng-click="$ctrl.getFullSize(partition)"
                                            title="{{ 'server_configuration_installation_ovh_step2_remaining_size_button' | translate }}"
                                        >
                                            <span
                                                class="oui-icon oui-icon-expansion-arrows_concept"
                                                aria-hidden="true"
                                            ></span>
                                        </button>
                                    </span>
                                    <input
                                        type="number"
                                        class="form-control"
                                        maxlength="10"
                                        max="9999999999"
                                        data-ng-if="$ctrl.isSetPartition(partition)"
                                        data-ng-model="partition.partitionSize"
                                        data-ng-change="$ctrl.validationSize(partition)"
                                    />
                                    <span
                                        class="input-group-addon"
                                        data-ng-if="$ctrl.isSetPartition(partition)"
                                        data-translate="unit_size_MB"
                                    >
                                    </span>
                                </div>
                            </td>
                            <td
                                data-ng-if="$ctrl.installation.nbDiskUse > 1 && !$ctrl.informations.raidController"
                            >
                                <span
                                    data-ng-hide="$ctrl.isSetPartition(partition)"
                                    data-ng-bind="$ctrl.getRealDisplaySize({partition: partition})"
                                >
                                </span>
                                <span
                                    data-ng-if="$ctrl.isSetPartition(partition)"
                                    data-ng-bind="$ctrl.getRealDisplaySize({
                                            partition: partition,
                                            multiplicator: partition.unit.value
                                        })"
                                >
                                </span>
                            </td>
                            <td>
                                <button
                                    type="button"
                                    class="btn btn-link"
                                    data-ng-hide="$ctrl.setPartition.save || $ctrl.newPartition.display || $ctrl.setPartition.delModel != null"
                                    data-ng-click="!$ctrl.setPartition.save && !$ctrl.newPartition.display && $ctrl.setPartition.delModel == null && $ctrl.displaySetPartition(partition)"
                                >
                                    <span
                                        class="oui-icon oui-icon-pen_concept"
                                        aria-hidden="true"
                                    ></span>
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-link"
                                    data-ng-hide="!partition.canBeDelete || $ctrl.setPartition.save || $ctrl.newPartition.display || $ctrl.setPartition.delModel != null"
                                    data-ng-click="partition.canBeDelete && !$ctrl.setPartition.save && !$ctrl.newPartition.display && $ctrl.setPartition.delModel == null && $ctrl.deletePartition(partition)"
                                >
                                    <span
                                        class="oui-icon oui-icon-trash_concept"
                                        aria-hidden="true"
                                    ></span>
                                </button>

                                <button
                                    type="button"
                                    class="btn btn-link"
                                    data-ng-if="!$ctrl.buttonControl.setInProgress && !$ctrl.buttonControl.displayAddConfirmation && $ctrl.isSetPartition(partition) && !$ctrl.newPartition.display && !$ctrl.errorInst.partitionSizeOver"
                                    data-ng-click="!$ctrl.buttonControl.setInProgress && !$ctrl.buttonControl.displayAddConfirmation && $ctrl.isSetPartition(partition) && !$ctrl.newPartition.display && !$ctrl.errorInst.partitionSizeOver && $ctrl.validSetPartition()"
                                >
                                    <span
                                        class="oui-icon oui-icon-success"
                                        aria-hidden="true"
                                    ></span>
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-link"
                                    data-ng-if="!$ctrl.buttonControl.setInProgress && !$ctrl.buttonControl.displayAddConfirmation && $ctrl.isSetPartition(partition) && !$ctrl.newPartition.display"
                                    data-ng-click="!$ctrl.buttonControl.setInProgress && !$ctrl.buttonControl.displayAddConfirmation && $ctrl.isSetPartition(partition) && !$ctrl.newPartition.display && $ctrl.cancelSetPartition()"
                                >
                                    <span
                                        class="oui-icon oui-icon-close"
                                        aria-hidden="true"
                                    ></span>
                                </button>
                                <oui-spinner
                                    data-ng-if="$ctrl.buttonControl.setInProgress && $ctrl.isSetPartition(partition)"
                                    data-size="s"
                                >
                                </oui-spinner>
                            </td>
                        </tr>
                        <tr data-ng-if="$ctrl.newPartition.display">
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.hasErrorOrder()
                                }"
                            >
                                <input
                                    type="number"
                                    min="1"
                                    max="99"
                                    class="form-control"
                                    data-ng-model="$ctrl.newPartition.order"
                                    data-ng-change="$ctrl.validationOrder($ctrl.newPartition)"
                                />
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.hasErrorType()
                                }"
                            >
                                <select
                                    class="form-control"
                                    data-ng-options="type as ('server_configuration_installation_' + type | translate) for type in $ctrl.constants.partitionTypeList"
                                    data-ng-model="$ctrl.newPartition.typePartition"
                                    data-ng-change="$ctrl.validationType($ctrl.newPartition)"
                                >
                                </select>
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.hasErrorFileSystem()
                                }"
                            >
                                <select
                                    class="form-control"
                                    data-ng-options="fileSystem as ('server_configuration_installation_' + fileSystem | translate) for fileSystem in $ctrl.constants.fileSystemList"
                                    data-ng-model="$ctrl.newPartition.fileSystem"
                                    data-ng-change="$ctrl.validationFileSystem($ctrl.newPartition)"
                                >
                                </select>
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.hasErrorMountPoint()
                                }"
                            >
                                <input
                                    type="text"
                                    class="form-control"
                                    data-ng-model="$ctrl.newPartition.mountPoint"
                                    data-ng-required="true"
                                    data-ng-change="$ctrl.validationMountPoint($ctrl.newPartition)"
                                    data-ng-disabled="!$ctrl.validation.hasSwap && $ctrl.newPartition.fileSystem == $ctrl.constants.warningSwap"
                                />
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.hasErrorVolumeName()
                                }"
                            >
                                <span
                                    data-ng-if="$ctrl.newPartition.typePartition != $ctrl.constants.warningLV"
                                >
                                    -
                                </span>
                                <input
                                    type="text"
                                    class="form-control"
                                    data-ng-if="$ctrl.newPartition.typePartition == $ctrl.constants.warningLV"
                                    data-ng-model="$ctrl.newPartition.volumeName"
                                    data-ng-change="$ctrl.validationVolumeName($ctrl.newPartition)"
                                    data-ng-disabled="$ctrl.newPartition.typePartition != $ctrl.constants.warningLV"
                                />
                            </td>
                            <td
                                class="form-group"
                                data-ng-if="$ctrl.installation.nbDiskUse > 1 && !$ctrl.informations.raidController"
                                data-ng-class="{
                                    'has-error': $ctrl.hasErrorRaid()
                                }"
                            >
                                <select
                                    class="form-control"
                                    data-ng-options="raid as raid.replace('_','') for raid in $ctrl.getRaidList($ctrl.installation.nbDiskUse)"
                                    data-ng-model="$ctrl.newPartition.raid"
                                    data-ng-change="$ctrl.validationRaid($ctrl.newPartition)"
                                >
                                </select>
                            </td>
                            <td
                                class="form-group"
                                data-ng-class="{
                                    'has-error': $ctrl.hasErrorSize()
                                }"
                            >
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button
                                            type="button"
                                            class="btn btn-default"
                                            title="{{ 'server_configuration_installation_ovh_step2_remaining_size_button' | translate }}"
                                            data-ng-click="$ctrl.getFullSize($ctrl.newPartition)"
                                        >
                                            <span
                                                class="oui-icon oui-icon-expansion-arrows_concept"
                                                aria-hidden="true"
                                            ></span>
                                        </button>
                                    </span>
                                    <input
                                        type="number"
                                        class="form-control"
                                        maxlength="10"
                                        max="9999999999"
                                        data-ng-model="$ctrl.newPartition.partitionSize"
                                        data-ng-change="$ctrl.validationSize($ctrl.newPartition)"
                                    />
                                    <span
                                        class="input-group-addon"
                                        data-translate="unit_size_MB"
                                    >
                                    </span>
                                </div>
                            </td>
                            <td
                                data-ng-if="$ctrl.installation.nbDiskUse > 1 && !$ctrl.informations.raidController"
                                data-ng-bind="$ctrl.getRealDisplaySize({partition: $ctrl.newPartition, multiplicator: $ctrl.newPartition.unit.value})"
                            ></td>
                            <td>
                                <button
                                    type="button"
                                    class="btn btn-link"
                                    data-ng-hide="$ctrl.buttonControl.displayAddConfirmation || $ctrl.buttonControl.addInProgress"
                                    data-ng-click="!$ctrl.buttonControl.addInProgress && $ctrl.validAddPartition()"
                                >
                                    <span
                                        class="oui-icon oui-icon-success"
                                        aria-hidden="true"
                                    ></span>
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-link"
                                    data-ng-hide="$ctrl.buttonControl.displayAddConfirmation || $ctrl.buttonControl.addInProgress"
                                    data-ng-click="!$ctrl.buttonControl.addInProgress && $ctrl.cancelAddPartition()"
                                >
                                    <span
                                        class="oui-icon oui-icon-close"
                                        aria-hidden="true"
                                    ></span>
                                </button>
                                <oui-spinner
                                    data-ng-if="$ctrl.buttonControl.addInProgress"
                                    data-size="s"
                                >
                                </oui-spinner>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="text-center">
                <button
                    type="button"
                    class="btn btn-default"
                    data-ng-hide="$ctrl.setPartition.delModel != null || $ctrl.setPartition.save || $ctrl.newPartition.display"
                    data-ng-click="$ctrl.displayNewPartition()"
                    data-ng-disabled="$ctrl.configError.raidDiskUse"
                    data-translate="server_configuration_installation_ovh_step2_add"
                ></button>
                <button
                    type="button"
                    class="btn btn-danger"
                    data-ng-if="$ctrl.setPartition.delModel != null"
                    data-ng-click="!$ctrl.buttonControl.deleteInProgress && $ctrl.deleteValidPartition()"
                    data-translate="server_configuration_installation_ovh_step2_del"
                ></button>
                <button
                    type="button"
                    class="btn btn-default"
                    data-ng-if="$ctrl.setPartition.delModel != null"
                    data-ng-click="!$ctrl.buttonControl.deleteInProgress && $ctrl.deleteCancelPartition()"
                    data-translate="server_configuration_installation_ovh_step2_del_cancel"
                ></button>

                <button
                    type="button"
                    class="btn btn-link"
                    data-ng-if="$ctrl.buttonControl.displayAddConfirmation && !$ctrl.buttonControl.setInProgress && !$ctrl.buttonControl.addInProgress"
                    data-ng-click="$ctrl.validPartition()"
                    data-translate="server_configuration_installation_ovh_step2_raid0_add"
                ></button>
                <button
                    type="button"
                    class="btn btn-default"
                    data-ng-if="$ctrl.buttonControl.displayAddConfirmation && !$ctrl.buttonControl.setInProgress && !$ctrl.buttonControl.addInProgress"
                    data-ng-click="!$ctrl.buttonControl.setInProgress && !$ctrl.buttonControl.addInProgress && $ctrl.cancelRaid0Partition()"
                    data-translate="server_configuration_installation_ovh_step2_raid0_cancel"
                ></button>
            </div>

            <div>
                <ul>
                    <li data-ng-if="$ctrl.warning.raid0">
                        <span
                            class="oui-icon oui-icon-warning red align-bottom"
                            aria-hidden="true"
                        ></span>
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_warning_partition_raid0"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.raid0">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_raid0"
                            data-translate-values="{ t0: $ctrl.newPartition.display && $ctrl.newPartition.mountPoint || $ctrl.installation.partitionSchemeModels[$ctrl.setPartition.indexSet].mountPoint }"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.partitionSizeToAdd">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_size_min_add"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.partitionSizeOver">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_size_exceed"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.order">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_order"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.orderFirst">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_order_first"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.orderFirstWin">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_order_first_win"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.typePrimary">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_type_primary"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.volumeNameEmpty">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_volumename_empty"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.volumeName">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_volumename_wrong"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.volumeNameUse">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_volumename_use"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.mountPointEmpty">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_mountPoint_empty"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.mountPointUse">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_mountPoint_use"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.mountPoint">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_mountPoint_wrong"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.mountPoint2">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_mountPoint_wrong2"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.mountPointPrimary">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_mountPoint_primary"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.mountPointWindows">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_mountPoint_windows"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.fileSystemSwap">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_file_system_swap"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.fileSystemNoSwap">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_file_system_no_swap"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.partitionSizeSwap">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_size_swap"
                            data-translate-values="{ t0: $ctrl.getDisplaySize(constants.maxSizeSwap) }"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.partitionSize">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_size_max"
                            data-translate-values="{ t0: $ctrl.getDisplaySize(constants.maxSizePartition) }"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.partitionSizeWindows">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_size_min_windows"
                            data-translate-values="{ t0: $ctrl.getDisplaySize(constants.minSizeWindows) }"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.partitionSizeReiserfs">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_size_min_reiserfs"
                            data-translate-values="{ t0: $ctrl.getDisplaySize(constants.minSizeReiserfs) }"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.partitionSizeBoot">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_size_min_boot"
                            data-translate-values="{ t0: $ctrl.getDisplaySize(constants.minSizeBoot) }"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.partitionSizeMin">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_size_min"
                            data-translate-values="{ t0: $ctrl.getDisplaySize(constants.minSizePartition) }"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.orderType">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_type_order"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.typeLvSwap">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_type_lv_swap"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.typeLogicalLv">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_type_logical_lv"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.raidLv">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_partition_raid_LV"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.configError.raidDiskUse">
                        <span
                            class="red"
                            data-translate="server_configuration_installation_ovh_step2_error_raid_diskUse"
                        ></span>
                    </li>
                    <li data-ng-if="$ctrl.errorInst.ws">
                        <span
                            class="red"
                            data-ng-bind-html="$ctrl.errorInst.ws"
                        ></span>
                    </li>
                </ul>
            </div>
        </div>
    </oui-step-form>

    <!-- Configure RTM -->
    <oui-step-form
        data-ng-if="$ctrl.isRtmAvailable && $ctrl.installation.selectDistribution.supportsRTM"
        data-header="{{:: 'server_configuration_installation_form_rtm' | translate}}"
        data-submit-text="{{ ::'server_os_install_ovh_next' | translate }}"
        data-editable="!$ctrl.loader.isInstalling"
        data-navigation="!$ctrl.errorInst.ws
            && !$ctrl.configError.raidDiskUse
            && $ctrl.installation.options.validForm
            && !$ctrl.loader.loading"
    >
        <p>
            <span
                data-translate="server_configuration_installation_form_rtm_explain"
            ></span>
            <a
                data-ng-href="{{ ::$ctrl.rtmGuideLink }}"
                target="_blank"
                rel="noopener"
                data-track-on="click"
                data-track-name="dedicated::dedicated::server::system-install::public-catalog::rtm-documentation"
                data-track-type="action"
            >
                <span
                    data-translate="server_configuration_installation_form_rtm_documentation_link"
                ></span>
                <span
                    class="oui-icon oui-icon-external-link"
                    aria-hidden="true"
                ></span>
            </a>
        </p>

        <div class="mb-3">
            <oui-switch
                model="$ctrl.installation.options.installRTM"
                id="installRTM"
                name="installRTM"
                disabled="$ctrl.loaders.launchInstall"
            >
            </oui-switch>
            <span
                data-translate="{{ !$ctrl.installation.options.installRTM ? 'server_configuration_installation_form_rtm_deactivated' : 'server_configuration_installation_form_rtm_activated' }}"
            >
            </span>
        </div>
    </oui-step-form>

    <!-- installation options -->
    <oui-step-form
        data-header="{{:: 'server_configuration_installation_form_option' | translate}}"
        data-submit-text="{{ ::'server_os_install_ovh_install' | translate }}"
        data-cancel-text="{{ :: 'server_os_install_ovh_cancel' | translate }}"
        data-on-cancel="$ctrl.onGoBack()"
        data-editable="!$ctrl.loader.isInstalling"
    >
        <server-os-install-installation-options
            data-ng-if="$ctrl.installation.selectDistribution"
            service-name="$ctrl.serviceName"
            installation="$ctrl.installation"
            informations="$ctrl.informations"
            config-error="$ctrl.configError"
            is-ovh-install="true"
        >
        </server-os-install-installation-options>
        <div
            data-ng-if="$ctrl.loader.isInstalling"
            class="d-flex align-items-center"
        >
            <oui-spinner data-size="m"></oui-spinner>
            <span data-translate="server_os_install_ovh_in_progress"></span>
        </div>
    </oui-step-form>
</oui-stepper>
