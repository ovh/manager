# OVH API Hooks and Types

This package contains the common folder for hooks and types used to call the OVH API. The process involves fetching the OpenAPI schema, generating types and hooks using the Orval library, and cleaning up temporary files.

## Overview

This project automates the generation of TypeScript types and React hooks for interacting with the OVH API. The process is streamlined to ensure that the API client is always up-to-date with the latest schema.

## Steps

1. **Fetch OpenAPI Schema**

   The first step involves fetching the OpenAPI schema from the [OVH API](https://eu.api.ovh.com/). This schema is used to generate a temporary file that serves as the basis for generating types and hooks.

2. **Generate Types and Hooks with Orval**

   We use the [Orval](https://orval.dev/) library to generate TypeScript types and React hooks. Orval is a powerful tool that simplifies the process of creating API clients by automatically generating code from OpenAPI specifications. It supports various client types, including [react-query](file://manager/packages/manager/apps/pci-savings-plan/src/axios-client/Query.ts#11%2C50-11%2C50), which we use in this project.

   Orval allows us to customize the generated code, including using a custom Axios instance for API requests. This ensures that our API client is tailored to our specific needs and integrates seamlessly with our existing codebase.

3. **Clean Temporary Files**

   After generating the necessary files, we clean up the temporary [dist](file://manager/generate-type-and-hooks.ts#5%2C21-5%2C21) folder to remove any intermediate files that are no longer needed. This helps keep the repository clean and organized.

## Autogenerated Files

The files in the `src/api` directory are autogenerated. Any manual changes to these files will be overwritten the next time the generation process is run. To make changes, please rerun the command following Update Library section

## Getting Started

To get started with this project, ensure you have the necessary dependencies installed and follow the steps outlined above to generate the API client.

### Updating the Library

1. **Run the Script**

   Execute the `npx ts-node ./src/scripts/generate-types-and-hooks` script to regenerate the API client. This script processes all JSON Swagger files and updates the hooks and types accordingly.


2. **Create a Pull Request**

   Once the script has been executed and the changes have been made, create a pull request against the `develop` branch to update the library with the latest changes.


### Running the Script for a Specific File

To regenerate the API client for a specific JSON file, you can pass the filename as an argument to the script. This is useful for updating a single service without processing all files. Use the following command:

Replace `<filename.json>` with the name of the JSON file you wish to process.

Execute the `npx ts-node ./src/scripts/generate-types-and-hooks <filename.json>` script to regenerate the API client

## Future Improvements

- **Continuous Integration (CI)**: We plan to automate the generation process in our CI pipeline. This will ensure that the API client is always up-to-date without manual intervention. This enhancement will be addressed in future updates.


## Troubleshooting
- There is some duplicate types in generation so we need to add a custom transformer in `overal.config.ts` 
- Process is a bit slow on our machine so it may take some times to process all files (5 minutes approximately)