<div data-ui-view>
    <oui-header
        data-heading="{{:: 'cpb_project_management_credit_vouchers' | translate }}"
        class="mb-3"
    >
        <oui-guide-menu
            data-text="{{:: 'pci_project_guides_header' | translate }}"
        >
            <oui-guide-menu-item
                data-ng-repeat="guide in $ctrl.guideUrl.instances track by $index"
                data-href="{{:: guide.url }}"
                data-on-click="$ctrl.trackClick($ctrl.guideTrackingSectionTags.credit_and_vouchers + guide.tracking)"
                data-external
            >
                <span
                    data-translate="{{:: 'pci_project_guides_header_' + guide.key }}"
                ></span>
            </oui-guide-menu-item>
        </oui-guide-menu>
    </oui-header>

    <cui-message-container
        data-messages="$ctrl.messages"
    ></cui-message-container>

    <p data-translate="cpb_vouchers_add_explain_bis"></p>
    <p class="mb-4" data-translate="cpb_vouchers_credit_comment"></p>

    <pci-activate-project-banner
        data-ng-if="$ctrl.isDiscoveryProject"
        data-on-click="$ctrl.goToDiscoveryProjectActivationPage()"
        data-tracking-page-name="PublicCloud::pci::projects::project::vouchers"
    ></pci-activate-project-banner>

    <oui-datagrid data-rows="$ctrl.vouchers">
        <oui-datagrid-topbar>
            <a
                class="oui-button oui-button_secondary mb-2"
                data-ui-sref="pci.projects.project.vouchers.add"
                data-translate="cpb_vouchers_add_button"
                ng-disabled="$ctrl.isDiscoveryProject"
            >
            </a>
            <a
                class="oui-button oui-button_secondary"
                data-ui-sref="pci.projects.project.vouchers.credit"
                data-translate="cpb_vouchers_add_credit_button"
                ng-disabled="$ctrl.isDiscoveryProject"
            >
            </a>
        </oui-datagrid-topbar>
        <oui-datagrid-column
            data-title="'cpb_vouchers_name_cell' | translate"
            data-property="id"
            data-sortable
        >
            {{ :: $ctrl.CloudVouchersService.getVoucherDisplayName($row) }}
            <div
                data-ng-if="$row.pdfUrl"
                data-translate="cpb_vouchers_bill_ref"
                data-translate-values="{ url : $row.pdfUrl, billId : $row.bill }"
            ></div>
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title="'cpb_vouchers_products_cell' | translate"
            data-property="products"
            data-sortable
        >
            {{ :: $row.products.length ? $row.products.join(', ') :
            ('cpb_vouchers_products_all' | translate) }}
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title="'cpb_vouchers_voucher_cell' | translate"
            data-property="voucher"
            data-sortable
        ></oui-datagrid-column>
        <oui-datagrid-column
            data-title="'cpb_vouchers_validity_from_cell' | translate"
            data-property="validity.from"
            data-sortable
        >
            {{ :: $row.validity.from | date:'medium' }}
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title="'cpb_vouchers_total_credit_cell' | translate"
            data-property="total_credit.text"
            data-sortable
        ></oui-datagrid-column>
        <oui-datagrid-column
            title="'cpb_vouchers_validity_to_cell' | translate"
            data-property="validity.to"
            data-sortable
        >
            {{ :: $row.validity.to | date:'medium' }}
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title="'cpb_vouchers_available_credit_cell' | translate"
            data-property="available_credit.text"
            data-sortable
        ></oui-datagrid-column>
    </oui-datagrid>
</div>
