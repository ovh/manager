<div class="cui-page__content" data-ui-view>
    <div class="text-center" style="margin-top: 200px;"
        data-ng-if="$ctrl.loaders.init">
        <oui-spinner size="l" inline="true"></oui-spinner>
    </div>
    <div data-ng-hide="$ctrl.loaders.init">
        <h1 data-translate="pci_projects_project_instances"></h1>
        <oui-datagrid data-rows="$ctrl.table.items">
            <extra-top>
                <oui-button
                    data-ui-sref="pci.projects.project.legacy.compute.infrastructure.vm-add()"
                >
                    <i class="oui-icon oui-icon-add pr-1" aria-hidden="true"></i>
                    <span data-translate="cpci_add_instance"></span>
                </oui-button>
            </extra-top>
            <oui-column title="'cpci_vm_name' | translate" data-property="name" data-type="string" data-searchable data-filterable data-sortable="asc">
                <a data-ui-sref="pci.projects.project.instances.instance.dashboard({projectId: $ctrl.serviceName, instanceId: $row.id})" data-ng-bind="$value"></a>
            </oui-column>
            <oui-column data-title="'cpci_vm_region' | translate" data-property="macroRegion" data-type="options" data-type-options="$ctrl.regionOptions" data-filterable>
                <span data-ng-bind="$ctrl.CucRegionService.getTranslatedMicroRegion($row.region)"></span>
            </oui-column>
            <oui-column data-title="'cpci_vm_flavor_category' | translate" data-property="flavorTranslated" data-type="string" data-searchable data-sortable data-filterable>
            </oui-column>
            <oui-column data-title="'ipv4'" data-property="ipv4" data-type="string" data-searchable data-filterable>
            </oui-column>
            <oui-column data-title="'ipv6'" data-property="ipv6" data-type="string" data-searchable data-filterable>
            </oui-column>
            <oui-column data-title="'cpci_vm_hdd' | translate" data-property="volumes">
                <span data-ng-bind="$row.volumes.length"
                        data-ng-if="$row.volumes.length === 0 || $row.volumes.length > 1"></span>
                <span data-ng-bind="$row.volumes[0].name + ' (' + ($row.volumes[0].size | cucBytes:2:true:'GiB') + ')'"
                        data-ng-if="$row.volumes.length === 1"></span>
            </oui-column>
            <oui-column data-title="'cpci_vm_price' | translate" data-property="price.price.value" data-sortable>
                <span data-ng-if="$row.status !== 'DRAFT' && !$row.monthlyBillingBoolean"
                        data-translate="cpci_vm_flavor_price"
                        data-translate-values="{ price: $row.price.price.text || '?' }">
                </span>
                <span data-ng-if="$row.status !== 'DRAFT' && $row.monthlyBillingBoolean"
                        data-translate="cpci_vm_flavor_month"
                        data-translate-values="{ price: $row.price.monthlyPrice.text || $row.price.price.text || '?' }">
                </span>
            </oui-column>
            <oui-column data-title="'cpci_vm_status' | translate" data-property="statusToTranslate" data-type="options" data-type-options="$ctrl.statusOptions" data-filterable>
                <span class="oui-status oui-status_success"
                        data-translate="cpci_vm_status_OK"
                        data-ng-if="$row.statusToTranslate === 'OK'"></span>
                <span class="oui-status oui-status_info"
                        data-translate="cpci_vm_status_UPDATING"
                        data-ng-if="$row.statusToTranslate === 'UPDATING'"></span>
                <span class="oui-status oui-status_info"
                        data-translate="cpci_vm_status_REBOOT"
                        data-ng-if="$row.statusToTranslate === 'REBOOT'"></span>
                <span class="oui-status oui-status_info"
                        data-translate="cpci_vm_status_{{ $row.statusToTranslate }}"
                        data-ng-if="$row.statusToTranslate === 'BUILD' || $row.statusToTranslate === 'REBUILD'"></span>
                <span class="oui-status oui-status_warning"
                        data-translate="cpci_vm_status_{{ $row.statusToTranslate }}"
                        data-ng-if="$row.statusToTranslate === 'RESCUE' || $row.statusToTranslate === 'SNAPSHOTTING'"></span>
                <span class="oui-status oui-status_error"
                        data-translate="cpci_vm_status_{{ $row.statusToTranslate }}"
                        data-ng-if="$row.statusToTranslate === 'ERROR' || $row.statusToTranslate === 'DELETING'"></span>
            </oui-column>
            <oui-action-menu data-align="end" data-compact>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_edit' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.editVirtualMachine($row.id)"
                                        data-ng-if="$row.status === 'ACTIVE'">
                </oui-action-menu-item>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_monitoring' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.monitorVirtualMachine($row.id)"
                                        data-ng-if="$row.status === 'ACTIVE'">
                </oui-action-menu-item>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_monthly' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.openMonthlyConfirmation($row)"
                                        data-ng-if="$row.status === 'ACTIVE' && !$row.monthlyBilling">
                </oui-action-menu-item>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_create_snapshot' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.openSnapshotWizard($row)"
                                        data-ng-if="$row.status === 'ACTIVE'">
                </oui-action-menu-item>
                <oui-action-menu-divider data-ng-if="$row.status === 'ACTIVE'"></oui-action-menu-divider>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_auth_info' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.openLoginInformations($row)"
                                        data-ng-if="$row.status === 'ACTIVE'">
                </oui-action-menu-item>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_vnc' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.openVnc($row)"
                                        data-ng-if="$row.status === 'ACTIVE' || ($row.status === 'RESCUE' && $row.getStatusGroup() === 'OPENSTACK')">
                </oui-action-menu-item>
                <oui-action-menu-divider data-ng-if="$row.status === 'ACTIVE'"></oui-action-menu-divider>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_rescue' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.rescueMode($row)"
                                        data-ng-if="$row.status === 'ACTIVE'">
                </oui-action-menu-item>
                <oui-action-menu-divider data-ng-if="$row.status === 'ACTIVE'"></oui-action-menu-divider>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_reboot' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.rebootVirtualMachine($row, 'soft')"
                                        data-ng-if="$row.status === 'ACTIVE'">
                </oui-action-menu-item>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_reboot_hard' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.rebootVirtualMachine($row, 'hard')"
                                        data-ng-if="$row.status === 'ACTIVE'">
                </oui-action-menu-item>
                <oui-action-menu-divider data-ng-if="$row.status === 'ACTIVE'"></oui-action-menu-divider>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_reinstall' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.reinstallVirtualMachine($row)"
                                        data-ng-if="$row.status === 'ACTIVE'">
                </oui-action-menu-item>

                <oui-action-menu-item data-text="{{ 'cpci_vm_action_rescue_end' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.stopRescueMode($row, false)"
                                        data-ng-if="$row.status === 'RESCUE' && $row.getStatusGroup() === 'OPENSTACK'">
                </oui-action-menu-item>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_resume' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.resumeVirtualMachine($row)"
                                        data-ng-if="$row.status === 'SUSPENDED' && $row.getStatusGroup() === 'OPENSTACK'">
                </oui-action-menu-item>
                <oui-action-menu-divider data-ng-if="$row.status === 'RESCUE' || $row.status === 'SUSPENDED'"></oui-action-menu-divider>
                <oui-action-menu-item data-text="{{ 'cpci_vm_action_delete' | translate }}"
                                        data-on-click="$ctrl.InfrastructureService.deleteVirtualMachine($row)">
                </oui-action-menu-item>
            </oui-action-menu>
        </oui-datagrid>
        <!-- <div class="clearfix"
                data-ng-include="'pci/project/compute/infrastructure/openstackClient/template.html'">
        </div> -->
    </div>
</div>
