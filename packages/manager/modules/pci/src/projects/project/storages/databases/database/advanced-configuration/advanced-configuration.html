<div class="container-fluid px-0 mt-3">
    <!-- error messages -->
    <cui-message-container
        data-messages="$ctrl.messages"
    ></cui-message-container>

    <span class="d-flex justify-content-between">
        <h2
            data-translate="pci_databases_advanced_configuration_tab_title"
        ></h2>
        <oui-button
            type="submit"
            size="l"
            disabled="$ctrl.pending"
            variant="primary"
            ng-click="$ctrl.updateAdvancedConfiguration()"
            >Mettre à jour la configuration avancée</oui-button
        >
    </span>

    <!-- v2 -->
    <div class="row">
        <div class="col">
            <form data-ng-disabled="$ctrl.pending">
                <div class="oui-field__control">
                    <div class="oui-inline-adder mb-2">
                        <div
                            class="oui-inline-adder__form"
                            data-ng-repeat="extra in $ctrl.model track by $index"
                        >
                            <fieldset class="oui-inline-adder__fieldset">
                                <legend class="ng-hide" aria-hidden="true">
                                    Add a new configuration
                                </legend>
                                <div class="oui-inline-adder__row">
                                    <div class="oui-inline-adder__field">
                                        <oui-field
                                            label="Configuration key"
                                            label-popover="{{$ctrl.model[$index].key.description}}"
                                        >
                                            <oui-select
                                                disabled="$ctrl.model[$index].added"
                                                name="configurationKey"
                                                id="configurationKey"
                                                match="name"
                                                data-model="$ctrl.model[$index].key"
                                                data-items="$ctrl.addableProperties"
                                                on-change="$ctrl.onTypeChanged(modelValue, $index)"
                                                searchable
                                            >
                                            </oui-select>
                                        </oui-field>
                                    </div>
                                    <div class="oui-inline-adder__field">
                                        <oui-field
                                            label="Value"
                                            ng-if="$ctrl.model[$index].key"
                                        >
                                            <input
                                                class="oui-input"
                                                ng-if="$ctrl.model[$index].key.type === $ctrl.FIELD_TYPES.string && !$ctrl.model[$index].key.values"
                                                name="field-{{$index}}"
                                                placeholder=""
                                                ng-model="$ctrl.model[$index].value"
                                                type="text"
                                            />

                                            <input
                                                class="oui-input"
                                                ng-if="$ctrl.model[$index].key.type === 'long' || $ctrl.model[$index].key.type === $ctrl.FIELD_TYPES.double"
                                                name="$ctrl.model[$index].key-{{$index}}"
                                                ng-min="$ctrl.model[$index].key.minimum"
                                                ng-max="$ctrl.model[$index].key.maximum"
                                                ng-model="$ctrl.model[$index].value"
                                                type="number"
                                            />

                                            <oui-radio-group
                                                name="field-{{$index}}"
                                                ng-if="$ctrl.model[$index].key.type === $ctrl.FIELD_TYPES.boolean"
                                                model="$ctrl.model[$index].value"
                                                inline
                                            >
                                                <oui-radio inline value="true"
                                                    >True</oui-radio
                                                >
                                                <oui-radio inline value="false"
                                                    >False</oui-radio
                                                >
                                            </oui-radio-group>

                                            <oui-select
                                                name="field-{{$index}}"
                                                ng-if="$ctrl.model[$index].key.values"
                                                data-model="$ctrl.model[$index].value"
                                                data-items="$ctrl.model[$index].key.values"
                                                class="oui-select__input"
                                            >
                                            </oui-select>
                                        </oui-field>
                                    </div>
                                </div>
                            </fieldset>
                            <footer
                                class="oui-inline-adder__footer"
                                ng-if="!$ctrl.model[$index].isFixed"
                            >
                                <button
                                    type="button"
                                    class="oui-inline-adder__action oui-button oui-button_primary oui-button_s"
                                    data-ng-click="$ctrl.onAddConfig($index)"
                                    data-ng-if="!$ctrl.model[$index].added"
                                    data-ng-disabled="!$ctrl.model[$index].key || $ctrl.addableProperties.length <= 1"
                                >
                                    <span class="oui-icon oui-icon-add"></span>
                                </button>
                                <button
                                    type="button"
                                    class="oui-inline-adder__action oui-button oui-button_primary oui-button_s"
                                    data-ng-click="$ctrl.onRemoveConfig($index)"
                                    data-ng-if="$ctrl.model[$index].added"
                                >
                                    <span
                                        class="oui-icon oui-icon-trash"
                                    ></span>
                                </button>
                            </footer>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="col">
            <pre class="oui-background-p-800 oui-color-p-050 sticky-top">
{{$ctrl.getAdvancedConfigModel() | json}}</pre
            >
        </div>
    </div>
</div>
