<div class="vrack__available">
    <h2 class="vrack__section-title">
        <span data-translate="vrack_your_services"></span>
    </h2>
    <ul class="vrack__service-type-list">
        <li
            class="vrack__service-fetching pull-right"
            data-ng-if="$ctrl.getAllowedServicesCounter < $ctrl.SERVICE_FAMILIES_LIST.length"
        >
            <oui-spinner data-size="s"></oui-spinner>
            <span
                class="oui-badge oui-badge_info"
                data-ng-bind="{{ $ctrl.getAllowedServicesCounter + '/' + $ctrl.SERVICE_FAMILIES_LIST.length }}"
            ></span>
        </li>
        <li class="vrack__section-type">
            <oui-spinner
                data-ng-if="$ctrl.loaders.services[serviceType] || $ctrl.loaders.deleting"
                data-size="s"
            ></oui-spinner>
        </li>
        <!-- we hide the dedicatedServerInterface because they are sent in the dedicated server group -->
        <li
            class="vrack__service-type vrack__service_type_{{serviceType}}"
            data-ng-init="$ctrl.setAccordionState('available', 'types', $index, true)"
            data-ng-repeat="(serviceType, services) in $ctrl.data.allowedServices track by $index"
            data-ng-if="
                (
                  $ctrl.loaders.services[serviceType]
                ||
                  !$ctrl.loaders.deleting
                )
                &&
                serviceType !== $ctrl.SERVICES_NAMES.DSI_SERVICE
"
            data-ng-class="{ 'vrack__service-type_expanded': $ctrl.getAccordionState('available', 'types', $index) }"
        >
            <span
                class="vrack__service-type-name"
                data-ng-click="$ctrl.toggleAccordion('available', 'types', $index)"
            >
                <i
                    class="vrack__service-type-icon"
                    data-ng-class="$ctrl.serviceIconClassMapper(serviceType)"
                >
                </i>
                <span
                    class="loading"
                    data-ng-if="$ctrl.loaders.services[serviceType]"
                >
                    <oui-spinner data-size="s"></oui-spinner> ...
                </span>
                <span data-ng-bind="::$ctrl.getDisplayName(serviceType)"></span>
            </span>

            <!-- grouped services -->
            <ul
                class="vrack__service-list vrack__service_type_grouped_{{serviceType}}"
                data-ng-if="!$ctrl.vrackService.isGroupedServiceType(serviceType)"
            >
                <li
                    class="vrack__service d-flex"
                    data-ng-if="serviceType === $ctrl.SERVICES_NAMES.IP_SERVICE"
                    data-ng-repeat="service in services | orderBy: service track by $index"
                    data-ng-click="$ctrl.toggleAddService($ctrl.SERVICES_NAMES.IP_SERVICE, service)"
                    data-ng-class="{
                 vrack__service_selected: $ctrl.isSelected($ctrl.SERVICES_NAMES.IP_SERVICE, service),
                vrack__service_pending: $ctrl.isPending(service) || $ctrl.loaders.adding || $ctrl.loaders.deleting
                 }"
                >
                    <span data-ng-bind="::service.niceName"></span>
                    <oui-spinner
                        data-ng-if="$ctrl.isPending(service)"
                        data-size="s"
                    >
                    </oui-spinner>
                </li>
                <li
                    class="vrack__service d-flex"
                    data-ng-if="serviceType !== $ctrl.SERVICES_NAMES.IP_SERVICE"
                    data-ng-repeat="service in services | orderBy: service.niceName track by $index"
                    data-ng-click="$ctrl.toggleAddService(service.trueServiceType, service.id)"
                    data-ng-class="{ vrack__service_selected: $ctrl.isSelected(service.trueServiceType, service.id), vrack__service_pending: $ctrl.isPending(service.id) || $ctrl.loaders.adding || $ctrl.loaders.deleting }"
                >
                    <span data-ng-bind="::service.niceName"></span>
                    <oui-spinner
                        data-ng-if="$ctrl.isPending(service.id)"
                        data-size="s"
                    >
                    </oui-spinner>
                </li>
            </ul>
            <!--            END: grouped-->
            <!--            dedicated cloud or managed bare metal -->
            <ul
                class="vrack__service-group-list vrack__service_type_{{serviceType}}"
                data-ng-if="[$ctrl.SERVICE_NAMES.DCLOUD_SERVICE, $ctrl.SERVICE_NAMES.MBM_SERVICE].includes(serviceType)"
            >
                <li
                    class="vrack__service-group"
                    data-ng-init="$ctrl.setAccordionState('available', 'dedicatedCloudNetworks', $index, true)"
                    data-ng-class="{ 'vrack__service-group_expanded': $ctrl.getAccordionState('available', 'dedicatedCloudNetworks', $index) }"
                    data-ng-repeat="service in services | orderBy: service.niceName track by $index"
                >
                    <span
                        class="vrack__service-group-name"
                        data-ng-click="$ctrl.toggleAccordion('available', 'dedicatedCloudNetworks', $index)"
                    >
                        <span data-ng-bind="::service.niceName"></span>
                    </span>

                    <ul class="vrack__service-list vrack__service-list_group">
                        <li
                            class="vrack__service vrack__service_selectable d-flex"
                            data-ng-click="$ctrl.toggleAddService(serviceType, service.id)"
                            data-ng-class="{ vrack__service_selected: $ctrl.isSelected(serviceType, service.id), vrack__service_pending: $ctrl.isPending(service.id) || $ctrl.loaders.adding || $ctrl.loaders.deleting }"
                        >
                            <span
                                data-translate="vrack_private_cloud_vm_network_label"
                            ></span>
                            <oui-spinner
                                data-size="s"
                                data-ng-if="$ctrl.isPending(service.id)"
                            >
                            </oui-spinner>
                        </li>
                    </ul>
                </li>
            </ul>
            <!--            END dedicated or bare metal-->
        </li>
    </ul>
</div>
