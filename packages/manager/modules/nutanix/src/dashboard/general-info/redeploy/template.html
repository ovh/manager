<div class="w-75">
    <h2 data-translate="nutanix_redeploy_title"></h2>
    <oui-back-button on-click="$ctrl.goToPreviousPage()"> </oui-back-button>
    <oui-message class="mb-2" type="warning" dismissable>
        <div data-translate="nutanix_redeploy_warning_info_1"></div>
        <div data-translate="nutanix_redeploy_warning_info_2"></div>
        <ul>
            <li data-translate="nutanix_redeploy_warning_info_3"></li>
            <li data-translate="nutanix_redeploy_warning_info_4"></li>
            <li data-translate="nutanix_redeploy_warning_info_5"></li>
            <li data-translate="nutanix_redeploy_warning_info_6"></li>
        </ul>
    </oui-message>
    <oui-stepper current-index="$ctrl.activeStep">
        <oui-step-form
            data-name="method"
            data-header="{{:: 'nutanix_redeploy_step1_title' | translate}}"
            data-valid="$ctrl.redeployMethod"
            data-prevent-next="true"
            data-on-submit="$ctrl.onRedeployMethodSubmit(form)"
        >
            <oui-select-picker
                data-name="redeployInitialConfiguration"
                data-model="$ctrl.redeployMethod"
                data-label="{{:: 'nutanix_redeploy_initial_configuration' | translate}}"
                data-values="$ctrl.redeployMethods.initialConfig"
            >
            </oui-select-picker>
            <oui-select-picker
                class="mb-2"
                name="redeployCustomConfiguration"
                data-model="$ctrl.redeployMethod"
                data-label="{{:: 'nutanix_redeploy_custom_configuration' | translate}}"
                data-values="$ctrl.redeployMethods.customConfig"
            >
            </oui-select-picker>
        </oui-step-form>

        <oui-step-form
            data-ng-if="$ctrl.redeployMethod === $ctrl.REDEPLOY_CONFIG_OPTIONS.INITIAL"
            data-name="initalConfig"
            data-header="{{:: 'nutanix_redeploy_step2_title_initial_configuration' | translate}}"
            data-position="1"
            data-submit-text="{{:: 'nutanix_redeploy_button' | translate}}"
            data-on-submit="$ctrl.redeployInitialConfiguration(form)"
        >
            <ul class="list-unstyled">
                <li>
                    <span
                        data-translate="nutanix_redeploy_prism_central"
                    ></span>
                    <ul>
                        <li class="align-bottom">
                            <span
                                data-ng-bind="('nutanix_redeploy_prism_central_type'| translate) + ' :'"
                            ></span>
                            <span
                                class="font-weight-bold text-capitalize"
                                data-ng-bind="$ctrl.initalConfig.prismCentral.type"
                            ></span>
                            <span
                                class="oui-icon oui-icon-info ml-1"
                                data-oui-popover="{{:: 'nutanix_redeploy_prism_central_type_description' | translate}}"
                                data-oui-popover-placement="right"
                            ></span>
                        </li>
                        <li class="align-bottom">
                            <span
                                data-ng-bind="('nutanix_redeploy_prism_central_vip' | translate) + ' :'"
                            ></span>
                            <span
                                class="font-weight-bold"
                                data-ng-bind="$ctrl.initalConfig.prismCentral.vip"
                            ></span>
                            <span
                                class="oui-icon oui-icon-info ml-1"
                                data-oui-popover="{{:: 'nutanix_redeploy_prism_central_virtual_ip_description' | translate}}"
                                data-oui-popover-placement="right"
                            ></span>
                        </li>
                        <li class="align-bottom">
                            <span
                                data-ng-bind="('nutanix_redeploy_prism_central_ip' | translate) + ' :'"
                            ></span>
                            <span
                                data-ng-if="$ctrl.initalConfig.prismCentral.ips.length > 0"
                                class="font-weight-bold"
                                data-ng-bind="$ctrl.displayPrismCentralIps"
                            ></span>
                            <span
                                class="oui-icon oui-icon-info ml-1"
                                data-oui-popover="{{:: 'nutanix_redeploy_prism_central_ip_description' | translate}}"
                                data-oui-popover-placement="right"
                            ></span>
                        </li>
                    </ul>
                </li>
                <li class="align-bottom">
                    <span
                        data-ng-bind="('nutanix_redeploy_prism_element_vip' | translate) + ' :'"
                    ></span>
                    <span
                        class="font-weight-bold"
                        ng-bind="$ctrl.initalConfig.prismElementVip"
                    ></span>
                    <span
                        class="oui-icon oui-icon-info ml-1"
                        data-oui-popover="{{:: 'nutanix_redeploy_prism_element_vip_description' | translate}}"
                        data-oui-popover-placement="right"
                    ></span>
                </li>
                <li class="align-bottom">
                    <span
                        data-ng-bind="('nutanix_redeploy_gateway_CIDR' | translate) + ' :'"
                    ></span>
                    <span
                        class="font-weight-bold"
                        ng-bind="$ctrl.initalConfig.gatewayCidr"
                    ></span>
                    <span
                        class="oui-icon oui-icon-info ml-1"
                        data-oui-popover="{{:: 'nutanix_redeploy_prism_element_gateway_cidr_description' | translate}}"
                        data-oui-popover-placement="right"
                    ></span>
                </li>
                <li class="align-bottom">
                    <span
                        data-ng-bind="('nutanix_redeploy_replication_factor' | translate) + ' :'"
                    ></span>
                    <span
                        class="font-weight-bold"
                        ng-bind="$ctrl.initalConfig.redundancyFactor"
                    ></span>
                    <span
                        class="oui-icon oui-icon-info ml-1"
                        data-oui-popover="{{:: 'nutanix_redeploy_replication_description' | translate}}"
                        data-oui-popover-placement="right"
                    ></span>
                </li>
                <li class="align-bottom">
                    <span
                        data-ng-bind="('nutanix_redeploy_erasure_coding' | translate) + ' :'"
                    ></span>
                    <span
                        class="font-weight-bold"
                        ng-bind="$ctrl.initalConfig.erasureCoding ? 'nutanix_redeploy_erasure_coding_enabled' : 'nutanix_redeploy_erasure_coding_disabled' | translate"
                    ></span>
                    <span
                        class="oui-icon oui-icon-info ml-1"
                        data-oui-popover="{{:: 'nutanix_redeploy_erasure_coding_description' | translate}}"
                        data-oui-popover-placement="right"
                    ></span>
                </li>
                <li class="align-bottom">
                    <span
                        data-ng-bind="('nutanix_redeploy_aos' | translate) + ' :'"
                    ></span>
                    <span
                        class="font-weight-bold"
                        ng-bind="$ctrl.initalConfig.version"
                    ></span>
                    <span
                        class="oui-icon oui-icon-info ml-1"
                        data-oui-popover="{{:: 'nutanix_redeploy_prism_element_aos_description' | translate}}"
                        data-oui-popover-placement="right"
                    ></span>
                </li>
            </ul>
        </oui-step-form>

        <oui-step-form
            data-ng-if="$ctrl.redeployMethod === $ctrl.REDEPLOY_CONFIG_OPTIONS.CUSTOM"
            data-name="customConfigRedeploy"
            data-header="{{:: 'nutanix_redeploy_step2_title_custom_configuration' | translate}}"
            data-position="1"
            data-submit-text="{{:: 'nutanix_redeploy_button' | translate}}"
            data-prevent-next="true"
            data-on-submit="$ctrl.redeployCustomConfiguration(form)"
        >
            <form name="customConfig" novalidate>
                <div class="mb-3">
                    <h5
                        data-translate="nutanix_redeploy_custom_configuration_nodes"
                    ></h5>
                    <section
                        data-ng-repeat="node in $ctrl.config.nodes track by $index"
                    >
                        <strong data-ng-bind="node.displayName"></strong>
                        <oui-field
                            data-error-messages="{ 
                                ipSubnetValidator: ('nutanix_redeploy_custom_config_ip_not_in_cidr_subnet_error' | translate),
                                uniqueIpValidator: ('nutanix_redeploy_custom_config_ip_unique_error' | translate),
                                pattern: ('nutanix_redeploy_custom_config_ip_format_error' | translate)
                            }"
                        >
                            <label
                                for="nodeAhvIp{{$index}}"
                                class="ml-2 font-weight-normal"
                                data-translate="nutanix_redeploy_node_ahv_ip"
                            ></label>
                            <input
                                class="oui-input w-50 mt-1"
                                type="text"
                                name="nodeAhvIp-{{$index}}"
                                data-ng-model="node.ahvIp"
                                data-ng-model-options="{ debounce: 500 }"
                                data-ng-pattern="$ctrl.IPV4_REGEX"
                                data-nutanix-dashboard-redeploy-unique-ip-validator="$ctrl.getIpsList()"
                                data-nutanix-dashboard-redeploy-ip-subnet-validator="$ctrl.config.gatewayCidr"
                            />
                        </oui-field>
                        <oui-field
                            data-error-messages="{ 
                                ipSubnetValidator: ('nutanix_redeploy_custom_config_ip_not_in_cidr_subnet_error' | translate),
                                uniqueIpValidator: ('nutanix_redeploy_custom_config_ip_unique_error' | translate),
                                pattern: ('nutanix_redeploy_custom_config_ip_format_error' | translate)
                            }"
                        >
                            <label
                                for="nodeCvmIp{{$index}}"
                                class="ml-2 font-weight-normal"
                                data-translate="nutanix_redeploy_node_cvm_ip"
                            ></label>
                            <input
                                class="oui-input w-50 mt-1"
                                type="text"
                                name="nodeCvmIp-{{$index}}"
                                data-ng-model="node.cvmIp"
                                data-ng-model-options="{ debounce: 500 }"
                                data-ng-pattern="$ctrl.IPV4_REGEX"
                                data-nutanix-dashboard-redeploy-unique-ip-validator="$ctrl.getIpsList()"
                                data-nutanix-dashboard-redeploy-ip-subnet-validator="$ctrl.config.gatewayCidr"
                            />
                        </oui-field>
                    </section>
                </div>
                <div class="mb-3">
                    <h5
                        data-translate="nutanix_redeploy_replication_factor"
                    ></h5>
                    <p
                        data-translate="nutanix_redeploy_replication_description"
                    ></p>
                    <oui-select-picker
                        data-ng-repeat="replicationFactor in $ctrl.replicationFactors"
                        data-name="replicationFactor.name"
                        data-model="$ctrl.redundancyFactorValue"
                        data-label="{{:: ('nutanix_redeploy_custom_configuration_replication_rf' | translate : {value: replicationFactor.factor}) }}"
                        data-values="replicationFactor.values"
                        data-on-change="$ctrl.setRedundancyFactor(modelValue)"
                    ></oui-select-picker>
                </div>
                <div class="mb-3">
                    <h5 data-translate="nutanix_redeploy_erasure_coding"></h5>
                    <p
                        data-translate="nutanix_redeploy_erasure_coding_description"
                    ></p>
                    <div class="row ml-1">
                        <oui-switch
                            class="d-inline-block pr-1"
                            data-name="erasure-coding"
                            data-model="$ctrl.config.erasureCoding"
                        ></oui-switch>
                    </div>
                </div>
                <div class="mb-3">
                    <h5
                        data-translate="nutanix_redeploy_custom_configuration_prism_central"
                    ></h5>
                    <p
                        data-translate="nutanix_redeploy_prism_central_description"
                    ></p>
                    <oui-field
                        data-label="{{:: 'nutanix_redeploy_prism_central_type' | translate}}"
                        data-label-popover="{{:: 'nutanix_redeploy_prism_central_type_description' | translate}}"
                    >
                        <oui-select
                            class="w-50 mt-1"
                            data-name="prismCentralType"
                            data-title="{{:: 'nutanix_redeploy_prism_central_type' | translate}}"
                            data-placeholder="{{:: 'nutanix_redeploy_prism_central_type' | translate}}"
                            data-model="$ctrl.config.prismCentral.type"
                            data-items="$ctrl.prismCentralTypes"
                            data-on-change="$ctrl.onPrismCentralTypeChange(modelValue)"
                        ></oui-select>
                    </oui-field>
                    <oui-field
                        data-label="{{:: 'nutanix_redeploy_prism_central_vip' | translate}}"
                        data-label-popover="{{:: 'nutanix_redeploy_prism_central_virtual_ip_description' | translate}}"
                        data-error-messages="{ 
                            ipSubnetValidator: ('nutanix_redeploy_custom_config_ip_not_in_cidr_subnet_error' | translate),
                            uniqueIpValidator: ('nutanix_redeploy_custom_config_ip_unique_error' | translate),
                            pattern: ('nutanix_redeploy_custom_config_ip_format_error' | translate)
                        }"
                    >
                        <input
                            class="oui-input w-50 mt-1"
                            type="text"
                            name="prismCentralVip"
                            data-ng-model="$ctrl.config.prismCentral.vip"
                            data-ng-model-options="{ debounce: 500 }"
                            data-ng-pattern="$ctrl.IPV4_REGEX"
                            data-nutanix-dashboard-redeploy-unique-ip-validator="$ctrl.getIpsList()"
                            data-nutanix-dashboard-redeploy-ip-subnet-validator="$ctrl.config.gatewayCidr"
                        />
                    </oui-field>
                    <div
                        data-ng-if="$ctrl.config.prismCentral.type !== $ctrl.PRISM_CENTRAL_TYPE_ALONE"
                    >
                        <div class="row ml-1 mb-2">
                            <label
                                class="oui-field__label"
                                data-translate="nutanix_redeploy_prism_central_ip"
                            ></label>
                            <button
                                type="button"
                                class="oui-popover-button ml-2"
                                data-oui-popover="{{:: 'nutanix_redeploy_prism_central_ip_description' | translate}}"
                            ></button>
                        </div>
                        <div
                            class="row ml-1 mt-2"
                            data-ng-repeat="item in $ctrl.config.prismCentral.ips track by $index"
                        >
                            <div class="w-50">
                                <input
                                    type="text"
                                    data-ng-attr-name="{{ 'ip' + $index }}"
                                    class="oui-input"
                                    data-ng-class="{'oui-input_error' : customConfig.ip{{$index}}.$invalid && customConfig.ip{{$index}}.$touched && customConfig.ip{{$index}}.$dirty }"
                                    data-ng-model="$ctrl.config.prismCentral.ips[$index]"
                                    data-ng-model-options="{ debounce: 500 }"
                                    required
                                    data-ng-pattern="$ctrl.IPV4_REGEX"
                                    data-nutanix-dashboard-redeploy-unique-ip-validator="$ctrl.getIpsList()"
                                    data-nutanix-dashboard-redeploy-ip-subnet-validator="$ctrl.config.gatewayCidr"
                                />
                                <small
                                    class="form-text text-danger"
                                    data-ng-if="$ctrl.canShowIpSubnetErrorPrismCentralIpField(customConfig, $index)"
                                    data-translate="nutanix_redeploy_custom_config_ip_not_in_cidr_subnet_error"
                                >
                                </small>
                                <small
                                    class="form-text text-danger"
                                    data-ng-if="$ctrl.canShowIpUniqueErrorPrismCentralIpField(customConfig, $index)"
                                    data-translate="nutanix_redeploy_custom_config_ip_unique_error"
                                >
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <h5
                        data-translate="nutanix_redeploy_prism_element_vip"
                    ></h5>
                    <p
                        data-translate="nutanix_redeploy_prism_element_vip_description"
                    ></p>
                    <oui-field
                        data-error-messages="{ 
                            ipSubnetValidator: ('nutanix_redeploy_custom_config_ip_not_in_cidr_subnet_error' | translate),
                            uniqueIpValidator: ('nutanix_redeploy_custom_config_ip_unique_error' | translate),
                            pattern: ('nutanix_redeploy_custom_config_ip_format_error' | translate)
                        }"
                    >
                        <input
                            type="text"
                            class="oui-input w-50"
                            name="prismElementVip"
                            data-ng-model="$ctrl.config.prismElementVip"
                            data-ng-model-options="{ debounce: 500 }"
                            data-ng-pattern="$ctrl.IPV4_REGEX"
                            data-nutanix-dashboard-redeploy-unique-ip-validator="$ctrl.getIpsList()"
                            data-nutanix-dashboard-redeploy-ip-subnet-validator="$ctrl.config.gatewayCidr"
                        />
                    </oui-field>
                </div>
                <div class="mb-3">
                    <h5 data-translate="nutanix_redeploy_gateway_CIDR"></h5>
                    <p
                        data-translate="nutanix_redeploy_prism_element_gateway_cidr_description"
                    ></p>
                    <oui-field>
                        <input
                            type="text"
                            class="oui-input w-50"
                            name="gatewayCidr"
                            data-ng-model="$ctrl.config.gatewayCidr"
                            data-ng-model-options="{ debounce: 500 }"
                            data-ng-pattern="$ctrl.IPV4_BLOCK_REGEX"
                            data-ng-change="$ctrl.onGatewayCidrChange(customConfig)"
                        />
                    </oui-field>
                </div>
                <div class="mb-3">
                    <h5 data-translate="nutanix_redeploy_aos"></h5>
                    <p
                        data-translate="nutanix_redeploy_prism_element_aos_description"
                    ></p>
                    <oui-input>
                        <oui-select
                            class="w-50 mt-1"
                            name="aos"
                            data-title="{{ ::'nutanix_redeploy_prism_element_aos' | translate }}"
                            data-placeholder="{{ ::'nutanix_redeploy_prism_element_aos' | translate }}"
                            data-model="$ctrl.config.version"
                            data-items="$ctrl.cluster.availableVersions"
                        ></oui-select>
                    </oui-input>
                </div>
            </form>
        </oui-step-form>
    </oui-stepper>
</div>
