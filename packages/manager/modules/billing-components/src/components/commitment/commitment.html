<div class="container-fluid">
    <oui-back-button on-click="$ctrl.goBack()">
        <span
            data-ng-if="!$ctrl.service.isEngaged() && !$ctrl.isLoadingService"
            data-translate="{{ $ctrl.hasDiscountAvailable ? 'billing_commitment_commit_with_discount' : 'billing_commitment_commit'}}"
        ></span>
        <span
            data-ng-if="$ctrl.service.isEngaged() && !$ctrl.isLoadingService"
            data-translate="{{ $ctrl.hasDiscountAvailable ? 'billing_commitment_commit_again_with_discount' : 'billing_commitment_commit_again' }}"
        ></span>
    </oui-back-button>

    <oui-message type="error" ng-if="$ctrl.error">
        <span data-translate="billing_commitment_error"></span>
        <span data-ng-bind="$ctrl.error"></span>
    </oui-message>

    <div data-ng-if="!$ctrl.isLoadingService">
        <p
            data-ng-if="!$ctrl.service.isEngaged() || $ctrl.service.isEngagementExpired()"
            data-translate="{{ $ctrl.hasDiscountAvailable ? 'billing_commitment_none_with_discount' : 'billing_commitment_none' }}"
            data-translate-values="{
                serviceName: $ctrl.service.name,
                serviceType:(('billing_commitment_service_' + $ctrl.service.productType) | translate)
            }"
        ></p>
        <p
            data-ng-if="$ctrl.service.isEngaged() && !$ctrl.service.isEngagementExpired()"
            data-translate="{{ $ctrl.hasDiscountAvailable ? 'billing_commitment_commit_again_description_with_discount' : 'billing_commitment_commit_again_description' }}"
            data-translate-values="{
                serviceName: $ctrl.service.name,
                endDate: $ctrl.service.engagementEndDate || $ctrl.service.expirationDate,
                serviceType:(('billing_commitment_service_' + $ctrl.service.productType) | translate)
            }"
        ></p>
    </div>

    <oui-message type="info"
        ><span data-translate="billing_commitment_info_message"></span
    ></oui-message>

    <h4
        class="oui-heading_4 mt-4"
        data-translate="billing_commitment_duration"
    ></h4>
    <div>
        <billing-commitment-duration
            ng-if="$ctrl.availableEngagements"
            duration="$ctrl.model.duration"
            pricings="$ctrl.availableEngagements"
            on-duration-change="$ctrl.onDurationChange(duration)"
            default-price="$ctrl.defaultPrice"
        >
        </billing-commitment-duration>
    </div>

    <h4
        class="oui-heading_4 mt-4"
        data-translate="billing_commitment_payment"
    ></h4>

    <div>
        <billing-commitment-pricing-mode
            ng-if="$ctrl.availableEngagements && $ctrl.pricingModes && !$ctrl.isPaymentStepLoading"
            pricing-mode="$ctrl.model.engagement"
            pricing-modes="$ctrl.pricingModes"
            duration="$ctrl.model.duration"
            has-discount="$ctrl.hasDiscountAvailable"
            upfront-savings="$ctrl.upfrontSavings"
            default-price="$ctrl.defaultPrice"
            periodic-total-price="$ctrl.periodicTotalPrice"
        >
        </billing-commitment-pricing-mode>
    </div>

    <div class="billing__commitment__footer">
        <oui-message
            class="mb-2"
            type="info"
            data-ng-if="$ctrl.model.engagement.commitmentType"
        >
            <span
                data-translate="{{ 'billing_commitment_summary_description_' + $ctrl.model.engagement.commitmentType }}"
                data-translate-values="{
                  serviceName: '<strong>' + $ctrl.service.name + '</strong>',
                  renewDate: $ctrl.formattedStartingDate,
                  engagementEndDate: $ctrl.model.engagement.getEndDate($ctrl.startingDate),
                  monthlyPrice: $ctrl.model.engagement.pricing.monthlyPrice.text,
                  upfrontPrice: $ctrl.model.engagement.totalPrice.text,
                  paymentMethodName: $ctrl.paymentMethod.description
              }"
            ></span
        ></oui-message>
        <oui-message
            type="info"
            data-ng-if="$ctrl.model.engagement.commitmentType"
            ><span
                data-translate="{{ 'billing_commitment_summary_description_' + $ctrl.model.engagement.commitmentType + '_end' }}"
                data-translate-values="{
                  serviceName: '<strong>' + $ctrl.service.name + '</strong>',
                  engagementEndDate: $ctrl.model.engagement.getEndDate($ctrl.startingDate)
              }"
            >
            </span
        ></oui-message>
        <div class="d-flex mt-4">
            <oui-back-button></oui-back-button>
            <oui-button
                data-on-click="$ctrl.commit()"
                data-variant="primary"
                class="ml-auto"
                ><span data-translate="billing_commitment_summit"></span
            ></oui-button>
        </div>
    </div>
</div>
