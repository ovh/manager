import React from 'react';
import { useTranslation } from 'react-i18next';
import { useEnvironment } from '@ovh-ux/manager-react-core-application';
{{#if this.pimID}}
import { useQueries, UseQueryResult } from '@tanstack/react-query';
import { getPIMService } from '@/api';
{{/if}}
import { MscTile } from '@ovhcloud/msc-react-tile';
import { Locale } from '@ovhcloud/msc-utils';
import useGuideUtils from '@/components/GuideLink/guide-utils';
import { OnboardingLayout } from '@/components/layout-helpers/Onboarding';
import onboardingImgSrc from './onboarding-img.png';
import './index.scss';

export default function Onboarding() {
  const { t } = useTranslation('{{appName}}/onboarding');
  {{#if this.pimID}}
  const pimService: UseQueryResult<any> = useQueries({
    queries: [
      { queryKey: ['pimService'], queryFn: getPIMService, staleTime: Infinity },
    ],
  })[0] as UseQueryResult<any>;
  {{/if}}
  const environment = useEnvironment();
  const locale = environment.getUserLocale() as Locale;
  const link = useGuideUtils();

  const tileList = [
    {
      tileTitle: t('guide1Title'),
      tileDescription: t('guide1Description'),
      href: link?.guideLink1,
    },
    {
      tileTitle: t('guide2Title'),
      tileDescription: t('guide2Description'),
      href: link?.guideLink2,
    },
    {
      tileTitle: t('guide3Title'),
      tileDescription: t('guide3Description'),
      href: link?.guideLink3,
    },
  ];

  const title: string = {{#if this.pimID}}pimService.data?.name?pimService.data?.name:t('title'){{else}}t('title'){{/if}};
  const description: string = {{#if this.pimID}}pimService.data?.description?pimService.data?.description:t('title'){{else}}t('description'){{/if}};

  return (
    <OnboardingLayout
      title={title}
      imageSrc={onboardingImgSrc}
      description={description}
      orderButtonLabel={t('orderButtonLabel')}
      orderHref={t('orderButtonLink')}
      moreInfoButtonLabel={t('moreInfoButtonLabel')}
      moreInfoHref={t('moreInfoButtonLink')}
    >
      <aside className="tile-grid">
        {tileList.map((tile) => (
          <MscTile
            key={tile.tileTitle}
            category={t('guideCategory')}
            locale={locale}
            {...tile}
          />
        ))}
      </aside>
    </OnboardingLayout>
  );
}
