import { Icon, ICON_NAME } from '@ovhcloud/ods-react';
import { Canvas, Meta } from '@storybook/blocks';
import { Table } from '@storybook/components';
import * as PopoverStories from './popover.stories';
import { Banner } from '../../../base-documents/components/banner/Banner';
import { BestPractices } from '../../../base-documents/components/bestPractices/BestPractices';
import { Canvas as OdsCanvas } from '../../../base-documents/components/canvas/Canvas';
import { Heading } from '../../../base-documents/components/heading/Heading';
import { IdentityCard } from '../../../base-documents/components/identityCard/IdentityCard';
import { StorybookLink } from '../../../base-documents/components/storybookLink/StorybookLink';
import { REACT_COMPONENTS_TITLE, STORY } from '../../../base-documents/constants/meta';

<Meta of={ PopoverStories } name="Documentation" />

<Banner of={ PopoverStories } />

_**Popover** component is triggered by click and is used to provide additional information to the user in a new temporary surface that overlays the page_

<Canvas of={ PopoverStories.Overview } sourceState="none" />

<Heading label="Overview" level={ 2 } />

<IdentityCard aliases={ ['Complex Tooltip'] }
              figmaLink="https://www.figma.com/design/9jDDTcR4a9jPRFcdjawAlf/ODS---UI-Kit?node-id=49-8447"
              githubUrl="@ovhcloud/ods-react"
              name="Popover">
  A **Popover** will provide additional information to the user in a clear and concise way.

  It is commonly used to appear by click, thus crucial information should not be displayed in the **Popover**.
</IdentityCard>

<Heading label="Usage" level={ 2 } />

A **Popover** is used to provide an explanation for a user interface element.

It can include interactive elements such as a button or a link.

<Heading label="Tooltip vs Popover" level={ 3 } />

- Both components look similar but a <StorybookLink kind={ REACT_COMPONENTS_TITLE.tooltip } story={ STORY.documentation }>Tooltip</StorybookLink> is displayed on hover and focus while **Popover** is triggered by click.
- Tooltips are commonly used for shorter explanations, while longer text / complex UIs would suit a popover better.
- Use a popover when you need to insert interactive elements such as Button.
- A popover can be dismissed if an action button allows it.

<Heading label="Dos & Don'ts" level={ 3 } />

<BestPractices
  donts={[
    '- Don\'t place critical or mandatory information inside a popover. Users may miss it since it\'s only revealed on click',
    '- Don\'t overload a popover with rich content like images, videos, or large interactive components. Use a Modal or Drawer instead',
    '- Don\'t trigger a popover from non-obvious elements, the interactive element should clearly indicate it controls a popover',
    '- Don\'t rely on popovers for persistent content since they\'re meant to be transient and dismissible',
    '- Don\'t use a popover on elements that are already part of another complex interaction',
  ]}
  dos={[
    '- Use a popover to display contextual information or options that are secondary to the main task',
    '- Prefer a popover over a tooltip when the content is longer, interactive, or requires formatting (but keep it focused)',
    '- Write a popover content using complete sentences',
    '- Ensure the popover is positioned clearly and does not overlap with its trigger element',
    '- Use a popover for lightweight content such as field explanations, secondary actions',
  ]}
/>

<Heading label="Best Practices in Context" level={ 3 } />

![Component anatomy](/assets/base-assets/components/popover/anatomy.png "Component anatomy")

1. **Popover**
2. **Content**
3. **Carret tip** - optional
4. **Trigger**

<Heading label="Placement" level={ 2 } />

**Popover** can be set in a certain position by default around its trigger.

**Popover** has automatic positioning feature. It can detect the edge of the browser so the container always stays visible on a page.

<Heading label="Behavior" level={ 2 } />

By default, a **Popover** is hidden to the user.

It triggers when the user clicks on the **Popover**'s trigger element such as a button.

The **Popover** can be closed or dismissed by clicking anywhere on the page outside the **Popover**'s container.

<Heading label="Navigation" level={ 2 } />

<Heading label="Focus Management" level={ 3 } />

Depending on the **Popover** trigger used (e.g., a button or a link), refer to that component's documentation for its keyboard interaction.

When the **Popover** is opened, it gains focus automatically. Focus remains within the **Popover** until it is closed.

Closing it returns focus to the trigger element.

<Heading label="General Keyboard Shortcuts" level={ 3 } />

Pressing `Escape` closes the currently opened **Popover**.

Pressing `Tab` moves focus forward through the focusable elements inside the **Popover**.

Pressing `Shift` + `Tab` moves focus backward within the **Popover**.

<Heading label="Accessibility" level={ 2 } />
To ensure proper accessibility, **Popover** component must specify its content nature using appropriate ARIA attributes.

<Heading label="Specify the Popover's content nature" level={ 3 } />

Update the content type on the **Popover Trigger**, which is set by default to `aria-haspopup="dialog"`.

<Table>
  <thead>
    <tr>
      <th>Content Type</th>
      <th>ARIA Attribute</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Menu</td>
      <td>`aria-haspopup="menu"`</td>
    </tr>
    <tr>
      <td>List</td>
      <td>`aria-haspopup="listbox"`</td>
    </tr>
    <tr>
      <td>Tree</td>
      <td>`aria-haspopup="tree"`</td>
    </tr>
    <tr>
      <td>Grid</td>
      <td>`aria-haspopup="grid"`</td>
    </tr>
    <tr>
      <td>Dialog</td>
      <td>`aria-haspopup="dialog"`</td>
    </tr>
    <tr>
      <td>Comment</td>
      <td>`aria-details="comment"`</td>
    </tr>
    <tr>
      <td>Definition</td>
      <td>`aria-details="term"` + `role="definition"`</td>
    </tr>
    <tr>
      <td>Caption</td>
      <td>`aria-details="figure"`</td>
    </tr>
    <tr>
      <td>Footnote</td>
      <td>`aria-details="doc-footnote"`</td>
    </tr>
    <tr>
      <td>Endnote</td>
      <td>`aria-details="doc-endnote"`</td>
    </tr>
    <tr>
      <td>Description</td>
      <td>`aria-details="true"`</td>
    </tr>
  </tbody>
</Table>

<Heading label="Using aria-popup for a Popover containing a Menu" level={ 3 } />

<OdsCanvas of={PopoverStories.AccessibilityWithMenu} sourceState='shown' />

<Icon name={ ICON_NAME.circleCheck }
      style={{ color: 'var(--ods-color-success-500)' }} /> Screen readers will recognize that **Popover** contains a menu and menu items. It indicates that the element can trigger a popup and the nature of this popup.
