import { ICON_NAME, Icon } from '@ovhcloud/ods-react';
import { Canvas, Meta } from '@storybook/blocks';
import * as ModalStories from './modal.stories';
import { Banner } from '../../../base-documents/components/banner/Banner';
import { BestPractices } from '../../../base-documents/components/bestPractices/BestPractices';
import { Canvas as OdsCanvas } from '../../../base-documents/components/canvas/Canvas';
import { ExternalLink } from '../../../base-documents/components/externalLink/ExternalLink';
import { Heading } from '../../../base-documents/components/heading/Heading';
import { IdentityCard } from '../../../base-documents/components/identityCard/IdentityCard';

<Meta of={ ModalStories } name="Documentation" />

<Banner of={ ModalStories } />

_A **Modal** component is used to overlay with important content the main view of a site and block interactions with it._

<Canvas of={ ModalStories.Overview } sourceState="none" />

<Heading label="Overview" level={ 2 } />

<IdentityCard aliases={ ['Dialog', 'Alert Dialog', 'Confirm Dialog'] }
              figmaLink="https://www.figma.com/design/9jDDTcR4a9jPRFcdjawAlf/ODS---UI-Kit?node-id=47-2607"
              githubUrl="@ovhcloud/ods-react"
              name="Modal">
  A **Modal** is used to provide some information to users that needs a response or immediate attention.

  While a **Modal** is triggered, there is no interaction possible on the page that is overlaid so users have to
  dismiss or click on an action Button to proceed further.
</IdentityCard>

<Heading label="Usage" level={ 2 } />

**Modals** are used in different cases:
- alerting users about something that requires their agreement
- confirming a user decision
- notifying the user of an important information

There are five different subtypes of **Modals** to inform users that a problem requires immediate response from them so the process can continue, depending on the usage:
- **Neutral**: reserved for standard alerting
- **Information**: provides information to users in context
- **Success**: reserved to provide a static persistent success information
- **Warning**: reserved for **Modals** that need the user attention and acknowledgment but might not cause errors
- **Critical**: reserved for errors, malfunctions, as well as critical issues

They can be dismissable or not.

<Heading label="Dos & Don'ts" level={ 3 } />

<BestPractices
  donts={[
    '- Don\'t use Modals for non-interruptive information, prefer inline content or a Message component for passive feedback',
    '- Don\'t trigger a second Modal from within another Modal since this leads to confusion and poor accessibility',
    '- Don\'t use Modals for long-form content like documentation, complex forms, or multiple paragraphs. Consider a dedicated page or Drawer instead',
    '- Don\'t make a Modal dismissible if the user must take an action to proceed and ensure the intent is clear',
    '- Don\'t overload the Modal with multiple CTAs (Call-to-Action) or overly complex UI elements',
  ]}
  dos={[
    '- Use a Modal to capture user attention for critical decisions, confirmations, or required input that blocks the current flow',
    '- Ensure the Modal has a clear and focused purpose, with concise messaging and a single main action',
    '- Use Modal color variants (Neutral, Info, Success, Warning, Critical) to match the intent and severity of the message',
    '- Allow the Modal to be dismissed via a cancel button, close icon, or Escape key, unless a decision is mandatory',
    '- Keep Modal content short and scannable. Support scroll only when necessary',
  ]}
/>

<Heading label="Best Practices in Context" level={ 3 } />

![Component anatomy](/assets/base-assets/components/modal/anatomy.png "Component anatomy")

1. **Modal**
2. **Header**
3. **Close button** - optional
4. **Content**
5. **Title & description**
6. **Actions**

<Heading label="Placement" level={ 2 } />

When a **Modal** opening is triggered, it is displayed with a position aligned both horizontally and vertically within the viewport.

**Modal** takes up 100% of the viewport width up to a maximum width of 512px.

On small screen, the **Modal** takes all the available space with a margin of 16px.

<Heading label="Behavior" level={ 2 } />

<Heading label="Overlay" level={ 3 } />

A background overlay with opacity is displayed on the page to avoid distraction and help users to focus on the **Modal** content.

An animation with the ease-in and out effect applies on opening.

<Heading label="Closing" level={ 3 } />

A **Modal** is dismissed by clicking on the close icon button.

Dismissing a **Modal** means that it will be closed without submitting any data and the user won't proceed further.

A **Modal** will be successfully closed only once the required action or response has been completed by the user, meaning that the task is completed so the user will proceed further.

The hidden overflow behavior is removed whenever the **Modal** get closed.

<Heading label="Scrolling" level={ 3 } />

When necessary, depending on the viewport height and the **Modal** content, the user can scroll vertically with the header and the action button remaining in place.

<Heading label="Variation" level={ 2 } />

<Heading label="Color" level={ 3 } />

- **Neutral**: providing general information or updates without implying any particular urgency or emotion.
- **Success**: indicating that an action has been successfully completed, offering positive reinforcement to the user.
- **Warning**: alerting users to potential issues or risks, encouraging caution and preventive measures.
- **Critical**: highlighting urgent and severe issues that require immediate attention and action to prevent significant negative outcomes.

<Heading label="Navigation" level={ 2 } />

<Heading label="Focus Management" level={ 3 } />

When the **Modal** is opened, focus is automatically set to the **Modal** itself.

Focus is trapped within the **Modal** and its inner elements while it remains open.

When the **Modal** is closed, focus returns to the trigger element unless otherwise specified.

<Heading label="General Keyboard Shortcuts" level={ 3 } />

Pressing `Escape` closes the **Modal** (if dismissible)

Pressing `Tab` moves focus forward:
* First to the close icon button (if available)
* Then through any other focusable elements inside the **Modal** (e.g., buttons, inputs)

Pressing `Shift` + `Tab` moves focus backward through the focusable elements.

Once the last focusable element is reached, focus loops back to the first focusable element, ensuring it remains within the **Modal**.

<Heading label="Accessibility" level={ 2 } />

This component complies with the <ExternalLink href="https://www.w3.org/WAI/ARIA/apg/patterns/dialog-modal/">Modal WAI-ARIA design pattern</ExternalLink>.

<Heading label="Linking the Modal title and content" level={ 3 } />

Ensure that assistive technologies announce the **Modal** correctly using
<ExternalLink href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-labelledby">aria-labelledby</ExternalLink> or <ExternalLink href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-label">aria-label</ExternalLink>, and <ExternalLink href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-describedby">aria-describedby</ExternalLink>.

<OdsCanvas of={ ModalStories.AccessibilityAriaLabel } sourceState="shown" />

<OdsCanvas of={ ModalStories.AccessibilityAriaLabelledBy } sourceState="shown" />

<Icon name={ ICON_NAME.circleCheck }
      style={{ color: 'var(--ods-color-success-500)' }} /> Screen readers will announce the sections referenced by the aria attributes.

<Heading label="Prioritize the least critical action in modal buttons" level={ 3 } />

For **Modals** that require user decisions (e.g., confirmation dialogs), place the least critical **Button** first in the **Modal** actions section.

<OdsCanvas of={ ModalStories.AccessibilityActions } sourceState="shown" />

<Icon name={ ICON_NAME.circleCheck }
      style={{ color: 'var(--ods-color-success-500)' }} /> Users will first encounter the non-destructive action (e.g., "Cancel"), reducing accidental confirmations.
