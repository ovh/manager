import { Icon, ICON_NAME, Message, MessageBody, MessageIcon } from '@ovhcloud/ods-react';
import { Canvas, Meta } from '@storybook/blocks';
import * as SpinnerStories from './spinner.stories';
import { Banner } from '../../../base-documents/components/banner/Banner';
import { BestPractices } from '../../../base-documents/components/bestPractices/BestPractices';
import { Canvas as OdsCanvas } from '../../../base-documents/components/canvas/Canvas';
import { ExternalLink } from '../../../base-documents/components/externalLink/ExternalLink';
import { Heading } from '../../../base-documents/components/heading/Heading';
import { IdentityCard } from '../../../base-documents/components/identityCard/IdentityCard';
import { StorybookLink } from '../../../base-documents/components/storybookLink/StorybookLink';
import { REACT_COMPONENTS_TITLE, STORY } from '../../../base-documents/constants/meta';

<Meta of={ SpinnerStories } name="Documentation" />

<Banner of={ SpinnerStories } />

_A visual indicator that a process is happening in the background but the interface is not yet ready for interaction._

<Canvas of={ SpinnerStories.Overview } sourceState="none" />

<Heading label="Overview" level={ 2 } />

<IdentityCard aliases={ ['Loading', 'Spin', 'Circular Progress'] }
              figmaLink="https://www.figma.com/design/9jDDTcR4a9jPRFcdjawAlf/ODS---UI-Kit?node-id=52-10340"
              githubUrl="@ovhcloud/ods-react"
              name="Spinner">
  A visual indicator that a process is happening in the background but the interface is not yet ready for
  interaction.
</IdentityCard>

<Heading label="Usage" level={ 2 } />

**Spinner** component is used as a fallback when complex content is loading in the background.

<Heading label="Spinner vs Skeleton" level={ 3 } />

Both **Spinner** and <StorybookLink kind={ REACT_COMPONENTS_TITLE.skeleton } story={ STORY.documentation }>Skeleton</StorybookLink> indicate that content is loading, but they serve different purposes:

* Use a **Spinner** when the content or result is unknown and the user must wait. For example, after clicking a button or loading data from an API

* Use a Skeleton when the structure of the content is known, but the actual data hasn't loaded yet. It helps set expectations and makes the wait feel shorter

<Heading label="Dos & Don'ts" level={ 3 } />

<BestPractices
  donts={[
    '- Don\'t use multiple Spinners on the same page, it creates confusion and visual noise. Use a single centralized Spinner or loading overlay',
    '- Don\'t use a Spinner for text or layout placeholders, use the Skeleton component instead, which better preserves structure',
    '- Don\'t use a Spinner if the loading duration is extremely short, this can feel like a flicker or visual glitch',
    '- Don\'t place Spinners in interactive elements like buttons without also disabling them and explaining the ongoing action',
  ]}
  dos={[
    '- Use a Spinner to indicate indeterminate loading when the duration is unknown or cannot be measured',
    '- Use a Spinner when complex or background processes are happening (e.g. fetching filtered data, saving a form)',
    '- Display a Spinner if the loading is expected to take more than a couple of seconds, to reassure the user',
    '- Combine the Spinner with contextual messaging (e.g. "Loading [...]" or "Saving your changes") to clarify what\'s happening',
  ]}
/>

<Heading label="Placement" level={ 2 } />

**Spinner** can be placed where needed, whether it's centered on an overlay or specific container/content in the page.

**Spinner** can widen to match its container.

<Heading label="Behavior" level={ 2 } />

The **Spinner** component has a spinning animation to show to the user that the background process is moving on.

<Heading label="Variation" level={ 2 } />

<Heading label="Color" level={ 3 } />

* **Primary** (default): used in contexts where the **Spinner** is tied to the main brand action
* **Neutral**: used for secondary or subtle loading indicators, and commonly displayed in disabled parent components to indicate background activity without drawing too much attention
* **White**: designed for use on dark or colored backgrounds to ensure proper contrast and visibility

<Heading label="Navigation" level={ 2 } />

The **Spinner** component is non-interactive and does not receive keyboard focus. It is purely visual and serves as a loading indicator, without affecting keyboard navigation.

<Heading label="Accessibility" level={ 2 } />

The **Spinner** component does not automatically provide enough context for assistive technologies. To ensure accessibility, additional attributes must be applied to the container that holds the loading content.

<Heading label="Indicating loading state" level={ 3 } />

The **Spinner** itself does not convey the loading state. This responsibility falls on the container where content is being loaded by using  <ExternalLink href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-busy">aria-busy</ExternalLink> and <ExternalLink href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-live">aria-live</ExternalLink>.

<OdsCanvas of={ SpinnerStories.AccessibilityAriaBusyAriaLive } sourceState="shown" />

Explanations:
- `aria-busy="true"` informs assistive technologies that content is being updated.
- `aria-live="polite"` ensures that the loading message is announced when necessary without interrupting.

<Icon name={ ICON_NAME.circleCheck }
      style={{ color: 'var(--ods-color-success-500)' }} /> This approach ensures that users with assistive technologies understand when loading starts and ends.

<Message color="information" dismissible={false} style={{ width: '100%' }}>
  <MessageIcon name="circle-info" />
  <MessageBody>
    Once the content is loaded, aria-busy should be set to false.
  </MessageBody>
</Message>

<Heading label="Linking the Spinner to a loading description" level={ 3 } />

If the **Spinner** is associated with a specific loading action, it should be explicitly labeled using <ExternalLink href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-labelledby">aria-labelledby</ExternalLink> or <ExternalLink href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Reference/Attributes/aria-label">aria-label</ExternalLink>.

<OdsCanvas of={ SpinnerStories.AccessibilityAriaLabel } sourceState="shown" />

<Icon name={ ICON_NAME.circleCheck }
      style={{ color: 'var(--ods-color-success-500)' }} /> Screen readers will announce the label, the spinner and its current state.

<OdsCanvas of={ SpinnerStories.AccessibilityAriaLabelledBy } sourceState="shown" />

<Icon name={ ICON_NAME.circleCheck }
      style={{ color: 'var(--ods-color-success-500)' }} /> Screen readers will announce the label, the spinner and its current state.
