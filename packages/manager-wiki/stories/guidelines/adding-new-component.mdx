import { Meta } from '@storybook/blocks';
import { Links, LinkType } from '@ovh-ux/manager-react-components';
import {
  version,
  devDependencies,
} from '../../../manager-react-components/package.json';
import mrcAddComponentImg from './images/mrc-adding-component.png'

<Meta title="Manager React Components/Guidelines/New component ?" />

# How to add a new component

This guide will walk you through the process of creating and integrating a new component into the Manager React Components library.

Correcting, adding new features on an existing component.

## ğŸ“‹ Github issues

Before adding a new component, create a bug or add a new feature

You have to go on the github issue page [here](https://github.com/ovh/manager/issues), then create a new issue :

<img src={mrcAddComponentImg} alt="Create mrc issues" width="600" />

Please fill the form : 

- title
- Component/Hook/utils/Other
- description
- When do you expect the component ?

Its a must have if you have a mock up give by the design

If you already have a Open PR, code sample or prototype, please share to us.

## ğŸ—ï¸ Component Structure

A new component should follow this structure:

```
src/
  components/
    your-component/
      __tests__
          your-component.test.tsx
          your-component.snapshot.test.tsx
          __snapshots__
      your-component.component.tsx
      your-component.constants.ts
      your-component.props.ts
      your-component.types.ts
      your-component.scss
      index.ts
```

A new hook should follow this structure:

```
src/
  hooks/
    your-custom-hook/
      __tests__
           your-custom-hook.test.tsx
      your-custom-hook.tsx
      your-custom-hook.types.ts
      index.ts
```

### name convention:
- Package should be `kebab-case`
- React component, hooks `UpperCamelCase`
- Test name, file name `UpperCamelCase`

Adding story to manager-wiki

```
packages/manager-wiki/stories/managager-react-components/
  components/
    your-component/
      overview.mdx
      changelog.mdx
      documentation.mdx
      your-component.stories.ts
```

## ğŸ“ Implementation Steps

### 1. ğŸ¯ Create Component Files

First, create the necessary files in the correct directory:

```tsx
// your-component.component.tsx
import { OdsText } from '@ovhcloud/ods-components/react';
import { YourComponentProps } from './your-component.types';
import { useYourComponent } from './your-component.utils';

export const YourComponent = ({ prop1, prop2 }: YourComponentProps) => {
  const { result } = useYourComponent(prop1, prop2);
  
  return (
    <OdsText>
      {result}
    </OdsText>
  );
};
```

### 2. ğŸ“¦ Define Types

Create type definitions in `your-component.types.ts`:

```tsx
export interface YourComponentProps {
  prop1: string;
  prop2: number;
  optionalProp?: boolean;
}
```
### 5. ğŸ“š Create Stories

Create Storybook stories in `your-component.stories.tsx`:

```tsx
import { Meta, StoryObj } from '@storybook/react';
import { YourComponent } from './your-component.component';

const meta: Meta<typeof YourComponent> = {
  title: 'Components/YourComponent',
  component: YourComponent,
  tags: ['autodocs'],
  argTypes: {
    prop1: { control: 'text' },
    prop2: { control: 'number' },
    optionalProp: { control: 'boolean' },
  },
};

export default meta;
type Story = StoryObj<typeof YourComponent>;

export const Default: Story = {
  args: {
    prop1: 'Example',
    prop2: 42,
  },
};
```

### 6. âœ… Add Tests

Create unit tests in `your-component.test.tsx`:

```tsx
import { render, screen } from '@testing-library/react';
import { YourComponent } from './your-component.component';

describe('YourComponent', () => {
  it('renders correctly', () => {
    render(<YourComponent prop1="test" prop2={42} />);
    expect(screen.getByText('test - 42')).toBeInTheDocument();
  });
});
```

Create snaphot

> Info : Components in MRC must have a minimum of 90% coverage. More to follow with respect to Accessibility, visual regression testings.

### 7. ğŸ“¸ Create Snapshot Tests

Create snapshot tests in `your-component.snapshot.test.tsx`:

```tsx
import { render } from '@testing-library/react';
import { YourComponent } from './your-component.component';

describe('YourComponent Snapshot Tests', () => {
  it('should match snapshot with default props', () => {
    const { container } = render(<YourComponent prop1="default" prop2={0} />);
    expect(container.firstChild).toMatchSnapshot();
  });

  it('should match snapshot with all props', () => {
    const { container } = render(
      <YourComponent 
        prop1="test value" 
        prop2={42} 
        optionalProp={true} 
      />
    );
    expect(container.firstChild).toMatchSnapshot();
  });

  it('should match snapshot with different prop combinations', () => {
    const { container: container1 } = render(
      <YourComponent prop1="value1" prop2={10} />
    );
    expect(container1.firstChild).toMatchSnapshot('with value1 and 10');

    const { container: container2 } = render(
      <YourComponent prop1="value2" prop2={20} optionalProp={false} />
    );
    expect(container2.firstChild).toMatchSnapshot('with value2, 20, and optionalProp false');
  });
});
```

**Snapshot Testing Best Practices:**

- ğŸ“¸ **Multiple scenarios**: Test different prop combinations to catch visual regressions
- ğŸ·ï¸ **Descriptive names**: Use descriptive snapshot names to identify what each snapshot represents
- ğŸ”„ **Regular updates**: Review and update snapshots when making intentional changes
- ğŸ¯ **Focused testing**: Test the component's visual output, not implementation details
- ğŸ“ **Organized structure**: Keep snapshot files in `__tests__/_snapshots_/` directory

**When to update snapshots:**
- After intentional UI changes
- When fixing bugs that affect rendering
- When adding new features that change the component's appearance

**Running snapshot tests:**
```bash
# Run all snapshot tests
npm test -- --testNamePattern="snapshot"

# Update snapshots after intentional changes
npm test -- --testNamePattern="snapshot" --updateSnapshot
```

> âš ï¸ **Important**: Always review snapshot diffs before accepting changes. Snapshots should reflect intentional UI updates, not accidental regressions.

### 8. Export Component

Add exports in `index.ts`:

```tsx
export { namedExport } from './your-component.component';
export type { nameExportType } from './your-component.types';
```

> âŒ Do not export with `*`, it can cause issues during the library build

### 8. Storybook Update

Add a documentation for the component in Manager WIKI

## ğŸ¨ Best Practices

### Component Design

- ğŸ¯ Keep components focused and single-responsibility
- ğŸ”„ Use TypeScript for type safety
- ğŸ“± Ensure responsive design
- â™¿ Follow accessibility guidelines

### Code Style

- ğŸ“ Use consistent naming conventions
- ğŸ“š Add JSDoc comments for documentation
- ğŸ§ª Write comprehensive tests
- ğŸ” Include error handling

### Performance

- âš¡ Optimize rendering performance
- ğŸ“¦ Minimize bundle size
- ğŸ”„ Use proper memoization
- ğŸ¯ Implement lazy loading when appropriate

## ğŸ” Code Review Checklist

- [ ] Component follows the established structure
- [ ] All necessary files are created
- [ ] TypeScript types are properly defined
- [ ] Unit tests are implemented
- [ ] Storybook stories are created
- [ ] Documentation is complete
- [ ] Accessibility requirements are met
- [ ] Performance is optimized
- [ ] Code style guidelines are followed

## ğŸ“š Additional Resources

- [React Documentation](https://reactjs.org/docs/getting-started.html)
- [TypeScript Documentation](https://www.typescriptlang.org/docs/)
- [Storybook Documentation](https://storybook.js.org/docs/react/get-started/introduction)
- [Testing Library Documentation](https://testing-library.com/docs/)

## ğŸš€ Next Steps

After creating your component:

1. ğŸ“ Update the component documentation
2. ğŸ”„ Create a pull request
3. âœ… Request code review
4. ğŸ¯ Address review comments
5. ğŸ“¦ Prepare for release

## âš ï¸ Common Pitfalls

- âŒ Avoid prop drilling
- âŒ Don't forget error boundaries
- âŒ Avoid unnecessary re-renders
- âŒ Don't skip accessibility testing

## ğŸ”„ Version Control

When committing your changes:

```bash
git checkout -b feat/MANAGER-#
git add .
git commit -m "feat(manager-react-components): add new YourComponent"
git push origin feature/MANAGER-#
```

## ğŸ“ˆ Maintenance

Regular maintenance tasks:

- ğŸ”„ Update dependencies
- ğŸ“ Update documentation
- ğŸ§ª Run test suite
- ğŸ” Review performance metrics

Remember to follow the [semantic versioning](https://semver.org/) guidelines when making changes to existing components.
