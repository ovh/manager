<!-- PROBLEM SOLVED -->
<div data-ng-if="$ctrl.currentLineDiagnostic.data.answers.resolvedAfterTests">
    <img
        class="col-md-2"
        src="{{:: $ctrl.assets.HUMAN_GOOD }}"
        width="180"
        height="180"
        alt
        data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
    />
    <span class="col-md-8">
        <p
            class="oui-heading_4"
            data-translate="tools_lineDiagnostics_solution_proposal_step_problem_solved_title"
        ></p>
        <p
            data-translate="tools_lineDiagnostics_solution_proposal_step_problem_solved_subtitle"
        ></p>
        <oui-button data-variant="primary" data-on-click="$ctrl.$state.go('^')">
            <span
                data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
            ></span>
        </oui-button>
    </span>
</div>

<!-- PROBLEM UNSOLVED -->
<div data-ng-if="!$ctrl.currentLineDiagnostic.data.answers.resolvedAfterTests">
    <div
        class="col-md-4"
        data-ng-if="$ctrl.currentLineDiagnostic.status === 'waitingRobot'"
    >
        <oui-spinner data-size="s"></oui-spinner>
        <span data-translate="tools_lineDiagnostics_please_wait"></span>
    </div>

    <div
        data-ng-if="$ctrl.currentLineDiagnostic.status === 'waitingValidation'"
    >
        <img
            class="col-md-2"
            src="{{:: $ctrl.assets.ADSL_FILTER }}"
            width="180"
            height="180"
            alt
            data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
        />
        <span class="col-md-8">
            <p
                class="oui-heading_4"
                data-translate="tools_lineDiagnostics_solution_proposal_step_waitingValidation_title"
            ></p>
            <p
                data-translate="tools_lineDiagnostics_solution_proposal_step_waitingValidation_subtitle"
            ></p>
            <oui-button
                data-variant="primary"
                data-on-click="$ctrl.$state.go('^')"
            >
                <span
                    data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                ></span>
            </oui-button>
        </span>
    </div>

    <!-- SPECIFIC ERRORS -->
    <div data-ng-if="$ctrl.isMonitoringAlreadyExists()">
        <img
            class="col-md-2"
            src="{{:: $ctrl.assets.HUMAN_THINK }}"
            width="180"
            height="180"
            alt
            data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
        />
        <span class="col-md-8">
            <p
                class="oui-heading_4"
                data-translate="{{:: 'tools_lineDiagnostics_error_context_monitoringTodoAlreadyExists_title' }}"
            ></p>
            <p
                data-translate="{{:: 'tools_lineDiagnostics_error_context_monitoringTodoAlreadyExists_subtitle' }}"
            ></p>
            <oui-button
                data-variant="primary"
                data-on-click="$ctrl.$state.go('^')"
            >
                <span
                    data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                ></span>
            </oui-button>
        </span>
    </div>

    <!-- STATUS MESSAGES -->
    <div data-ng-if="!$ctrl.showRequestForm">
        <div data-ng-if="$ctrl.currentLineDiagnostic.status === 'waitingHuman'">
            <div
                class="col-md-12 form-group"
                data-ng-if="$ctrl.currentLineDiagnostic.data.answers.problemType === 'lowBandwidth'"
            >
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_bandwidthCapabilities"
                    data-translate-values="{
                        'up': $ctrl.bandwidthDetails.theoricalBandwidth.up,
                        'down': $ctrl.bandwidthDetails.theoricalBandwidth.down
                   }"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_bandwidthCurrent"
                    data-translate-values="{
                        'up': $ctrl.bandwidthDetails.currentBandwidth.up,
                        'down': $ctrl.bandwidthDetails.currentBandwidth.down
                   }"
                ></p>
            </div>
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_problem_to_resolve_title"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_problem_to_resolve_subtitle"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.goToRequestForm()"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_fill_request_form"
                    ></span>
                </oui-button>
            </span>
        </div>

        <div
            data-ng-if="$ctrl.currentLineDiagnostic.status === 'syncLossOrLowBandwidth'"
        >
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_problem_to_monitor_title_title"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_problem_to_monitor_title_subtitle"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.goToRequestForm()"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_fill_request_form"
                    ></span>
                </oui-button>
            </span>
        </div>

        <div
            data-ng-if="$ctrl.currentLineDiagnostic.status === 'haveToConnectModemOnTheRightPlug'"
        >
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_haveToConnectModemOnTheRightPlug_title"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_haveToConnectModemOnTheRightPlug_subtitle"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.$state.go('^')"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                    ></span>
                </oui-button>
            </span>
        </div>

        <div
            data-ng-if="$ctrl.currentLineDiagnostic.status === 'connectionProblem'"
        >
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_connectionProblem_title"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_connectionProblem_subtitle"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.$state.go('^')"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                    ></span>
                </oui-button>
            </span>
        </div>

        <div data-ng-if="$ctrl.currentLineDiagnostic.status === 'cancelled'">
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_cancelled_title"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_cancelled_subtitle"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.$state.go('^')"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                    ></span>
                </oui-button>
            </span>
        </div>

        <div
            data-ng-if="$ctrl.currentLineDiagnostic.status === 'validationRefused'"
        >
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_validationRefused_title"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.$state.go('^')"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                    ></span>
                </oui-button>
            </span>
        </div>

        <div
            data-ng-if="$ctrl.currentLineDiagnostic.status === 'interventionRequested'"
        >
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_interventionRequested_title"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_interventionRequested_subtitle"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.$state.go('^')"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                    ></span>
                </oui-button>
            </span>
        </div>

        <div
            data-ng-if="$ctrl.currentLineDiagnostic.status === 'noBandwidthFault'"
        >
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_noBandwidthFault_title"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_noDefaultAnymore_subtitle"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.$state.go('^')"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                    ></span>
                </oui-button>
            </span>
        </div>

        <div
            data-ng-if="$ctrl.currentLineDiagnostic.status === 'noProblemAnymore'"
        >
            <img
                class="col-md-2"
                src="{{:: $ctrl.assets.HUMAN_THINK }}"
                width="180"
                height="180"
                alt
                data-ng-attr-alt="{{:: $ctrl.currentLineDiagnostic.status }}"
            />
            <span class="col-md-8">
                <p
                    class="oui-heading_4"
                    data-translate="tools_lineDiagnostics_solution_proposal_step_noProblemAnymore_title"
                ></p>
                <p
                    data-translate="tools_lineDiagnostics_solution_proposal_step_noDefaultAnymore_subtitle"
                ></p>
                <oui-button
                    data-variant="primary"
                    data-on-click="$ctrl.$state.go('^')"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_exit_diagnostic"
                    ></span>
                </oui-button>
            </span>
        </div>
    </div>
    <!-- END STATUS MESSAGES -->

    <!-- INTERVENTION REQUEST FORM -->
    <div class="col-md-8" data-ng-if="$ctrl.showRequestForm">
        <form
            class="form-group"
            name="requestInterventionForm"
            novalidate
            data-ng-if="$ctrl.currentLineDiagnostic.data.toAnswer && $ctrl.currentLineDiagnostic.data.toAnswer.length > 0 && !$ctrl.loading"
        >
            <!-- Appointment details -->
            <div
                data-ng-if="$ctrl.currentLineDiagnostic.needAppointmentDetails()"
            >
                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_idAppointment_title' | translate }}"
                    data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('idAppointment')"
                >
                    <oui-select
                        name="idAppointment"
                        placeholder="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_idAppointment_text' | translate }}"
                        data-match="label"
                        data-model="$ctrl.appointmentSlot"
                        data-items="$ctrl.currentLineDiagnostic.getQuestionOptions('idAppointment')"
                        data-on-change="$ctrl.currentLineDiagnostic.data.answers.idAppointment = $ctrl.appointmentSlot.id"
                        required
                    >
                        <span ng-bind="$item.label"></span>
                    </oui-select>
                </oui-field>

                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_individualSite_title' | translate }}"
                    data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('individualSite')"
                >
                    <oui-radio-toggle-group
                        class="d-inline-block"
                        data-model="$ctrl.currentLineDiagnostic.data.answers.individualSite"
                    >
                        <oui-radio data-value="true" required>
                            <span
                                data-translate="tools_lineDiagnostics_detail_yes"
                            ></span>
                        </oui-radio>
                        <oui-radio data-value="false" required>
                            <span
                                data-translate="tools_lineDiagnostics_detail_no"
                            ></span>
                        </oui-radio>
                    </oui-radio-toggle-group>
                </oui-field>

                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_siteClosedDays_title' | translate }}"
                    data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('siteClosedDays')"
                >
                    <input
                        class="oui-input"
                        type="text"
                        name="siteClosedDays"
                        data-ng-model="$ctrl.currentLineDiagnostic.data.answers.siteClosedDays"
                        required
                    />
                </oui-field>

                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_siteOpening_title' | translate }}"
                    data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('siteOpening')"
                >
                    <input
                        class="oui-input"
                        type="text"
                        name="siteOpening"
                        data-ng-model="$ctrl.currentLineDiagnostic.data.answers.siteOpening"
                        data-maxlength="20"
                        required
                    />
                </oui-field>

                <!-- Time period questions -->
                <div
                    data-ng-if="$ctrl.currentLineDiagnostic.hasTimePeriodQuestions()"
                >
                    <label
                        class="oui-label"
                        data-translate="tools_lineDiagnostics_solution_proposal_step_request_form_question_hours_title"
                    ></label>

                    <div class="row">
                        <oui-field
                            class="col-md-3 col-xs-8"
                            data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_startMorningHours_title' | translate }}"
                        >
                            <input
                                class="oui-input"
                                type="text"
                                name="startMorningHours"
                                data-ng-pattern="/^[0-9:hH]{0,5}$/"
                                data-ng-model="$ctrl.currentLineDiagnostic.data.answers.startMorningHours"
                                required
                            />
                        </oui-field>

                        <oui-field
                            class="col-md-3 col-xs-8"
                            data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_endMorningHours_title' | translate }}"
                        >
                            <input
                                class="oui-input"
                                type="text"
                                name="endMorningHours"
                                data-ng-pattern="/^[0-9:hH]{0,5}$/"
                                data-ng-model="$ctrl.currentLineDiagnostic.data.answers.endMorningHours"
                                required
                            />
                        </oui-field>
                    </div>
                    <div class="row">
                        <oui-field
                            class="col-md-3 col-xs-8"
                            data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_startAfternoonHours_title' | translate }}"
                        >
                            <input
                                class="oui-input"
                                type="text"
                                name="startAfternoonHours"
                                data-ng-pattern="/^[0-9:hH]{0,5}$/"
                                data-ng-model="$ctrl.currentLineDiagnostic.data.answers.startAfternoonHours"
                                required
                            />
                        </oui-field>

                        <oui-field
                            class="col-md-3 col-xs-8"
                            data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_endAfternoonHours_title' | translate }}"
                        >
                            <input
                                class="oui-input"
                                type="text"
                                name="endAfternoonHours"
                                data-ng-pattern="/^[0-9:hH]{0,5}$/"
                                data-ng-model="$ctrl.currentLineDiagnostic.data.answers.endAfternoonHours"
                                required
                            />
                        </oui-field>
                    </div>
                </div>

                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_secureSite_title' | translate }}"
                    data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('secureSite')"
                >
                    <oui-radio-toggle-group
                        class="d-inline-block"
                        data-model="$ctrl.currentLineDiagnostic.data.answers.secureSite"
                    >
                        <oui-radio data-value="true" required>
                            <span
                                data-translate="tools_lineDiagnostics_detail_yes"
                            ></span>
                        </oui-radio>
                        <oui-radio data-value="false" required>
                            <span
                                data-translate="tools_lineDiagnostics_detail_no"
                            ></span>
                        </oui-radio>
                    </oui-radio-toggle-group>
                </oui-field>

                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_siteDigicode_title' | translate }}"
                    data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('siteDigicode')"
                >
                    <input
                        class="oui-input"
                        type="text"
                        name="siteDigicode"
                        data-ng-model="$ctrl.currentLineDiagnostic.data.answers.siteDigicode"
                    />
                </oui-field>

                <oui-button
                    data-disabled="!requestInterventionForm.$valid"
                    data-on-click="$ctrl.sendInterventionForm()"
                    data-variant="primary"
                >
                    <span
                        data-translate="tools_lineDiagnostics_continue"
                    ></span>
                </oui-button>
            </div>

            <!-- Intervention validation -->
            <div
                class="form-group"
                data-ng-if="!$ctrl.currentLineDiagnostic.needAppointmentDetails()"
            >
                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_ovhTicket_title' | translate }}"
                    data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('ovhTicket')"
                >
                    <input
                        class="oui-input"
                        type="text"
                        name="ovhTicket"
                        data-ng-model="$ctrl.currentLineDiagnostic.data.answers.ovhTicket"
                    />
                </oui-field>

                <div class="row">
                    <oui-field
                        class="col-md-6 col-xs-12"
                        data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_modemType_title' | translate }}"
                        data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('modemType')"
                        data-ng-init="$ctrl.setDefaultValue('modemType')"
                    >
                        <input
                            class="oui-input"
                            type="text"
                            name="modemType"
                            data-ng-model="$ctrl.currentLineDiagnostic.data.answers.modemType"
                            required
                        />
                    </oui-field>

                    <oui-field
                        class="col-md-6 col-xs-12"
                        data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_contactPhone_title' | translate }}"
                        data-ng-init="$ctrl.setDefaultValue('contactPhone')"
                    >
                        <input
                            class="oui-input"
                            type="text"
                            name="contactPhone"
                            data-ng-model="$ctrl.currentLineDiagnostic.data.answers.contactPhone"
                            data-ng-pattern="/^(0033|0)\d{9}$/"
                            required
                        />
                    </oui-field>
                </div>

                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_modemMac_title' | translate }}"
                    data-ng-if="$ctrl.currentLineDiagnostic.hasQuestionToAnswer('modemMac')"
                    data-ng-init="$ctrl.setDefaultValue('modemMac')"
                >
                    <input
                        class="oui-input"
                        type="text"
                        name="modemMac"
                        data-ng-model="$ctrl.currentLineDiagnostic.data.answers.modemMac"
                        required
                    />
                </oui-field>

                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_comment_title' | translate }}"
                >
                    <oui-textarea
                        data-name="comment"
                        data-model="$ctrl.currentLineDiagnostic.data.answers.comment"
                        data-rows="7"
                        data-minlength="5"
                        data-maxlength="200"
                        required
                    ></oui-textarea>
                </oui-field>

                <oui-field
                    data-label="{{:: 'tools_lineDiagnostics_solution_proposal_step_request_form_question_followBySms_title' | translate }}"
                >
                    <oui-radio-toggle-group
                        class="d-inline-block"
                        data-name="followBySms"
                        data-model="$ctrl.currentLineDiagnostic.data.answers.followBySms"
                    >
                        <oui-radio data-value="true" required>
                            <span
                                data-translate="tools_lineDiagnostics_detail_yes"
                            ></span>
                        </oui-radio>
                        <oui-radio data-value="false" required>
                            <span
                                data-translate="tools_lineDiagnostics_detail_no"
                            ></span>
                        </oui-radio>
                    </oui-radio-toggle-group>
                </oui-field>

                <oui-checkbox
                    data-ng-init="$ctrl.currentLineDiagnostic.data.answers.conditionsAccepted = false"
                    data-model="$ctrl.currentLineDiagnostic.data.answers.conditionsAccepted"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_request_form_question_conditionsAccepted_title"
                        data-translate-values="{ price: $ctrl.price }"
                    ></span>
                </oui-checkbox>

                <oui-button
                    data-disabled="!requestInterventionForm.$valid || !$ctrl.currentLineDiagnostic.data.answers.conditionsAccepted"
                    data-on-click="$ctrl.answerQuestion('conditionsAccepted', true)"
                    data-variant="primary"
                >
                    <span
                        data-translate="tools_lineDiagnostics_solution_proposal_step_intervention_request_validation"
                    ></span>
                </oui-button>
            </div>
        </form>

        <p data-ng-if="$ctrl.loading">
            <oui-spinner data-size="s"></oui-spinner>
            <span
                class="ml-2"
                data-translate="tools_lineDiagnostics_please_wait"
            ></span>
        </p>
    </div>
    <!-- END INTERVENTION REQUEST FORM -->
</div>
