<ng-form name="$ctrl.form">
    <div>
        <!-- Introduction Text -->
        <div data-ng-transclude="introductionText"></div>

        <!-- Payment method type choice -->
        <div class="text-center" data-ng-if="$ctrl.loading.init">
            <oui-spinner></oui-spinner>
        </div>

        <div
            class="row"
            data-ng-if="!$ctrl.loading.init"
            data-ng-repeat="paymentTypeChunk in $ctrl.availablePaymentMethodTypes.chunks track by $index"
        >
            <div
                class="mb-3"
                data-ng-class="'col-md-6 col-lg-' + (12 / $ctrl.paymentMethodTypesPerLine)"
                data-ng-repeat="paymentMethodType in paymentTypeChunk | filter: $ctrl.filterPaymentMethod track by $index"
            >
                <oui-radio
                    class="h-100"
                    data-thumbnail
                    data-value="paymentMethodType"
                    data-model="$ctrl.model.selectedPaymentMethodType"
                    data-on-change="$ctrl.resetForm()"
                    data-required="$ctrl.required"
                >
                    <div
                        data-ng-bind="$ctrl.ovhPaymentMethodHelper.getPaymentMethodTypeText(paymentMethodType)"
                    ></div>
                    <img
                        class="payment-method-type-icon"
                        data-ng-if="paymentMethodType.icon.data"
                        data-ng-src="{{ paymentMethodType.icon.data }}"
                        data-ng-attr-alt="{{ :: paymentMethodType.paymentType.text }}"
                        alt
                    />
                </oui-radio>
            </div>
        </div>

        <!-- Default payment method type choice explanations -->
        <div
            data-ng-if="
                $ctrl.showDefaultExplanationTexts &&
                paymentType === $ctrl.model.selectedPaymentMethodType.paymentType
            "
            data-ng-repeat="(paymentType, paymentName) in {
                CREDIT_CARD: 'creditCard',
                SEPA_DIRECT_DEBIT: 'sepa',
                PAYPAL: 'paypal',
                RUPAY: 'rupay',
            }"
        >
            <div data-ng-transclude="{{ paymentName }}ExplanationText">
                <ng-include
                    data-src="paymentName + 'ExplanationTextContainer.html'"
                />
            </div>
            <ng-include
                data-ng-if="$ctrl.$transclude.isSlotFilled(paymentName + 'ExplanationText')"
                data-src="paymentName + 'ExplanationTextContainer.html'"
            />
        </div>

        <!-- Slot for custom method type choice explanation -->
        <div
            data-ng-if="!$ctrl.showDefaultExplanationTexts"
            data-ng-transclude="explanationText"
        ></div>

        <!-- set as default -->
        <div
            class="mt-3"
            data-ng-if="
                $ctrl.model.selectedPaymentMethodType &&
                $ctrl.showSetAsDefaultChoice &&
                !$ctrl.coreConfig.isRegion('US')
            "
        >
            <p
                data-ng-if="$ctrl.registeredPaymentMethods.length === 0 && $ctrl.automaticDefault"
                data-translate="ovh_payment_method_register_force_as_default"
            ></p>
            <oui-field
                data-error-messages="{
                    required: ('ovh_payment_method_register_set_as_default_choice_required' | translate)
                }"
            >
                <oui-checkbox
                    name="setAsDefault"
                    data-model="$ctrl.model.setAsDefault"
                    data-ng-if="$ctrl.registeredPaymentMethods.length > 0 || !$ctrl.automaticDefault"
                    data-required="$ctrl.model.selectedPaymentMethodType && $ctrl.forceSetAsDefaultChoice"
                >
                    <span
                        data-translate="ovh_payment_method_register_set_as_default_choice"
                    ></span>
                </oui-checkbox>
            </oui-field>

            <oui-message class="mb-3 text-justify" type="info">
                <span
                    data-translate="{{:: $ctrl.hasDefaultPaymentMethod ? 'ovh_payment_method_register_set_as_default_choice_information_has_default_payment_method' : 'ovh_payment_method_register_set_as_default_choice_information_no_default_payment_method_ovh_sas' }}"
                ></span>
                <span
                    data-translate="ovh_payment_method_register_set_as_default_choice_information"
                ></span>
            </oui-message>
        </div>
        <div
            data-ng-if="
                $ctrl.model.selectedPaymentMethodType &&
                $ctrl.showSetAsDefaultChoice &&
                $ctrl.coreConfig.isRegion('US')
            "
        >
            <p
                data-ng-if="$ctrl.registeredPaymentMethods.length === 0 && $ctrl.automaticDefault"
            >
                <span
                    data-ng-if="$ctrl.model.selectedPaymentMethodType.type.paymentType === $ctrl.PAYPAL_PAYMENT_METHOD"
                    data-translate="ovh_payment_method_register_force_as_default_paypal_US"
                ></span>
                <span
                    data-ng-if="$ctrl.model.selectedPaymentMethodType.type.paymentType !== $ctrl.PAYPAL_PAYMENT_METHOD"
                    data-translate="ovh_payment_method_register_force_as_default"
                ></span>
            </p>

            <oui-field
                data-error-messages="{
                    required: ('ovh_payment_method_register_set_as_default_choice_required' | translate)
                }"
            >
                <oui-checkbox
                    name="setAsDefault"
                    class="mb-3"
                    data-model="$ctrl.model.setAsDefault"
                    data-ng-if="$ctrl.registeredPaymentMethods.length > 0 || !$ctrl.automaticDefault"
                    data-required="$ctrl.model.selectedPaymentMethodType && $ctrl.forceSetAsDefaultChoice"
                >
                    <span
                        data-translate="ovh_payment_method_register_set_as_default_choice"
                    ></span>
                </oui-checkbox>
            </oui-field>

            <oui-message
                class="mb-3"
                data-ng-if="$ctrl.model.setAsDefault && ($ctrl.registeredPaymentMethods.length > 0 || !$ctrl.automaticDefault)"
                type="info"
            >
                <span
                    data-translate="ovh_payment_method_register_set_as_default_choice_information_US"
                ></span>
            </oui-message>
        </div>
    </div>
</ng-form>
<!-- creditCardExplanationText -->
<script type="text/ng-template" id="creditCardExplanationTextContainer.html">
    <ng-include
        data-ng-if="!$ctrl.defaultExplanationTextsOptions.creditCard"
        data-src="'creditCardExplanationText.html'"
    />
    <oui-message
        data-ng-if="$ctrl.defaultExplanationTextsOptions.creditCard"
        data-type="{{ $ctrl.defaultExplanationTextsOptions.creditCard }}"
    >
        <ng-include data-src="'creditCardExplanationText.html'" />
    </oui-message>
</script>
<script type="text/ng-template" id="creditCardExplanationText.html">
    <div data-ng-if="!$ctrl.showRupayMessage">
        <p
            data-translate="ovh_payment_method_register_explanation_credit_card_selected_explain_generic"
        ></p>
        <p>
            <span
                data-translate="ovh_payment_method_register_explanation_credit_card_selected"
            ></span>
            <span
                data-ng-if="$ctrl.showSpecificCrossBorderSentenceForCardPayment"
                data-translate="ovh_payment_method_register_explanation_credit_card_selected_explain_ovh_transaction"
            ></span>
        </p>
        <p
            data-ng-if="$ctrl.model.selectedPaymentMethodType.isLegacy() && $ctrl.model.selectedPaymentMethodType.integration !== $ctrl.OVH_PAYMENT_METHOD_INTEGRATION_TYPE.IFRAME_VANTIV"
            data-translate="ovh_payment_method_register_explanation_selected_common_redirect"
        ></p>
    </div>
    <div data-ng-if="$ctrl.showRupayMessage">
        <ng-include data-src="'creditCardChargesExplanationText.html'" />
    </div>
</script>

<!-- sepaExplanationText -->
<script type="text/ng-template" id="sepaExplanationTextContainer.html">
    <ng-include
        data-ng-if="!$ctrl.defaultExplanationTextsOptions.sepa.intro"
        data-src="'sepaExplanationTextIntro.html'"
    />
    <oui-message
        data-ng-if="$ctrl.defaultExplanationTextsOptions.sepa.intro"
        data-type="{{ $ctrl.defaultExplanationTextsOptions.sepa.intro }}"
    >
        <ng-include data-src="'sepaExplanationTextIntro.html'" />
    </oui-message>
    <ng-include data-src="'sepaExplanationTextBanner.html'" />
</script>
<script type="text/ng-template" id="sepaExplanationTextIntro.html">
    <div class="text-justify">
        <p
            class="mb-0"
            data-translate="ovh_payment_method_register_explanation_sepa_direct_debit_warning_redirection"
        ></p>
        <p
            class="mb-0"
            data-translate="ovh_payment_method_register_explanation_sepa_direct_debit_warning_order"
        ></p>
        <p
            class="mb-0"
            data-translate="ovh_payment_method_register_explanation_sepa_direct_debit_warning_owner_identity"
        ></p>
    </div>
</script>
<script type="text/ng-template" id="sepaExplanationTextBanner.html">
    <oui-message
        data-type="{{ $ctrl.defaultExplanationTextsOptions.sepa.banner || 'info' }}"
        class="mt-2 text-justify"
    >
        <p
            class="mb-0"
            data-translate="ovh_payment_method_register_explanation_sepa_direct_debit_data_processing_info"
        ></p>
        <p
            class="mb-0"
            data-translate="ovh_payment_method_register_explanation_sepa_direct_debit_digital_signature_info"
        ></p>
    </oui-message>
</script>

<!-- paypalExplanationText -->
<script type="text/ng-template" id="paypalExplanationTextContainer.html">
    <ng-include
        data-ng-if="!$ctrl.defaultExplanationTextsOptions.paypal"
        data-src="'paypalExplanationText.html'"
    />
    <oui-message
        data-ng-if="$ctrl.defaultExplanationTextsOptions.paypal"
        data-type="{{ $ctrl.defaultExplanationTextsOptions.paypal }}"
    >
        <ng-include data-src="'paypalExplanationText.html'" />
    </oui-message>
</script>
<script type="text/ng-template" id="paypalExplanationText.html">
    <span
        data-ng-if="$ctrl.coreConfig.isRegion('US')"
        data-translate="ovh_payment_method_register_explanation_selected_paypal_redirect_US"
    ></span>
    <span
        data-ng-if="!$ctrl.coreConfig.isRegion('US')"
        data-translate="ovh_payment_method_register_explanation_selected_paypal_redirect"
    ></span>
</script>

<!-- rupayExplanationText -->
<script type="text/ng-template" id="rupayExplanationTextContainer.html">
    <ng-include
        data-ng-if="!$ctrl.defaultExplanationTextsOptions.rupay"
        data-src="'creditCardChargesExplanationText.html'"
    />
    <oui-message
        data-ng-if="$ctrl.defaultExplanationTextsOptions.rupay"
        data-type="{{ $ctrl.defaultExplanationTextsOptions.rupay }}"
    >
        <ng-include data-src="'creditCardChargesExplanationText.html'" />
    </oui-message>
</script>
<script type="text/ng-template" id="creditCardChargesExplanationText.html">
    <p
        data-translate="ovh_payment_method_register_explanation_credit_card_registration_charges_info"
        data-translate-values="{
            registrationCharges: $ctrl.registrationCharges
        }"
    ></p>
</script>
