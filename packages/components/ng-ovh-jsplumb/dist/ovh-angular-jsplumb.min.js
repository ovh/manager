/*! ovh-angular-jsplumb - 3.0.5 - 2017-09-12 */
angular.module("ovh-angular-jsplumb",[]),angular.module("ovh-angular-jsplumb").directive("jsplumbEndpoint",["$rootScope","$parse",function(a,b){"use strict";return{restrict:"A",require:"^jsplumbInstance",scope:!0,compile:function(){return{post:function(c,d,e,f){c.attr=e,c.$applyAsync(function(){var g=f.getInstance(),h=b(e.jsplumbEndpointSourceOptions)(c),i=b(e.jsplumbEndpointTargetOptions)(c);c.connectionIds=b(e.jsplumbEndpointConnectionIds)(c)||[],d.addClass("_jsPlumb_ng_endpoint"),h&&g.makeSource(d,h),i&&g.makeTarget(d,i),c.$watch("attr.jsplumbEndpointConnectionIds",function(a,c){var e=b(a)()||[],g=b(c)()||[],h=_.difference(g,e)||[];e&&e.length&&f.connectEndpointsMultiple(d.attr("id"),e),h&&h.length&&f.disconnectEndpointsMultiple(d.attr("id"),h)}),c.$watch("attr.jsplumbEndpointEnabled",function(a,c){var e=b(a)(),f=b(c)();void 0===e&&void 0===f||(g.setSourceEnabled(d,e),g.setTargetEnabled(d,e))}),c.$watch("attr.id",function(b,c){a.$broadcast("jsplumb.endpoint.idChanged",b,c)}),a.$broadcast("jsplumb.endpoint.created",d.attr("id"),c.connectionIds,g),c.$on("$destroy",function(){g.removeAllEndpoints(d),g.remove(d),g.repaintEverything()})})}}}}}]),angular.module("ovh-angular-jsplumb").controller("jsplumbInstanceCtrl",["$scope","$timeout","$window",function(a,b,c){"use strict";function d(b,c){var d=[];return a.instance.isSource(b)&&angular.forEach(c,function(b){a.instance.isTarget(b)&&d.push(b)}),d}var e=this;this.getInstance=function(){return a.instance},this.connectionForecast=[],this.connectEndpoints=function(b,c){var d,f=!1;a.instance.isSourceEnabled(b)||(f=!0,a.instance.setSourceEnabled(b,!0));var g=!1;return a.instance.isTargetEnabled(c)||(g=!0,a.instance.setTargetEnabled(c,!0)),e.connectionExists(b,c)&&e.disconnectEndpoints(b,c),d=a.instance.connect({source:b,target:c}),g&&a.instance.setTargetEnabled(c,!1),f&&a.instance.setSourceEnabled(b,!1),d},this.disconnectEndpoints=function(b,c){var d=b,f=b;if(c?f=e.getConnection(d,c):(d=b.sourceId,c=b.targetId),_.remove(e.connectionForecast,{sourceId:d,targetId:c}),f){var g=!1;a.instance.isSourceEnabled(d)||(g=!0,a.instance.setSourceEnabled(d,!0));var h=!1;a.instance.isTargetEnabled(c)||(h=!0,a.instance.setTargetEnabled(c,!0)),a.instance.detach(f),h&&a.instance.setTargetEnabled(c,!1),g&&a.instance.setSourceEnabled(d,!1)}return f},this.connectEndpointsMultiple=function(a,b){b.forEach(function(b){_.find(e.connectionForecast,{sourceId:a,targetId:b})||e.connectionForecast.push({sourceId:a,targetId:b})}),b=d(a,b),b.length&&angular.forEach(b,function(b){e.connectEndpoints(a,b)})},this.disconnectEndpointsMultiple=function(a,b){angular.forEach(b,function(b){e.disconnectEndpoints(a,b)})},this.getConnection=function(b,c){var d=a.instance.getAllConnections();return _.find(d,{sourceId:b,targetId:c})||_.find(d,{sourceId:c,targetId:b})},this.getConnections=function(b){var c=a.instance.getAllConnections();return _.filter(c,function(a){return a.sourceId===b||a.targetId===b})},this.connectionExists=function(a,b){return!!e.getConnection(a,b)},a.$on("jsplumb.endpoint.idChanged",function(b,c,d){d&&d!==c&&e.getConnections(d).forEach(function(a){e.disconnectEndpoints(a.sourceId,a.targetId)}),e.connectionForecast.filter(function(a){return a.sourceId===c||a.targetId===c}).forEach(function(b){a.instance.connect({source:b.sourceId,target:b.targetId})})}),a.$on("jsplumb.endpoint.created",function(a,b,c){e.connectEndpointsMultiple(b,c)});var f=_.debounce(function(){b(function(){a.instance&&a.instance.revalidateEverything()})},33);a.$on("$destroy",function(){a.instance&&($(window).off("resize",f),a.instance.reset()),a.instance=null}),$(window).on("resize",f);var g=angular.element(c);a.$watch(function(){return{h:g.height(),w:g.width()}},f,!0),a.$on("jsplumb.endpoint.created",f)}]),angular.module("ovh-angular-jsplumb").directive("jsplumbInstance",["$rootScope","$parse",function(a,b){"use strict";return{restrict:"A",scope:!0,controller:"jsplumbInstanceCtrl",compile:function(){return{pre:function(c,d,e,f){var g=b(e.jsplumbInstance)(c);d.addClass("_jsPlumb_ng_instance"),c.instance=jsPlumb.getInstance(angular.extend(g||{},{Container:d})),c.instance.revalidateEverything=function(){var a=this;$("._jsPlumb_ng_endpoint").each(function(b,c){a.revalidate($(c).attr("id"))})},c.instance.connectEndpoints=function(a,b){return f.connectEndpoints(a,b)},c.instance.disconnectEndpoints=function(a,b){return f.disconnectEndpoints(a,b)},c.instance.getConnectionBySourceIdAndTargetId=function(a,b){return f.getConnection(a,b)},a.$broadcast("jsplumb.instance.created",c.instance),c.instance.bind("connection",function(b,d){a.$broadcast("jsplumb.instance.connection",b.connection,b.sourceEndpoint,b.targetEndpoint,c.instance,d),d&&c.$apply()}),c.instance.bind("mouseover",function(b,d){a.$broadcast("jsplumb.instance.connection.mouseover",b,c.instance,d)}),c.instance.bind("mouseout",function(b,d){a.$broadcast("jsplumb.instance.connection.mouseout",b,c.instance,d)}),c.instance.bind("beforeDrop",function(a){return f.connectionExists(a.sourceId,a.targetId)?null:a.connection}),c.instance.bind("click",function(b,d){a.$broadcast("jsplumb.instance.connection.click",b,c.instance,d),d&&c.$apply()}),c.instance.bind("connectionDetached",function(b,d){a.$broadcast("jsplumb.instance.connection.detached",b.connection,b.sourceEndpoint,b.targetEndpoint,c.instance,d),d&&c.$apply()})}}}}}]),angular.module("ovh-angular-jsplumb").service("jsPlumbService",["$q",function(a){"use strict";var b=a.defer();this.jsplumbInit=function(){return jsPlumb.ready(function(){b.resolve()}),b.promise},this.importDefaults=function(a){jsPlumb.importDefaults(a)}}]);